{"config":{"lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"fordead : un package python pour la d\u00e9tection de changement en for\u00eat \u00e0 partir d'images SENTINEL-2 Le package fordead a \u00e9t\u00e9 d\u00e9velopp\u00e9 pour la d\u00e9tection de changements en for\u00eat \u00e0 partir de s\u00e9rie temporelles SENTINEL-2, en particulier dans un contexte de crise sanitaire du scolyte sur les \u00e9pic\u00e9as. A partir de fonctions simplifiant l'utilisation de donn\u00e9es satellites SENTINEL-2, il permet la cartographie des d\u00e9perissements li\u00e9s aux scolytes depuis 2018. Cependant, except\u00e9 les masques utilis\u00e9s qui sont certainement trop sp\u00e9cifiques \u00e0 l'\u00e9tude de peuplements r\u00e9sineux, le reste des \u00e9tapes du processus peuvent \u00e9galement \u00eatre utilis\u00e9es pour d'autres contextes. Installation Conda install (recommended) Depuis l'invite de commande, placer vous dans le r\u00e9pertoire de votre choix et lancez les commandes suivantes : git clone https://gitlab.com/raphael.dutrieux/fordead_package.git cd fordead_package conda env create --name fordead_env conda activate fordead_env pip install . Utilisation pour la d\u00e9tection de d\u00e9perissement La d\u00e9tection du d\u00e9perissement se fait en cinq \u00e9tapes. - Le calcul des indices de v\u00e9g\u00e9tation et des masques pour chaque date SENTINEL-2 - L'apprentissage par mod\u00e9lisation de l'indice de v\u00e9g\u00e9tation pixel par pixel \u00e0 partir des premi\u00e8res dates - La d\u00e9tection du d\u00e9perissement par comparaison entre l'indice de v\u00e9g\u00e9tation pr\u00e9dit par le mod\u00e8le et l'indice de v\u00e9g\u00e9tation r\u00e9el - La cr\u00e9ation du masque for\u00eat, qui d\u00e9finit les zones d'int\u00e9r\u00eat - L'export de sorties permettant de visualiser les r\u00e9sultats au pas de temps souhait\u00e9 Pour les d\u00e9tails sur la r\u00e9alisation de ces \u00e9tapes, voir les guides utilisateurs .","title":"Home"},{"location":"#fordead-un-package-python-pour-la-detection-de-changement-en-foret-a-partir-dimages-sentinel-2","text":"Le package fordead a \u00e9t\u00e9 d\u00e9velopp\u00e9 pour la d\u00e9tection de changements en for\u00eat \u00e0 partir de s\u00e9rie temporelles SENTINEL-2, en particulier dans un contexte de crise sanitaire du scolyte sur les \u00e9pic\u00e9as. A partir de fonctions simplifiant l'utilisation de donn\u00e9es satellites SENTINEL-2, il permet la cartographie des d\u00e9perissements li\u00e9s aux scolytes depuis 2018. Cependant, except\u00e9 les masques utilis\u00e9s qui sont certainement trop sp\u00e9cifiques \u00e0 l'\u00e9tude de peuplements r\u00e9sineux, le reste des \u00e9tapes du processus peuvent \u00e9galement \u00eatre utilis\u00e9es pour d'autres contextes.","title":"fordead : un package python pour la d\u00e9tection de changement en for\u00eat \u00e0 partir d'images SENTINEL-2"},{"location":"#installation","text":"","title":"Installation"},{"location":"#conda-install-recommended","text":"Depuis l'invite de commande, placer vous dans le r\u00e9pertoire de votre choix et lancez les commandes suivantes : git clone https://gitlab.com/raphael.dutrieux/fordead_package.git cd fordead_package conda env create --name fordead_env conda activate fordead_env pip install .","title":"Conda install (recommended)"},{"location":"#utilisation-pour-la-detection-de-deperissement","text":"La d\u00e9tection du d\u00e9perissement se fait en cinq \u00e9tapes. - Le calcul des indices de v\u00e9g\u00e9tation et des masques pour chaque date SENTINEL-2 - L'apprentissage par mod\u00e9lisation de l'indice de v\u00e9g\u00e9tation pixel par pixel \u00e0 partir des premi\u00e8res dates - La d\u00e9tection du d\u00e9perissement par comparaison entre l'indice de v\u00e9g\u00e9tation pr\u00e9dit par le mod\u00e8le et l'indice de v\u00e9g\u00e9tation r\u00e9el - La cr\u00e9ation du masque for\u00eat, qui d\u00e9finit les zones d'int\u00e9r\u00eat - L'export de sorties permettant de visualiser les r\u00e9sultats au pas de temps souhait\u00e9 Pour les d\u00e9tails sur la r\u00e9alisation de ces \u00e9tapes, voir les guides utilisateurs .","title":"Utilisation pour la d\u00e9tection de d\u00e9perissement"},{"location":"docs/00_Intro_Objectifs/","text":"1. Introduction 1.1. Pr\u00e9ambule et contexte Les probl\u00e8mes sanitaires observ\u00e9s au cours des ann\u00e9es pass\u00e9es dans les massifs forestiers fran\u00e7ais, europ\u00e9ens et sur les autres continents, s\u2019expliquent en partie par les changements climatiques qui s\u2019accompagnent d\u2019un d\u00e9r\u00e8glement des pr\u00e9cipitations et d\u2019\u00e9pisodes de s\u00e9cheresse intense. Dans la r\u00e9gion Grand-Est, ces \u00e9pisodes de stress climatique r\u00e9p\u00e9t\u00e9s rendent les massifs particuli\u00e8rement vuln\u00e9rables aux attaques par des pathog\u00e8nes et ravageurs, tels que le scolyte du pin, qui touche notamment tr\u00e8s fortement les massifs d\u2019\u00e9pic\u00e9a ainsi que d\u2019autres conif\u00e8res. Pour r\u00e9pondre aux enjeux de d\u00e9tection pr\u00e9coce et suivi des massifs touch\u00e9s par ces probl\u00e8mes sanitaires conduisant \u00e0 une forte mortalit\u00e9 et se r\u00e9p\u00e9tant depuis plusieurs ann\u00e9es, des m\u00e9thodes s\u2019appuyant sur les donn\u00e9es et outils d\u2019observation de la Terre sont en pr\u00e9paration pour une mise en place op\u00e9rationnelle d\u2019un outil de suivi. L\u2019analyse de donn\u00e9es d\u2019imagerie optique multispectrales satellite issue des capteurs Sentinel-2 appara\u00eet comme particuli\u00e8rement pertinente pour r\u00e9pondre \u00e0 ces enjeux, mais soul\u00e8ve aussi un certain nombre de d\u00e9fis techniques pour la mise en place d\u2019une m\u00e9thode op\u00e9rationnelle. Plusieurs approches sont envisageables pour tirer parti des informations issues des donn\u00e9es Sentinel-2 : Les m\u00e9thodes \u2018classiques\u2019 d\u2019analyse d\u2019image bas\u00e9es sur une classification supervis\u00e9e diff\u00e9renciant massifs sains et avec diff\u00e9rents niveaux de d\u00e9p\u00e9rissement, appliqu\u00e9es \u00e0 des acquisitions individuelles sont techniquement simples \u00e0 mettre en \u0153uvre, mais tr\u00e8s limit\u00e9es en raison du besoin en \u00e9chantillons d\u2019apprentissage repr\u00e9sentatifs des diff\u00e9rentes classes \u00e0 identifier. De plus, dans leur impl\u00e9mentation la plus courante, ces m\u00e9thode ne tirent pas parti de la dimension temporelle et ne permettent donc pas d\u2019identifier les changements, \u00e0 moins d'\u00eatre r\u00e9p\u00e9t\u00e9es \u00e0 diff\u00e9rentes dates, pour pouvoir ensuite \u00e9tudier l'\u00e9volution des cartes de classification, ce qui n\u00e9cessite la mise \u00e0 jour syst\u00e9matique de la base d\u2019apprentissage. Les m\u00e9thodes s\u2019appuyant sur les diff\u00e9rences radiom\u00e9triques observ\u00e9es entre deux dates (\u2018analyse diachronique\u2019), appliqu\u00e9es \u00e0 des indices de diversit\u00e9 appropri\u00e9s, sont aussi tr\u00e8s r\u00e9pandues. Cependant, comme pour les approches supervis\u00e9es, la d\u00e9tection automatique doit s\u2019appuyer sur un jeu d\u2019apprentissage repr\u00e9sentatif des diff\u00e9rentes classes \u00e0 identifier, et le choix des deux dates est \u00e0 la fois d\u00e9terminant, et limitant pour les ph\u00e9nom\u00e8nes continus tels que le d\u00e9p\u00e9rissement des massifs forestiers. Les m\u00e9thodes permettant de tirer parti de tout ou partie d\u2019une s\u00e9rie temporelle d\u2019indicateurs d\u00e9riv\u00e9s d\u2019acquisition effectu\u00e9es au cours d\u2019une saison, d\u2019une ann\u00e9e, de plusieurs ann\u00e9es. Ces m\u00e9thodes sont particuli\u00e8rement adapt\u00e9es au suivi dynamique des massifs forestiers, et \u00e0 la d\u00e9tection d\u2019anomalies. Elles sont cependant plus complexes \u00e0 mettre en \u0153uvre, en raison du volume de donn\u00e9es et des ressources informatiques n\u00e9cessaires au calcul de ces s\u00e9ries temporelles, du travail de pr\u00e9paration et de filtrage des donn\u00e9es, et des m\u00e9thodes d\u2019analyse de ces s\u00e9ries temporelles. 1.2. Objectifs Les objectifs de ces travaux pratiques sont les suivants : Explorer les donn\u00e9es disponibles \u00e0 l\u2019aide de plateformes de visualisation en ligne Acc\u00e9der au t\u00e9l\u00e9chargement des donn\u00e9es d\u2019imagerie Sentinel-2 et pr\u00e9parer l\u2019automatisation de cette t\u00e2che Pr\u00e9parer les donn\u00e9es d\u2019imagerie Sentinel-2 pour la mise en place de traitements pour la d\u00e9tection des foyers de scolytes : extraction d\u2019une zone d'\u00e9tude empilement des couches calcul d\u2019indices de v\u00e9g\u00e9tation Appliquer les m\u00e9thodes les plus accessibles de d\u00e9tection de changement (classification supervis\u00e9e & comparaison d\u2019indices entre deux acquisitions a un an d\u2019intervalle) D\u00e9couvir des methods plus pouss\u00e9es permettant de tirer partie des series temporelles Sentinel-2, potentiellement plus puissantes mais aussi beaucoup plus demandeuses en termes de moyens de calcul et technicit\u00e9.","title":"00 Intro Objectifs"},{"location":"docs/00_Intro_Objectifs/#1-introduction","text":"","title":"1. Introduction"},{"location":"docs/00_Intro_Objectifs/#11-preambule-et-contexte","text":"Les probl\u00e8mes sanitaires observ\u00e9s au cours des ann\u00e9es pass\u00e9es dans les massifs forestiers fran\u00e7ais, europ\u00e9ens et sur les autres continents, s\u2019expliquent en partie par les changements climatiques qui s\u2019accompagnent d\u2019un d\u00e9r\u00e8glement des pr\u00e9cipitations et d\u2019\u00e9pisodes de s\u00e9cheresse intense. Dans la r\u00e9gion Grand-Est, ces \u00e9pisodes de stress climatique r\u00e9p\u00e9t\u00e9s rendent les massifs particuli\u00e8rement vuln\u00e9rables aux attaques par des pathog\u00e8nes et ravageurs, tels que le scolyte du pin, qui touche notamment tr\u00e8s fortement les massifs d\u2019\u00e9pic\u00e9a ainsi que d\u2019autres conif\u00e8res. Pour r\u00e9pondre aux enjeux de d\u00e9tection pr\u00e9coce et suivi des massifs touch\u00e9s par ces probl\u00e8mes sanitaires conduisant \u00e0 une forte mortalit\u00e9 et se r\u00e9p\u00e9tant depuis plusieurs ann\u00e9es, des m\u00e9thodes s\u2019appuyant sur les donn\u00e9es et outils d\u2019observation de la Terre sont en pr\u00e9paration pour une mise en place op\u00e9rationnelle d\u2019un outil de suivi. L\u2019analyse de donn\u00e9es d\u2019imagerie optique multispectrales satellite issue des capteurs Sentinel-2 appara\u00eet comme particuli\u00e8rement pertinente pour r\u00e9pondre \u00e0 ces enjeux, mais soul\u00e8ve aussi un certain nombre de d\u00e9fis techniques pour la mise en place d\u2019une m\u00e9thode op\u00e9rationnelle. Plusieurs approches sont envisageables pour tirer parti des informations issues des donn\u00e9es Sentinel-2 : Les m\u00e9thodes \u2018classiques\u2019 d\u2019analyse d\u2019image bas\u00e9es sur une classification supervis\u00e9e diff\u00e9renciant massifs sains et avec diff\u00e9rents niveaux de d\u00e9p\u00e9rissement, appliqu\u00e9es \u00e0 des acquisitions individuelles sont techniquement simples \u00e0 mettre en \u0153uvre, mais tr\u00e8s limit\u00e9es en raison du besoin en \u00e9chantillons d\u2019apprentissage repr\u00e9sentatifs des diff\u00e9rentes classes \u00e0 identifier. De plus, dans leur impl\u00e9mentation la plus courante, ces m\u00e9thode ne tirent pas parti de la dimension temporelle et ne permettent donc pas d\u2019identifier les changements, \u00e0 moins d'\u00eatre r\u00e9p\u00e9t\u00e9es \u00e0 diff\u00e9rentes dates, pour pouvoir ensuite \u00e9tudier l'\u00e9volution des cartes de classification, ce qui n\u00e9cessite la mise \u00e0 jour syst\u00e9matique de la base d\u2019apprentissage. Les m\u00e9thodes s\u2019appuyant sur les diff\u00e9rences radiom\u00e9triques observ\u00e9es entre deux dates (\u2018analyse diachronique\u2019), appliqu\u00e9es \u00e0 des indices de diversit\u00e9 appropri\u00e9s, sont aussi tr\u00e8s r\u00e9pandues. Cependant, comme pour les approches supervis\u00e9es, la d\u00e9tection automatique doit s\u2019appuyer sur un jeu d\u2019apprentissage repr\u00e9sentatif des diff\u00e9rentes classes \u00e0 identifier, et le choix des deux dates est \u00e0 la fois d\u00e9terminant, et limitant pour les ph\u00e9nom\u00e8nes continus tels que le d\u00e9p\u00e9rissement des massifs forestiers. Les m\u00e9thodes permettant de tirer parti de tout ou partie d\u2019une s\u00e9rie temporelle d\u2019indicateurs d\u00e9riv\u00e9s d\u2019acquisition effectu\u00e9es au cours d\u2019une saison, d\u2019une ann\u00e9e, de plusieurs ann\u00e9es. Ces m\u00e9thodes sont particuli\u00e8rement adapt\u00e9es au suivi dynamique des massifs forestiers, et \u00e0 la d\u00e9tection d\u2019anomalies. Elles sont cependant plus complexes \u00e0 mettre en \u0153uvre, en raison du volume de donn\u00e9es et des ressources informatiques n\u00e9cessaires au calcul de ces s\u00e9ries temporelles, du travail de pr\u00e9paration et de filtrage des donn\u00e9es, et des m\u00e9thodes d\u2019analyse de ces s\u00e9ries temporelles.","title":"1.1. Pr\u00e9ambule et contexte"},{"location":"docs/00_Intro_Objectifs/#12-objectifs","text":"Les objectifs de ces travaux pratiques sont les suivants : Explorer les donn\u00e9es disponibles \u00e0 l\u2019aide de plateformes de visualisation en ligne Acc\u00e9der au t\u00e9l\u00e9chargement des donn\u00e9es d\u2019imagerie Sentinel-2 et pr\u00e9parer l\u2019automatisation de cette t\u00e2che Pr\u00e9parer les donn\u00e9es d\u2019imagerie Sentinel-2 pour la mise en place de traitements pour la d\u00e9tection des foyers de scolytes : extraction d\u2019une zone d'\u00e9tude empilement des couches calcul d\u2019indices de v\u00e9g\u00e9tation Appliquer les m\u00e9thodes les plus accessibles de d\u00e9tection de changement (classification supervis\u00e9e & comparaison d\u2019indices entre deux acquisitions a un an d\u2019intervalle) D\u00e9couvir des methods plus pouss\u00e9es permettant de tirer partie des series temporelles Sentinel-2, potentiellement plus puissantes mais aussi beaucoup plus demandeuses en termes de moyens de calcul et technicit\u00e9.","title":"1.2. Objectifs"},{"location":"docs/01_Prerequis_data_soft/","text":"Pr\u00e9requis pour la formation \"D\u00e9tecter le changement en for\u00eat avec des images satellitaires\" 2. Fiche A : Pr\u00e9requis 2.1. Organisation du r\u00e9pertoire de travail 2.2. Inscriptions requises 2.3. Logiciels utilis\u00e9s 3. Fiche B : Installation du paquet Fordead 3.1. Mise en place d\u2019un environnement virtuel Python 4. Fiche C : T\u00e9l\u00e9chargement des donn\u00e9es Sentinel-2 4.1. Exploration des donn\u00e9es disponibles 4.2. Installation des outils de t\u00e9l\u00e9chargement Sentinel-2 4.3. Utilisation des scripts de t\u00e9l\u00e9chargement automatis\u00e9 4.4. Donn\u00e9es THEIA 4.5. Donn\u00e9es PEPS 2. Fiche A : Pr\u00e9requis 2.1. Organisation du r\u00e9pertoire de travail Afin de faciliter la mise en application des m\u00e9thodes qui seront \u00e9tudi\u00e9es et l\u2019assistance si n\u00e9cessaire, nous proposons de nous appuyer sur une arborescence commune permettant d\u2019identifier facilement l\u2019emplacement relatif aux donn\u00e9es, aux codes utilis\u00e9s ou d\u00e9velopp\u00e9s, et aux r\u00e9sultats des diff\u00e9rents traitements. 2.1.1. Identification du r\u00e9pertoire de travail Les images Sentinel-2 et les produits issus de leur traitement \u00e9tant relativement volumineux, il est n\u00e9cessaire de s\u2019assurer d\u2019un espace disque disponible sup\u00e9rieur \u00e0 10 Go . Nous recommandons de travailler sur votre disque dur local (C:) ou une partition de ce disque dur local . Nous d\u00e9conseillons l\u2019utilisation d\u2019un outil de stockage externe (cl\u00e9 USB, disque dur externe) ou d\u2019un espace disque situ\u00e9 sur un r\u00e9seau partag\u00e9, pour des raisons de performances. 2.1.2. D\u00e9finition du r\u00e9pertoire de travail Une fois d\u00e9fini l\u2019emplacement du r\u00e9pertoire de travail que vous utiliserez durant la formation, identifiez le chemin absolu \u00e0 l'aide d\u2019un explorateur (clic-droit sur la barre de chemin, et \u2018copier l\u2019adresse en tant que texte\u2019). Figure 1. D\u00e9finition du r\u00e9pertoire de travail. Le chemin absolu correspondant ( C:\\Users\\Feret dans l\u2019exemple ci-dessus) sera alors identifi\u00e9 comme <MyWorkingDirectory> dans la suite du document. 2.1.3. R\u00e9cup\u00e9ration de l\u2019arborescence et des donn\u00e9es Afin de simplifier l\u2019organisation des donn\u00e9es et de faciliter l\u2019assistance si n\u00e9cessaire, une arborescence de r\u00e9pertoires comprenant les donn\u00e9es initiales, les programmes et les r\u00e9sultats des traitements, a \u00e9t\u00e9 d\u00e9finie. Cette arborescence est contenue dans une archive \u00e0 t\u00e9l\u00e9charger ici : https://filesender.renater.fr/?s=download&token=881484a1-d260-43ad-a15a-cbe612c96edf (expiration : 05/02/2021) Une fois l\u2019archive copi\u00e9e dans <MyWorkingDirectory> , la d\u00e9compresser. L\u2019arborescence des r\u00e9pertoires est organis\u00e9e de la fa\u00e7on suivante: Figure 2. Arborescence de fichiers utilis\u00e9e lors de la formation. Le travail \u00e0 r\u00e9aliser s\u2019appuie sur des donn\u00e9es Sentinel-2 dont le t\u00e9l\u00e9chargement est abord\u00e9 dans la section d\u00e9di\u00e9e, mais aussi d\u2019un certain nombre d\u2019informations th\u00e9matiques sous forme vectorielle, disponibles par d\u00e9faut dans le r\u00e9pertoire suivant : FORMATION_SANTE_FORETS/A_DATA/VECTOR Afin de permettre une manipulation plus facile des donn\u00e9es et d'\u00e9viter les contraintes associ\u00e9es aux performances limit\u00e9es des machines, l\u2019exercice se focalise sur deux zones d\u2019\u00e9tude restreintes. 2.2. Inscriptions requises 2.2.1. Inscription aux portails de distribution des donn\u00e9es Sentinel-2 Il existe plusieurs portails de distribution des donn\u00e9es Sentinel-2. Parmi ces portails, nous allons d\u00e9crire l'acc\u00e8s aux deux portails : THEIA , qui donne acc\u00e8s aux donn\u00e9es Sentinel-2 individuelles apr\u00e8s correction des effets atmosph\u00e9riques et topographiques \u00e0 l'aide de la cha\u00eene de traitement MAJA d\u00e9velopp\u00e9e par le CESBIO PEPS , qui est un miroir fran\u00e7ais mis en place par le CNES du portail officiel d'acc\u00e8s au donn\u00e9es de l\u2019ESA ( scihub ) Le t\u00e9l\u00e9chargement des donn\u00e9es n\u00e9cessite une inscription pr\u00e9alable qui permet d\u2019obtenir un ++identifiant++ et un ++mot de passe++, qui seront requis lors de l\u2019application des scripts de t\u00e9l\u00e9chargement automatiques. 2.2.2. Inscription \u00e0 gitlab Un compte gitlab est n\u00e9cessaire pour avoir acc\u00e8s aux d\u00e9veloppements en cours, en attendant la mise en place d\u2019un package finalis\u00e9 qui sera alors ouvert au public. Apr\u00e8s inscription sur le site de gitlab , contactez Rapha\u00ebl Dutrieux afin de donner votre identifiant gitlab et avoir acc\u00e8s aux diff\u00e9rents d\u00e9veloppements actuellement en acc\u00e8s priv\u00e9. 2.3. Logiciels utilis\u00e9s Dans un premier temps, les traitements seront r\u00e9alis\u00e9s \u00e0 l\u2019aide du logiciel QGis, logiciel adapt\u00e9 pour traiter un jeu de donn\u00e9es satellitaires r\u00e9duit. La seconde partie de cette session exploite les outils d\u00e9velopp\u00e9s en Python par l\u2019UMR TETIS. Ces codes n\u00e9cessitent d\u2019installer un environnement d\u00e9di\u00e9. la plateforme de d\u00e9veloppement Anaconda qui permettra de mettre en place un environnement virtuel python 3 d\u00e9di\u00e9 aux applications vues lors de la formation et comprenant l\u2019ensemble des librairies et d\u00e9pendances n\u00e9cessaires. le logiciel SIG QGIS (minimum version 3.10.13 LTR). Si QGIS n\u2019est pas install\u00e9 sur votre machine, les instructions sont fournies dans la suite du TD pour installer la version la plus r\u00e9cente dans l\u2019environnement virtuel anaconda qui sera cr\u00e9\u00e9. 2.3.1. Installation d\u2019Anaconda T\u00e9l\u00e9charger Anaconda (choisir la version en fonction de votre syst\u00e8me) sur la page web suivante : https://www.anaconda.com/products/individual Suivre les instructions d\u2019installation d\u00e9crites sur la page web suivante : pour Windows : https://docs.anaconda.com/anaconda/install/windows/ pour Linux : https://docs.anaconda.com/anaconda/install/linux/ 2.3.2. Installation de git Git est un outil libre et open source permettant la gestion des versions des codes disponibles sur un d\u00e9p\u00f4t. Dans le cadre de cette formation, un certain nombre d\u2019outils ont \u00e9t\u00e9 mis \u00e0 disposition sur gitlab, et l\u2019installation de git vous permettra de r\u00e9cup\u00e9rer les derni\u00e8res versions de ces codes, ainsi que d\u2019effectuer les mises \u00e0 jour au fur et \u00e0 mesure des d\u00e9veloppements. Une fois anaconda install\u00e9, vous pouvez installer git simplement en suivant la proc\u00e9dure suivante : Ouvrez une invite de commande Anaconda (Anaconda Prompt) en appuyant sur la touche \u2018Windows\u2019 de votre clavier (on suppose que les utilisateurs de Linux sont familiers avec les terminaux), et commencez \u00e0 taper \u2018anaconda\u2019 pour s\u00e9lectionner \u2018Anaconda Prompt\u2019 Figure 3. Ouvrir une invite de commande Anaconda. L\u2019invite de commande s\u2019ouvre alors en pointant sur le r\u00e9pertoire qui se trouve \u00eatre <MyWorkingDirectory> . C\u2019est quand m\u00eame bien fait, mais n\u2019allez pas croire, c\u2019est un hasard\u2026 C\u2019est le r\u00e9pertoire par d\u00e9faut de l\u2019utilisateur de la machine. Figure 4. Anaconda Prompt. Vous pouvez alors taper (ou copier / coller) l\u2019instruction suivante dans l\u2019invite de commande: ```bash= conda install -c anaconda git ```` 3. Fiche B : Installation du paquet Fordead 3.1. Mise en place d\u2019un environnement virtuel Python La plateforme de d\u00e9veloppement Anaconda permet de cr\u00e9er des \u2018environnements virtuels\u2019 de d\u00e9veloppement python sp\u00e9cifiques et ind\u00e9pendants d\u2019autres environnements python cohabitant sur une m\u00eame machine. Ces environnements virtuels sont particuli\u00e8rement int\u00e9ressants pour s\u2019assurer de la stabilit\u00e9 des applications utilis\u00e9es dans diff\u00e9rents projets et pouvant aboutir \u00e0 des incompatibilit\u00e9s de d\u00e9pendance si le m\u00eame environnement python \u00e9tait utilis\u00e9. Dans le cadre de la formation, nous avons initi\u00e9 le d\u00e9veloppement du package python \u2018 fordead \u2019, qui sera principalement utilis\u00e9 pour appliquer la m\u00e9thode de d\u00e9tection des foyers de scolytes par analyse de s\u00e9ries temporelles Sentinel-2. La page de pr\u00e9sentation de fordead d\u00e9crit les diff\u00e9rentes \u00e9tapes pour la mise en place de cet environnement virtuel, rappel\u00e9es ici : Rechercher le chemin absolu d\u2019acc\u00e8s au r\u00e9pertoire suivant : <MyWorkingDirectory>\\FORMATION_SANTE_FORETS\\B_PROGRAMS\\Libraries Depuis un terminal anaconda (Menu D\u00e9marrer \u2192 Anaconda prompt), si votre r\u00e9pertoire de travail est situ\u00e9 sur une partition diff\u00e9rente de \u2018C:\u2019, par exemple \u2018D:\u2019 commencez par taper : bash= D: Saisir alors l\u2019instruction suivante pour se rendre sur le r\u00e9pertoire suivant : bash= cd <MyWorkingDirectory>\\FORMATION_SANTE_FORETS\\B_PROGRAMS\\Libraries Cloner en local le d\u00e9p\u00f4t Git du projet fordead_package de l\u2019UMR Tetis. Deux solutions sont possibles, au choix : Option 1. Depuis le terminal en saisissant la commande suivante : bash= git clone https://gitlab.com/raphael.dutrieux/fordead_package.git Suite au lancement de cette commande, les informations suivantes devraient appara\u00eetre sur le terminal : Figure 5. Retours de la commande git clone. Option 2. Depuis le site web de gitlab : Acc\u00e9der au projet gitlab : https://gitlab.com/raphael.dutrieux/fordead_package T\u00e9l\u00e9charger l\u2019ensemble des codes dans une archive zip en cliquant sur le bouton Figure 6. T\u00e9l\u00e9chargement manuelle depuis le site Gitlab. D\u00e9compresser l\u2019archive zip t\u00e9l\u00e9charg\u00e9e dans le r\u00e9pertoire des programmes : <MyWorkingDirectory>\\FORMATION_SANTE_FORETS\\B_PROGRAMS\\Libraries Quelle que soit la solution choisie pour t\u00e9l\u00e9charger les outils Fordead, l\u2019organisation des fichiers doit respecter le sch\u00e9ma suivant : ..\\FORMATION_SANTE_FORETS\\B_PROGRAMS \u2514\u2500\u2500\u2500Libraries \u2514\u2500\u2500\u2500fordead_package \u251c\u2500\u2500\u2500docs \u2502 \u2514\u2500\u2500\u2500user_guides \u2502 \u2514\u2500\u2500\u2500Diagrams \u251c\u2500\u2500\u2500examples \u2514\u2500\u2500\u2500fordead \u251c\u2500\u2500\u2500steps \u2514\u2500\u2500\u2500visualisation - Toujours dans le terminal Anaconda, acc\u00e9der au r\u00e9pertoire fordead_package bash= cd fordead_package - le fichier permettant de param\u00e9trer l\u2019environnement virtuel est directement int\u00e9gr\u00e9 dans cr\u00e9er un nouvel environnement avec la commande suivante (la cr\u00e9ation et le param\u00e9trage du nouvel environnement peut demander quelques minutes et n\u00e9cessite le t\u00e9l\u00e9chargement d\u2019un certain nombre de packages): bash= conda env create --name ForDeadEnv conda activate ForDeadEnv pip install . - Si QGIS n\u2019est pas install\u00e9 sur votre poste de travail, ou si vous devez le mettre \u00e0 jour, il est possible d\u2018installer QGIS 3.16 dans l\u2019environnement conda \u00e0 l'aide de la commande suivante: bash= conda install -c conda-forge >qgis=3.16 - Enfin, pour la production de figures avec python au cours de la formation, la librairie matplotlib pourra \u00eatre utilis\u00e9e : bash= conda install matplotlib 4. Fiche C : T\u00e9l\u00e9chargement des donn\u00e9es Sentinel-2 4.1. Exploration des donn\u00e9es disponibles La plateforme de visualisation Sentinel-Hub permet d\u2019explorer les donn\u00e9es Sentinel-2 disponibles de mani\u00e8re rapide et intuitive. Ses fonctionnalit\u00e9s de base permettent des requ\u00eates spatiales et temporelles, et la visualisation des diff\u00e9rentes acquisitions disponibles pour un niveau d'enneigement des tuiles Sentinel-2. Dans le cadre de ce TD, nous allons utiliser deux images acquises \u00e0 un an d\u2019intervalle et comprenant un massif forestier situ\u00e9 \u00e0 proximit\u00e9 de La Longine (Haute-Sa\u00f4ne, France) et compris dans la zone d'\u00e9tude d\u00e9finie dans le fichier vectoriel suivant: <MyWorkingDirectory>\\FORMATION_SANTE_FORETS\\A_DATA\\VECTOR\\ ZONE_ETUDE\\ZoneEtude.shp Sentinel-Hub permet d\u2019effectuer des requ\u00eates en prenant en compte une localit\u00e9 g\u00e9ographique, une limite sup\u00e9rieure de date, et un niveau d\u2019ennuagement. Plusieurs types de visualisation (RGB, indices spectraux...) et autres r\u00e9glages sont aussi disponibles via l\u2019interface. Les images correspondent \u00e0 la tuile T31UGP et les dates d\u2019acquisition sont le 23 Ao\u00fbt 2017 et le 23 Ao\u00fbt 2018 . 4.2. Installation des outils de t\u00e9l\u00e9chargement Sentinel-2 4.2.1. Script de t\u00e9l\u00e9chargement sur la plateforme Theia Le t\u00e9l\u00e9chargement des donn\u00e9es disponibles sur le portail THEIA s\u2019appuie sur l\u2019application du script python \u2018theia_download\u2019 d\u00e9velopp\u00e9 par Olivier Hagolle (CESBIO) et disponible librement sur son d\u00e9p\u00f4t git . Le script permet d'acc\u00e9der aux donn\u00e9es THEIA propos\u00e9es pour plusieurs capteurs, mais nous nous focaliserons ici sur les donn\u00e9es Sentinel-2. T\u00e9l\u00e9charger l\u2019archive associ\u00e9e \u00e0 theia_download et placer les fichiers d\u00e9compress\u00e9s dans l'arborescence : FORMATION_SANTE_FORETS/B_PROGRAMS/Libraries/theia_download Figure 7. T\u00e9l\u00e9chargement du theia_download depuis https://github.com/olivierhagolle/theia_download La page github permet de prendre connaissance des lignes de commandes utiles pour t\u00e9l\u00e9charger les donn\u00e9es THEIA. Nous d\u00e9taillerons la proc\u00e9dure de t\u00e9l\u00e9chargement dans la section d\u00e9di\u00e9e. 4.2.2. Script de t\u00e9l\u00e9chargement sur la plateforme PEPS Le t\u00e9l\u00e9chargement des donn\u00e9es disponibles sur le portail PEPS s\u2019appuie sur l\u2019application du script python \u2018peps_download\u2019 d\u00e9velopp\u00e9 par Olivier Hagolle (CESBIO), modifi\u00e9e et int\u00e9gr\u00e9e dans un package d\u00e9velopp\u00e9 par Florian de Boissieu. Les sources du package sont disponibles sur gitlab , et le package int\u00e8gre en plus des fonctionnalit\u00e9s initiales, la possibilit\u00e9 de t\u00e9l\u00e9charger les donn\u00e9es Sentinel-2 en d\u00e9finissant l\u2019emprise g\u00e9ographique directement \u00e0 partir d\u2019un polygone d\u00e9fini par un shapefile. Le d\u00e9veloppement sous forme de package permet d\u2019installer directement les fonctions associ\u00e9es dans l'environnement virtuel python, avec l\u2019instruction suivante: bash= pip install git+https://github.com/floriandeboissieu/peps_download.git@shapefile La page gitlab permet de prendre connaissance des instructions python utiles pour t\u00e9l\u00e9charger les donn\u00e9es PEPS. Nous d\u00e9taillerons la proc\u00e9dure de t\u00e9l\u00e9chargement dans la section d\u00e9di\u00e9e (cf. section 4.5). 4.3. Utilisation des scripts de t\u00e9l\u00e9chargement automatis\u00e9 La d\u00e9tection de changements repose sur l\u2019utilisation conjointe d\u2019au moins deux images satellitaires acquises \u00e0 des dates diff\u00e9rentes. Les images optiques acquises par les satellites Sentinel-2 (S2), op\u00e9r\u00e9s dans le cadre du programme Copernicus de l\u2019Agence Spatiale Europ\u00e9enne (ESA), sont \u00e0 ce jour les mieux adapt\u00e9es pour effectuer ce type d\u2019analyse. Pour cette premi\u00e8re approche, deux images S2 acquises sur une m\u00eame zone \u00e0 deux dates diff\u00e9rentes seront t\u00e9l\u00e9charg\u00e9es. Les pr\u00e9traitements ainsi que la classification des changements reposent sur les outils propos\u00e9s par d\u00e9faut dans le logiciel QGis. 4.4. Donn\u00e9es THEIA Les donn\u00e9es Sentinel-2 peuvent \u00eatre t\u00e9l\u00e9charg\u00e9es depuis le portail web THEIA, une fois identifi\u00e9es. Il est aussi possible d\u2019utiliser l\u2019outil de t\u00e9l\u00e9chargement automatique theia_download s'appuyant sur python et l'utilitaire Curl. Il marche aussi bien sur Linux que sur Windows. L'utilisation de theia_download est pr\u00e9sent\u00e9e dans le fichier README.md . Dans le cadre de notre \u00e9tude, nous allons lancer le t\u00e9l\u00e9chargement des images en appliquant le param\u00e9trage correspondant aux acquisitions identifi\u00e9es pr\u00e9c\u00e9demment. 4.4.1. Param\u00e9trage de theia_download Ouvrez le fichier \u2018config_theia.cfg\u2019 situ\u00e9 \u00e0 cet emplacement : FORMATION_SANTE_FORETS/B_PROGRAMS/theia_download-master Entrez votre adresse mail et votre mot de passe THEIA dans les emplacements d\u00e9di\u00e9s. 4.4.2. Requ\u00eate pour t\u00e9l\u00e9chargement Depuis un terminal anaconda (avec environnement virtuel activ\u00e9e), placez-vous dans le r\u00e9pertoire theia_download-master lancez la commande suivante : bash= python ./theia_download.py -t T31UGP -c SENTINEL2 -a config_theia.cfg -d 2017-08-23 -f 2017-08-24 --write_dir ../../A_DATA/RASTER/THEIA les param\u00e8tres de la commande sont : -t : num\u00e9ro de la tuile Sentinel-2 (la grille de tuiles Sentinel-2 est disponible sur le site de l'ESA , et peut se visualiser avec Google Earth Engine par exemple) -c : nom du capteur -a : chemin d'acc\u00e8s au fichier de configuration (contient les identifiant et mot de passe) -d : date de d\u00e9but -f : date de fin (d\u00e9finir J+1 si la requ\u00eate porte sur un jour pr\u00e9cis) --level : niveau de pr\u00e9-traitement --write_dir : chemin (absolu ou relatif) du r\u00e9pertoire dans lequel seront \u00e9crites les donn\u00e9es. Adapter la commande de mani\u00e8re \u00e0 t\u00e9l\u00e9charger l\u2019image acquise le 23 Ao\u00fbt 2018. A L'issue du t\u00e9l\u00e9chargement, deux fichiers Zip sont t\u00e9l\u00e9charg\u00e9s : SENTINEL2A_20180823-103535-335_L2A_T31UGP_D.zip SENTINEL2B_20170823-103018-461_L2A_T31UGP_D.zip En cas de probl\u00e8me dans l\u2019utilisation des scripts de t\u00e9l\u00e9chargement automatique, les archives ZIP des images sont disponibles en t\u00e9l\u00e9chargement durant la formation aux liens suivants : http://filez.teledetection.fr/sacz5lw (expiration : 01/02/2021) http://filez.teledetection.fr/huq3d (expiration : 01/02/2021) 4.5. Donn\u00e9es PEPS Les donn\u00e9es PEPS peuvent \u00eatre t\u00e9l\u00e9charg\u00e9es en appliquant le m\u00eame type de requ\u00eate depuis un terminal Anaconda, en lan\u00e7ant le script peps_download.py t\u00e9l\u00e9chargeable en ligne (apr\u00e8s configuration du fichier d\u2019identification), ou bien \u00e0 partir d\u2019un script python directement apr\u00e8s avoir import\u00e9 la librairie peps_download. Dans le terminal Anaconda, activer l\u2019environnement de travail : conda activate ForDeadEnv D\u00e9marrer une console Python en tapant sur l\u2019invite de commande : Python Lorsque Python est lanc\u00e9, l\u2019invite de commande d\u00e9bute d\u00e9sormais avec les symboles suivants : >>> Figure 8. Activation de la console Python. Importer le module peps_download en saisissant l\u2019instruction suivante : python= from peps_download import peps_download Si aucun message d\u2019erreur appara\u00eet, le module est charg\u00e9 correctement. La fonction peps_download permet de lister et de t\u00e9l\u00e9charger automatiquement les donn\u00e9es Sentinel-2 sur la plateforme PEPS. Pour conna\u00eetre ses param\u00e8tres de configuration, il est possible de saisir l\u2019instruction suivante : python= print(peps_download.__doc__) Ici, nous souhaitons t\u00e9l\u00e9charger deux images Sentinel-2 acquises le 23/08/2017 et le 23/08/2018 sur une emprise d\u00e9finie par le fichier vectoriel de la zone d\u2019\u00e9tude. Pour lister les produits disponibles, saisir l\u2019instruction suivante (exemple pour l\u2019image de 2017) : python= peps_download( 'A_DATA/RASTER/THEIA', auth='./config.txt', collection='S2ST', start_date='2017-08-23', end_date='2017-08-24', shape='./A_DATA/VECTOR/ZONE_ETUDE>/ZoneEtude.shp', product_type='S2MSI2A', no_download=True ) Pour t\u00e9l\u00e9charger les produits, saisir l\u2019instruction suivante : python= peps_download( 'A_DATA/RASTER/THEIA', auth='./config.txt', collection='S2ST', start_date='2017-08-23', end_date='2018-08-24', shape='./A_DATA/VECTOR/ZONE_ETUDE/ZoneEtude.shp', product_type='S2MSI2A', max_trials=10, wait=1, no_download=False, extract=True ) Si la zone d\u2019\u00e9tude est \u00e0 cheval sur au moins deux tuiles, il est possible d\u2019ajouter le param\u00e8tre tile=<code_tuile> pour filtrer les r\u00e9sultats. Pour information, les param\u00e8tres max_trials et wait permettent de relancer \u00e0 pas de temps r\u00e9gulier les requ\u00eates de t\u00e9l\u00e9chargement. En effet, les archives Sentinel-2 peuvent \u00eatre stock\u00e9es sur bande. Lorsque ces images sont appel\u00e9es, elles doivent \u00eatre transf\u00e9r\u00e9es sur disque avant d\u2019\u00eatre t\u00e9l\u00e9chargeables. Cette proc\u00e9dure, transparente pour l\u2019utilisateur, n\u00e9cessite un peu de temps, une dizaine de minutes environ.","title":"01 Prerequis Data Soft"},{"location":"docs/01_Prerequis_data_soft/#prerequis-pour-la-formation-detecter-le-changement-en-foret-avec-des-images-satellitaires","text":"2. Fiche A : Pr\u00e9requis 2.1. Organisation du r\u00e9pertoire de travail 2.2. Inscriptions requises 2.3. Logiciels utilis\u00e9s 3. Fiche B : Installation du paquet Fordead 3.1. Mise en place d\u2019un environnement virtuel Python 4. Fiche C : T\u00e9l\u00e9chargement des donn\u00e9es Sentinel-2 4.1. Exploration des donn\u00e9es disponibles 4.2. Installation des outils de t\u00e9l\u00e9chargement Sentinel-2 4.3. Utilisation des scripts de t\u00e9l\u00e9chargement automatis\u00e9 4.4. Donn\u00e9es THEIA 4.5. Donn\u00e9es PEPS","title":" Pr\u00e9requis pour la formation \"D\u00e9tecter le changement en for\u00eat avec des images satellitaires\" "},{"location":"docs/01_Prerequis_data_soft/#2-fiche-a-prerequis","text":"","title":"2. Fiche A : Pr\u00e9requis"},{"location":"docs/01_Prerequis_data_soft/#21-organisation-du-repertoire-de-travail","text":"Afin de faciliter la mise en application des m\u00e9thodes qui seront \u00e9tudi\u00e9es et l\u2019assistance si n\u00e9cessaire, nous proposons de nous appuyer sur une arborescence commune permettant d\u2019identifier facilement l\u2019emplacement relatif aux donn\u00e9es, aux codes utilis\u00e9s ou d\u00e9velopp\u00e9s, et aux r\u00e9sultats des diff\u00e9rents traitements.","title":"2.1. Organisation du r\u00e9pertoire de travail"},{"location":"docs/01_Prerequis_data_soft/#211-identification-du-repertoire-de-travail","text":"Les images Sentinel-2 et les produits issus de leur traitement \u00e9tant relativement volumineux, il est n\u00e9cessaire de s\u2019assurer d\u2019un espace disque disponible sup\u00e9rieur \u00e0 10 Go . Nous recommandons de travailler sur votre disque dur local (C:) ou une partition de ce disque dur local . Nous d\u00e9conseillons l\u2019utilisation d\u2019un outil de stockage externe (cl\u00e9 USB, disque dur externe) ou d\u2019un espace disque situ\u00e9 sur un r\u00e9seau partag\u00e9, pour des raisons de performances.","title":"2.1.1. Identification du r\u00e9pertoire de travail"},{"location":"docs/01_Prerequis_data_soft/#212-definition-du-repertoire-de-travail","text":"Une fois d\u00e9fini l\u2019emplacement du r\u00e9pertoire de travail que vous utiliserez durant la formation, identifiez le chemin absolu \u00e0 l'aide d\u2019un explorateur (clic-droit sur la barre de chemin, et \u2018copier l\u2019adresse en tant que texte\u2019). Figure 1. D\u00e9finition du r\u00e9pertoire de travail. Le chemin absolu correspondant ( C:\\Users\\Feret dans l\u2019exemple ci-dessus) sera alors identifi\u00e9 comme <MyWorkingDirectory> dans la suite du document.","title":"2.1.2. D\u00e9finition du r\u00e9pertoire de travail"},{"location":"docs/01_Prerequis_data_soft/#213-recuperation-de-larborescence-et-des-donnees","text":"Afin de simplifier l\u2019organisation des donn\u00e9es et de faciliter l\u2019assistance si n\u00e9cessaire, une arborescence de r\u00e9pertoires comprenant les donn\u00e9es initiales, les programmes et les r\u00e9sultats des traitements, a \u00e9t\u00e9 d\u00e9finie. Cette arborescence est contenue dans une archive \u00e0 t\u00e9l\u00e9charger ici : https://filesender.renater.fr/?s=download&token=881484a1-d260-43ad-a15a-cbe612c96edf (expiration : 05/02/2021) Une fois l\u2019archive copi\u00e9e dans <MyWorkingDirectory> , la d\u00e9compresser. L\u2019arborescence des r\u00e9pertoires est organis\u00e9e de la fa\u00e7on suivante: Figure 2. Arborescence de fichiers utilis\u00e9e lors de la formation. Le travail \u00e0 r\u00e9aliser s\u2019appuie sur des donn\u00e9es Sentinel-2 dont le t\u00e9l\u00e9chargement est abord\u00e9 dans la section d\u00e9di\u00e9e, mais aussi d\u2019un certain nombre d\u2019informations th\u00e9matiques sous forme vectorielle, disponibles par d\u00e9faut dans le r\u00e9pertoire suivant : FORMATION_SANTE_FORETS/A_DATA/VECTOR Afin de permettre une manipulation plus facile des donn\u00e9es et d'\u00e9viter les contraintes associ\u00e9es aux performances limit\u00e9es des machines, l\u2019exercice se focalise sur deux zones d\u2019\u00e9tude restreintes.","title":"2.1.3. R\u00e9cup\u00e9ration de l\u2019arborescence et des donn\u00e9es"},{"location":"docs/01_Prerequis_data_soft/#22-inscriptions-requises","text":"","title":"2.2. Inscriptions requises"},{"location":"docs/01_Prerequis_data_soft/#221-inscription-aux-portails-de-distribution-des-donnees-sentinel-2","text":"Il existe plusieurs portails de distribution des donn\u00e9es Sentinel-2. Parmi ces portails, nous allons d\u00e9crire l'acc\u00e8s aux deux portails : THEIA , qui donne acc\u00e8s aux donn\u00e9es Sentinel-2 individuelles apr\u00e8s correction des effets atmosph\u00e9riques et topographiques \u00e0 l'aide de la cha\u00eene de traitement MAJA d\u00e9velopp\u00e9e par le CESBIO PEPS , qui est un miroir fran\u00e7ais mis en place par le CNES du portail officiel d'acc\u00e8s au donn\u00e9es de l\u2019ESA ( scihub ) Le t\u00e9l\u00e9chargement des donn\u00e9es n\u00e9cessite une inscription pr\u00e9alable qui permet d\u2019obtenir un ++identifiant++ et un ++mot de passe++, qui seront requis lors de l\u2019application des scripts de t\u00e9l\u00e9chargement automatiques.","title":"2.2.1. Inscription aux portails de distribution des donn\u00e9es Sentinel-2"},{"location":"docs/01_Prerequis_data_soft/#222-inscription-a-gitlab","text":"Un compte gitlab est n\u00e9cessaire pour avoir acc\u00e8s aux d\u00e9veloppements en cours, en attendant la mise en place d\u2019un package finalis\u00e9 qui sera alors ouvert au public. Apr\u00e8s inscription sur le site de gitlab , contactez Rapha\u00ebl Dutrieux afin de donner votre identifiant gitlab et avoir acc\u00e8s aux diff\u00e9rents d\u00e9veloppements actuellement en acc\u00e8s priv\u00e9.","title":"2.2.2. Inscription \u00e0 gitlab"},{"location":"docs/01_Prerequis_data_soft/#23-logiciels-utilises","text":"Dans un premier temps, les traitements seront r\u00e9alis\u00e9s \u00e0 l\u2019aide du logiciel QGis, logiciel adapt\u00e9 pour traiter un jeu de donn\u00e9es satellitaires r\u00e9duit. La seconde partie de cette session exploite les outils d\u00e9velopp\u00e9s en Python par l\u2019UMR TETIS. Ces codes n\u00e9cessitent d\u2019installer un environnement d\u00e9di\u00e9. la plateforme de d\u00e9veloppement Anaconda qui permettra de mettre en place un environnement virtuel python 3 d\u00e9di\u00e9 aux applications vues lors de la formation et comprenant l\u2019ensemble des librairies et d\u00e9pendances n\u00e9cessaires. le logiciel SIG QGIS (minimum version 3.10.13 LTR). Si QGIS n\u2019est pas install\u00e9 sur votre machine, les instructions sont fournies dans la suite du TD pour installer la version la plus r\u00e9cente dans l\u2019environnement virtuel anaconda qui sera cr\u00e9\u00e9.","title":"2.3. Logiciels utilis\u00e9s"},{"location":"docs/01_Prerequis_data_soft/#231-installation-danaconda","text":"T\u00e9l\u00e9charger Anaconda (choisir la version en fonction de votre syst\u00e8me) sur la page web suivante : https://www.anaconda.com/products/individual Suivre les instructions d\u2019installation d\u00e9crites sur la page web suivante : pour Windows : https://docs.anaconda.com/anaconda/install/windows/ pour Linux : https://docs.anaconda.com/anaconda/install/linux/","title":"2.3.1. Installation d\u2019Anaconda"},{"location":"docs/01_Prerequis_data_soft/#232-installation-de-git","text":"Git est un outil libre et open source permettant la gestion des versions des codes disponibles sur un d\u00e9p\u00f4t. Dans le cadre de cette formation, un certain nombre d\u2019outils ont \u00e9t\u00e9 mis \u00e0 disposition sur gitlab, et l\u2019installation de git vous permettra de r\u00e9cup\u00e9rer les derni\u00e8res versions de ces codes, ainsi que d\u2019effectuer les mises \u00e0 jour au fur et \u00e0 mesure des d\u00e9veloppements. Une fois anaconda install\u00e9, vous pouvez installer git simplement en suivant la proc\u00e9dure suivante : Ouvrez une invite de commande Anaconda (Anaconda Prompt) en appuyant sur la touche \u2018Windows\u2019 de votre clavier (on suppose que les utilisateurs de Linux sont familiers avec les terminaux), et commencez \u00e0 taper \u2018anaconda\u2019 pour s\u00e9lectionner \u2018Anaconda Prompt\u2019 Figure 3. Ouvrir une invite de commande Anaconda. L\u2019invite de commande s\u2019ouvre alors en pointant sur le r\u00e9pertoire qui se trouve \u00eatre <MyWorkingDirectory> . C\u2019est quand m\u00eame bien fait, mais n\u2019allez pas croire, c\u2019est un hasard\u2026 C\u2019est le r\u00e9pertoire par d\u00e9faut de l\u2019utilisateur de la machine. Figure 4. Anaconda Prompt. Vous pouvez alors taper (ou copier / coller) l\u2019instruction suivante dans l\u2019invite de commande: ```bash= conda install -c anaconda git ````","title":"2.3.2. Installation de git"},{"location":"docs/01_Prerequis_data_soft/#3-fiche-b-installation-du-paquet-fordead","text":"","title":"3. Fiche B : Installation du paquet Fordead"},{"location":"docs/01_Prerequis_data_soft/#31-mise-en-place-dun-environnement-virtuel-python","text":"La plateforme de d\u00e9veloppement Anaconda permet de cr\u00e9er des \u2018environnements virtuels\u2019 de d\u00e9veloppement python sp\u00e9cifiques et ind\u00e9pendants d\u2019autres environnements python cohabitant sur une m\u00eame machine. Ces environnements virtuels sont particuli\u00e8rement int\u00e9ressants pour s\u2019assurer de la stabilit\u00e9 des applications utilis\u00e9es dans diff\u00e9rents projets et pouvant aboutir \u00e0 des incompatibilit\u00e9s de d\u00e9pendance si le m\u00eame environnement python \u00e9tait utilis\u00e9. Dans le cadre de la formation, nous avons initi\u00e9 le d\u00e9veloppement du package python \u2018 fordead \u2019, qui sera principalement utilis\u00e9 pour appliquer la m\u00e9thode de d\u00e9tection des foyers de scolytes par analyse de s\u00e9ries temporelles Sentinel-2. La page de pr\u00e9sentation de fordead d\u00e9crit les diff\u00e9rentes \u00e9tapes pour la mise en place de cet environnement virtuel, rappel\u00e9es ici : Rechercher le chemin absolu d\u2019acc\u00e8s au r\u00e9pertoire suivant : <MyWorkingDirectory>\\FORMATION_SANTE_FORETS\\B_PROGRAMS\\Libraries Depuis un terminal anaconda (Menu D\u00e9marrer \u2192 Anaconda prompt), si votre r\u00e9pertoire de travail est situ\u00e9 sur une partition diff\u00e9rente de \u2018C:\u2019, par exemple \u2018D:\u2019 commencez par taper : bash= D: Saisir alors l\u2019instruction suivante pour se rendre sur le r\u00e9pertoire suivant : bash= cd <MyWorkingDirectory>\\FORMATION_SANTE_FORETS\\B_PROGRAMS\\Libraries Cloner en local le d\u00e9p\u00f4t Git du projet fordead_package de l\u2019UMR Tetis. Deux solutions sont possibles, au choix : Option 1. Depuis le terminal en saisissant la commande suivante : bash= git clone https://gitlab.com/raphael.dutrieux/fordead_package.git Suite au lancement de cette commande, les informations suivantes devraient appara\u00eetre sur le terminal : Figure 5. Retours de la commande git clone. Option 2. Depuis le site web de gitlab : Acc\u00e9der au projet gitlab : https://gitlab.com/raphael.dutrieux/fordead_package T\u00e9l\u00e9charger l\u2019ensemble des codes dans une archive zip en cliquant sur le bouton Figure 6. T\u00e9l\u00e9chargement manuelle depuis le site Gitlab. D\u00e9compresser l\u2019archive zip t\u00e9l\u00e9charg\u00e9e dans le r\u00e9pertoire des programmes : <MyWorkingDirectory>\\FORMATION_SANTE_FORETS\\B_PROGRAMS\\Libraries Quelle que soit la solution choisie pour t\u00e9l\u00e9charger les outils Fordead, l\u2019organisation des fichiers doit respecter le sch\u00e9ma suivant : ..\\FORMATION_SANTE_FORETS\\B_PROGRAMS \u2514\u2500\u2500\u2500Libraries \u2514\u2500\u2500\u2500fordead_package \u251c\u2500\u2500\u2500docs \u2502 \u2514\u2500\u2500\u2500user_guides \u2502 \u2514\u2500\u2500\u2500Diagrams \u251c\u2500\u2500\u2500examples \u2514\u2500\u2500\u2500fordead \u251c\u2500\u2500\u2500steps \u2514\u2500\u2500\u2500visualisation - Toujours dans le terminal Anaconda, acc\u00e9der au r\u00e9pertoire fordead_package bash= cd fordead_package - le fichier permettant de param\u00e9trer l\u2019environnement virtuel est directement int\u00e9gr\u00e9 dans cr\u00e9er un nouvel environnement avec la commande suivante (la cr\u00e9ation et le param\u00e9trage du nouvel environnement peut demander quelques minutes et n\u00e9cessite le t\u00e9l\u00e9chargement d\u2019un certain nombre de packages): bash= conda env create --name ForDeadEnv conda activate ForDeadEnv pip install . - Si QGIS n\u2019est pas install\u00e9 sur votre poste de travail, ou si vous devez le mettre \u00e0 jour, il est possible d\u2018installer QGIS 3.16 dans l\u2019environnement conda \u00e0 l'aide de la commande suivante: bash= conda install -c conda-forge >qgis=3.16 - Enfin, pour la production de figures avec python au cours de la formation, la librairie matplotlib pourra \u00eatre utilis\u00e9e : bash= conda install matplotlib","title":"3.1. Mise en place d\u2019un environnement virtuel Python"},{"location":"docs/01_Prerequis_data_soft/#4-fiche-c-telechargement-des-donnees-sentinel-2","text":"","title":"4. Fiche C : T\u00e9l\u00e9chargement des donn\u00e9es Sentinel-2"},{"location":"docs/01_Prerequis_data_soft/#41-exploration-des-donnees-disponibles","text":"La plateforme de visualisation Sentinel-Hub permet d\u2019explorer les donn\u00e9es Sentinel-2 disponibles de mani\u00e8re rapide et intuitive. Ses fonctionnalit\u00e9s de base permettent des requ\u00eates spatiales et temporelles, et la visualisation des diff\u00e9rentes acquisitions disponibles pour un niveau d'enneigement des tuiles Sentinel-2. Dans le cadre de ce TD, nous allons utiliser deux images acquises \u00e0 un an d\u2019intervalle et comprenant un massif forestier situ\u00e9 \u00e0 proximit\u00e9 de La Longine (Haute-Sa\u00f4ne, France) et compris dans la zone d'\u00e9tude d\u00e9finie dans le fichier vectoriel suivant: <MyWorkingDirectory>\\FORMATION_SANTE_FORETS\\A_DATA\\VECTOR\\ ZONE_ETUDE\\ZoneEtude.shp Sentinel-Hub permet d\u2019effectuer des requ\u00eates en prenant en compte une localit\u00e9 g\u00e9ographique, une limite sup\u00e9rieure de date, et un niveau d\u2019ennuagement. Plusieurs types de visualisation (RGB, indices spectraux...) et autres r\u00e9glages sont aussi disponibles via l\u2019interface. Les images correspondent \u00e0 la tuile T31UGP et les dates d\u2019acquisition sont le 23 Ao\u00fbt 2017 et le 23 Ao\u00fbt 2018 .","title":"4.1. Exploration des donn\u00e9es disponibles"},{"location":"docs/01_Prerequis_data_soft/#42-installation-des-outils-de-telechargement-sentinel-2","text":"","title":"4.2. Installation des outils de t\u00e9l\u00e9chargement Sentinel-2"},{"location":"docs/01_Prerequis_data_soft/#421-script-de-telechargement-sur-la-plateforme-theia","text":"Le t\u00e9l\u00e9chargement des donn\u00e9es disponibles sur le portail THEIA s\u2019appuie sur l\u2019application du script python \u2018theia_download\u2019 d\u00e9velopp\u00e9 par Olivier Hagolle (CESBIO) et disponible librement sur son d\u00e9p\u00f4t git . Le script permet d'acc\u00e9der aux donn\u00e9es THEIA propos\u00e9es pour plusieurs capteurs, mais nous nous focaliserons ici sur les donn\u00e9es Sentinel-2. T\u00e9l\u00e9charger l\u2019archive associ\u00e9e \u00e0 theia_download et placer les fichiers d\u00e9compress\u00e9s dans l'arborescence : FORMATION_SANTE_FORETS/B_PROGRAMS/Libraries/theia_download Figure 7. T\u00e9l\u00e9chargement du theia_download depuis https://github.com/olivierhagolle/theia_download La page github permet de prendre connaissance des lignes de commandes utiles pour t\u00e9l\u00e9charger les donn\u00e9es THEIA. Nous d\u00e9taillerons la proc\u00e9dure de t\u00e9l\u00e9chargement dans la section d\u00e9di\u00e9e.","title":"4.2.1. Script de t\u00e9l\u00e9chargement sur la plateforme Theia"},{"location":"docs/01_Prerequis_data_soft/#422-script-de-telechargement-sur-la-plateforme-peps","text":"Le t\u00e9l\u00e9chargement des donn\u00e9es disponibles sur le portail PEPS s\u2019appuie sur l\u2019application du script python \u2018peps_download\u2019 d\u00e9velopp\u00e9 par Olivier Hagolle (CESBIO), modifi\u00e9e et int\u00e9gr\u00e9e dans un package d\u00e9velopp\u00e9 par Florian de Boissieu. Les sources du package sont disponibles sur gitlab , et le package int\u00e8gre en plus des fonctionnalit\u00e9s initiales, la possibilit\u00e9 de t\u00e9l\u00e9charger les donn\u00e9es Sentinel-2 en d\u00e9finissant l\u2019emprise g\u00e9ographique directement \u00e0 partir d\u2019un polygone d\u00e9fini par un shapefile. Le d\u00e9veloppement sous forme de package permet d\u2019installer directement les fonctions associ\u00e9es dans l'environnement virtuel python, avec l\u2019instruction suivante: bash= pip install git+https://github.com/floriandeboissieu/peps_download.git@shapefile La page gitlab permet de prendre connaissance des instructions python utiles pour t\u00e9l\u00e9charger les donn\u00e9es PEPS. Nous d\u00e9taillerons la proc\u00e9dure de t\u00e9l\u00e9chargement dans la section d\u00e9di\u00e9e (cf. section 4.5).","title":"4.2.2. Script de t\u00e9l\u00e9chargement sur la plateforme PEPS"},{"location":"docs/01_Prerequis_data_soft/#43-utilisation-des-scripts-de-telechargement-automatise","text":"La d\u00e9tection de changements repose sur l\u2019utilisation conjointe d\u2019au moins deux images satellitaires acquises \u00e0 des dates diff\u00e9rentes. Les images optiques acquises par les satellites Sentinel-2 (S2), op\u00e9r\u00e9s dans le cadre du programme Copernicus de l\u2019Agence Spatiale Europ\u00e9enne (ESA), sont \u00e0 ce jour les mieux adapt\u00e9es pour effectuer ce type d\u2019analyse. Pour cette premi\u00e8re approche, deux images S2 acquises sur une m\u00eame zone \u00e0 deux dates diff\u00e9rentes seront t\u00e9l\u00e9charg\u00e9es. Les pr\u00e9traitements ainsi que la classification des changements reposent sur les outils propos\u00e9s par d\u00e9faut dans le logiciel QGis.","title":"4.3. Utilisation des scripts de t\u00e9l\u00e9chargement automatis\u00e9"},{"location":"docs/01_Prerequis_data_soft/#44-donnees-theia","text":"Les donn\u00e9es Sentinel-2 peuvent \u00eatre t\u00e9l\u00e9charg\u00e9es depuis le portail web THEIA, une fois identifi\u00e9es. Il est aussi possible d\u2019utiliser l\u2019outil de t\u00e9l\u00e9chargement automatique theia_download s'appuyant sur python et l'utilitaire Curl. Il marche aussi bien sur Linux que sur Windows. L'utilisation de theia_download est pr\u00e9sent\u00e9e dans le fichier README.md . Dans le cadre de notre \u00e9tude, nous allons lancer le t\u00e9l\u00e9chargement des images en appliquant le param\u00e9trage correspondant aux acquisitions identifi\u00e9es pr\u00e9c\u00e9demment.","title":"4.4. Donn\u00e9es THEIA"},{"location":"docs/01_Prerequis_data_soft/#441-parametrage-de-theia_download","text":"Ouvrez le fichier \u2018config_theia.cfg\u2019 situ\u00e9 \u00e0 cet emplacement : FORMATION_SANTE_FORETS/B_PROGRAMS/theia_download-master Entrez votre adresse mail et votre mot de passe THEIA dans les emplacements d\u00e9di\u00e9s.","title":"4.4.1. Param\u00e9trage de theia_download"},{"location":"docs/01_Prerequis_data_soft/#442-requete-pour-telechargement","text":"Depuis un terminal anaconda (avec environnement virtuel activ\u00e9e), placez-vous dans le r\u00e9pertoire theia_download-master lancez la commande suivante : bash= python ./theia_download.py -t T31UGP -c SENTINEL2 -a config_theia.cfg -d 2017-08-23 -f 2017-08-24 --write_dir ../../A_DATA/RASTER/THEIA les param\u00e8tres de la commande sont : -t : num\u00e9ro de la tuile Sentinel-2 (la grille de tuiles Sentinel-2 est disponible sur le site de l'ESA , et peut se visualiser avec Google Earth Engine par exemple) -c : nom du capteur -a : chemin d'acc\u00e8s au fichier de configuration (contient les identifiant et mot de passe) -d : date de d\u00e9but -f : date de fin (d\u00e9finir J+1 si la requ\u00eate porte sur un jour pr\u00e9cis) --level : niveau de pr\u00e9-traitement --write_dir : chemin (absolu ou relatif) du r\u00e9pertoire dans lequel seront \u00e9crites les donn\u00e9es. Adapter la commande de mani\u00e8re \u00e0 t\u00e9l\u00e9charger l\u2019image acquise le 23 Ao\u00fbt 2018. A L'issue du t\u00e9l\u00e9chargement, deux fichiers Zip sont t\u00e9l\u00e9charg\u00e9s : SENTINEL2A_20180823-103535-335_L2A_T31UGP_D.zip SENTINEL2B_20170823-103018-461_L2A_T31UGP_D.zip En cas de probl\u00e8me dans l\u2019utilisation des scripts de t\u00e9l\u00e9chargement automatique, les archives ZIP des images sont disponibles en t\u00e9l\u00e9chargement durant la formation aux liens suivants : http://filez.teledetection.fr/sacz5lw (expiration : 01/02/2021) http://filez.teledetection.fr/huq3d (expiration : 01/02/2021)","title":"4.4.2. Requ\u00eate pour t\u00e9l\u00e9chargement"},{"location":"docs/01_Prerequis_data_soft/#45-donnees-peps","text":"Les donn\u00e9es PEPS peuvent \u00eatre t\u00e9l\u00e9charg\u00e9es en appliquant le m\u00eame type de requ\u00eate depuis un terminal Anaconda, en lan\u00e7ant le script peps_download.py t\u00e9l\u00e9chargeable en ligne (apr\u00e8s configuration du fichier d\u2019identification), ou bien \u00e0 partir d\u2019un script python directement apr\u00e8s avoir import\u00e9 la librairie peps_download. Dans le terminal Anaconda, activer l\u2019environnement de travail : conda activate ForDeadEnv D\u00e9marrer une console Python en tapant sur l\u2019invite de commande : Python Lorsque Python est lanc\u00e9, l\u2019invite de commande d\u00e9bute d\u00e9sormais avec les symboles suivants : >>> Figure 8. Activation de la console Python. Importer le module peps_download en saisissant l\u2019instruction suivante : python= from peps_download import peps_download Si aucun message d\u2019erreur appara\u00eet, le module est charg\u00e9 correctement. La fonction peps_download permet de lister et de t\u00e9l\u00e9charger automatiquement les donn\u00e9es Sentinel-2 sur la plateforme PEPS. Pour conna\u00eetre ses param\u00e8tres de configuration, il est possible de saisir l\u2019instruction suivante : python= print(peps_download.__doc__) Ici, nous souhaitons t\u00e9l\u00e9charger deux images Sentinel-2 acquises le 23/08/2017 et le 23/08/2018 sur une emprise d\u00e9finie par le fichier vectoriel de la zone d\u2019\u00e9tude. Pour lister les produits disponibles, saisir l\u2019instruction suivante (exemple pour l\u2019image de 2017) : python= peps_download( 'A_DATA/RASTER/THEIA', auth='./config.txt', collection='S2ST', start_date='2017-08-23', end_date='2017-08-24', shape='./A_DATA/VECTOR/ZONE_ETUDE>/ZoneEtude.shp', product_type='S2MSI2A', no_download=True ) Pour t\u00e9l\u00e9charger les produits, saisir l\u2019instruction suivante : python= peps_download( 'A_DATA/RASTER/THEIA', auth='./config.txt', collection='S2ST', start_date='2017-08-23', end_date='2018-08-24', shape='./A_DATA/VECTOR/ZONE_ETUDE/ZoneEtude.shp', product_type='S2MSI2A', max_trials=10, wait=1, no_download=False, extract=True ) Si la zone d\u2019\u00e9tude est \u00e0 cheval sur au moins deux tuiles, il est possible d\u2019ajouter le param\u00e8tre tile=<code_tuile> pour filtrer les r\u00e9sultats. Pour information, les param\u00e8tres max_trials et wait permettent de relancer \u00e0 pas de temps r\u00e9gulier les requ\u00eates de t\u00e9l\u00e9chargement. En effet, les archives Sentinel-2 peuvent \u00eatre stock\u00e9es sur bande. Lorsque ces images sont appel\u00e9es, elles doivent \u00eatre transf\u00e9r\u00e9es sur disque avant d\u2019\u00eatre t\u00e9l\u00e9chargeables. Cette proc\u00e9dure, transparente pour l\u2019utilisateur, n\u00e9cessite un peu de temps, une dizaine de minutes environ.","title":"4.5. Donn\u00e9es PEPS"},{"location":"docs/02_pretraitement_classification/","text":"D\u00e9tection des foyers de mortalit\u00e9 dans les massifs de conif\u00e8res par imagerie satellite Sentinel-2 Equipe de formation INRAE : Florian de Boissieu, Rapha\u00ebl Dutrieux, Jean-Baptiste F\u00e9ret, Kenji Ose TP-01 : D\u00e9couverte des donn\u00e9es Sentinel-2 et d\u00e9tection bi-date 5. Fiche D : Pr\u00e9traitement des donn\u00e9es S2 sous QGIS Les donn\u00e9es Sentinel-2 t\u00e9l\u00e9charg\u00e9es depuis THEIA sont fournies sous forme d\u2019archive ZIP, et doivent d\u2019abord \u00eatre d\u00e9compress\u00e9es pour \u00eatre ensuite mise en forme en fonction des besoins. 5.1. D\u00e9compression des donn\u00e9es S2 A l\u2019aide de l\u2019explorateur Windows, ouvrir le r\u00e9pertoire A_DATA/RASTER/THEIA qui contient les deux images S2 zipp\u00e9es. D\u00e9compresser les images dans ce m\u00eame r\u00e9pertoire. Vous obtenez les deux r\u00e9pertoires suivants : SENTINEL2B_20170823-103018-461_L2A_T31UGP_D SENTINEL2A_20180823-103535-335_L2A_T31UGP_D Ces r\u00e9pertoires sont organis\u00e9s de la mani\u00e8re suivante : bash= ..\\THEIA_DATA\\SENTINEL2B_20170823-103018-461_L2A_T31UGP_D \u2514\u2500\u2500\u2500SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2 \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_ATB_R1.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_ATB_R2.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B11.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B12.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B2.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B3.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B4.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B5.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B6.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B7.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B8.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B8A.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_MTD_ALL.xml \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_QKL_ALL.jpg \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_SRE_B11.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_SRE_B12.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_SRE_B2.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_SRE_B3.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_SRE_B4.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_SRE_B5.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_SRE_B6.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_SRE_B7.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_SRE_B8.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_SRE_B8A.tif \u251c\u2500\u2500\u2500DATA \u2514\u2500\u2500\u2500MASKS Dans cet exemple, le r\u00e9pertoire SENTINEL2B..V2-2 contient l\u2019ensemble des bandes spectrales de l\u2019image Sentinel-2, soit un fichier image par bande. Deux types de conversion en r\u00e9flectance au sol (ou TOC pour Top of Canopy ) sont ici propos\u00e9s : SRE pour Surface Reflectance et, FRE pour Flat Reflectance . Ce dernier mode int\u00e8gre, en plus des corrections atmosph\u00e9riques, des corrections topographiques. Il est ici privil\u00e9gi\u00e9. Supprimer les fichiers ayant pour suffixe SRE_B .tif 5.2. Ajuster les images \u00e0 l'emprise d\u2019une zone d'\u00e9tude et harmoniser la r\u00e9solution spatiale Ouvrir le logiciel QGis (version utilis\u00e9e : 3.16.1) Dans QGis, ouvrir la bo\u00eete \u00e0 outils de traitements : Traitement > Bo\u00eete \u00e0 outils Dans la bo\u00eete \u00e0 outils de traitements, rechercher l\u2019outil : GDAL > Extraction raster > D\u00e9couper un raster selon [...] masque Cliquer-droit sur l\u2019outil et, s\u00e9lectionner \u201cEx\u00e9cuter comme processus de lot\u2026\u201d Dans la fen\u00eatre de Traitements par lots : pour le champ \u201cCouche source\u201d : cliquer sur Auto-remplissage > s\u00e9lectionner des fichiers... et ouvrir tous les fichiers FRE de l\u2019image S2 acquise en 2017 pour le champ \u201cCouche de masquage\u201d : s\u00e9lectionner dans la premi\u00e8re ligne le fichier ZoneEtude.shp dans le r\u00e9pertoire A_DATA/VECTOR cliquer sur Auto-Remplissage\u2026 > Remplir afin de renseigner automatiquement les lignes qui suivent. pour le champ \u201cD\u00e9finir la r\u00e9solution du fichier en sortie\u201d : s\u00e9lectionner sur la premi\u00e8re ligne l\u2019option \u201cOui\u201d et effectuer un remplissage automatique pour les lignes qui suivent pour le champ \u201cR\u00e9solution X pour les bandes en sortie\u201d, saisir la valeur 10 et effectuer un remplissage automatique pour le lignes qui suivent pour le champ \u201cR\u00e9solution Y pour les bandes en sortie\u201d, saisir la valeur 10 et effectuer un remplissage automatique pour le lignes qui suivent pour le champ \u201cD\u00e9coup\u00e9 (masque)\u201d, enregistrer le r\u00e9sultat dans le r\u00e9pertoire C_RESULTS et donner en nom de fichier le pr\u00e9fixe \u201cCROP_10m_\u201d choisir les options comme indiqu\u00e9 sur la figure ci-dessous : Cliquer enfin sur le bouton \u201cEx\u00e9cuter\u201d Chacune des bandes spectrales de l\u2019image S2 de 2017 est ainsi d\u00e9coup\u00e9e suivant l\u2019emprise de la zone d\u2019\u00e9tude et r\u00e9-\u00e9chantillonn\u00e9e \u00e0 10 m de r\u00e9solution spatiale. Les r\u00e9sultats sont enregistr\u00e9s dans le r\u00e9pertoire C_RESULTS et leur nom de fichier est pr\u00e9fix\u00e9 par la cha\u00eene de caract\u00e8res \u201cCROP_10m_\u201d. Reproduire ce traitement pour l\u2019image S2 de 2018 Suite aux traitements des deux images, le r\u00e9pertoire C_RESULTS devrait disposer de 20 fichiers images, soit 10 bandes spectrales par date. 5.3. Calcul d\u2019indices de v\u00e9g\u00e9tation Deux types d\u2019indice de v\u00e9g\u00e9tation sont produits et test\u00e9s : le NDVI et le CRSWIR . Leur calcul est r\u00e9alis\u00e9 \u00e0 l\u2019aide de la calculatrice Raster de QGis. Dans un premier temps, charger si n\u00e9cessaire dans QGis toutes les bandes spectrales pr\u00e9trait\u00e9es (cf. exercice pr\u00e9c\u00e9dent) de l\u2019image S2 2017 : cliquer sur : Couche > Ajouter une couche > Ajouter une couche raster\u2026 5.3.1. Le NDVI Le NDVI exploite les bandes situ\u00e9es dans les domaines visible rouge (R) et proche infrarouge (PIR), correspondant respectivement aux canaux B4 (665 nm) et B8 (842 nm) de Sentinel-2. Cet indice est particuli\u00e8rement int\u00e9ressant pour l'\u00e9tude de la v\u00e9g\u00e9tation et plus particuli\u00e8rement de l'activit\u00e9 photosynth\u00e9tique : il permet de tirer parti du contraste de r\u00e9flectance entre les domaines rouge (tr\u00e8s forte absorption due \u00e0 la chlorophylle) et le domaine proche infrarouge (absence d'\u00e9l\u00e9ments absorbants dans la v\u00e9g\u00e9tation). le NDVI est normalis\u00e9 afin d\u2019obtenir des valeurs comprises entre -1 et 1. L\u2019expression du NDVI est la suivante : NDVI = (B8 - B4)/(B8 + B4) La proc\u00e9dure pour calculer le NDVI \u00e0 partir de QGIS est la suivante: Cliquer sur le menu : Raster > Calculatrice Raster Saisir l\u2019expression suivante : (\"CROP_10m_SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B8@1\" - \"CROP_10m_SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B4@1\") / (\"CROP_10m_SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B8@1\" + \"CROP_10m_SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B4@1\") Enregistrer le r\u00e9sultat sous C_RESULTS\\NDVI_2017.tif Ex\u00e9cuter le calcul R\u00e9p\u00e9ter cette proc\u00e9dure pour calculer le NDVI de l\u2019image S2 2018 et enregistrer le r\u00e9sultat sous C_RESULTS\\NDVI_2018.tif . 5.3.2. Le CRSWIR L\u2019indice CRSWIR exploite une bande du proche infrarouge et deux bandes du moyen infrarouge, respectivement les bandes B8A (864 nm), B11 (1610.4 nm) et B12 (2185.7 nm) de Sentinel-2. Cet indice se base sur le principe du Continuum Removal (CR), technique r\u00e9pandue dans le domaine hyperspectral qui permet de d\u2019augmenter le contraste des domaines d\u2019absorption de certains constituants distinguables par les mesures de spectroscopie, mais dont l\u2019amplitude est possiblement tr\u00e8s inf\u00e9rieure \u00e0 la variabilit\u00e9 de la \u2018ligne de base\u2019 de la r\u00e9flectance, induite par des conditions environnementales telles que la luminosit\u00e9, l'humidit\u00e9\u2026 Dans notre cas, le CRSWIR permet de rehausser l'intensit\u00e9 relative des variations de r\u00e9flectance associ\u00e9es \u00e0 la pr\u00e9sence d\u2019eau dans la v\u00e9g\u00e9tation, caract\u00e9ris\u00e9e par un pic d'absorption important autour de 1500 nm. L\u2019expression du CRSWIR est la suivante : CRSWIR = B11/(B8A+((B12-B8A)/(2185.7-864))x(1610.4-864)) Comme pour le NDVI, calculer \u00e0 l\u2019aide de la calculatrice raster l\u2019indice CRSWIR pour les ann\u00e9es 2017 ( CRSWIR_2017.tif ) et 2018 ( CRSWIR_2018.tif ). A titre d\u2019exemple, l\u2019expression attendue pour 2017 est la suivante : \"CROP_10m_SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B11@1\" / (\"CROP_10m_SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B8A@1\" + ((\"CROP_10m_SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B12@1\" - \"CROP_10m_SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B8A@1\") / (2185.7 - 864)) * (1610.4 - 864)) Pour \u00eatre tout \u00e0 fait rigoureux, il serait n\u00e9cessaire d\u2019adapter la longueur d\u2019onde centrale des bandes 8A, 11 et 12 en fonction des caract\u00e9ristiques de Sentinel-2A ou Sentinel-2B. Ici, nous partons du principe que les diff\u00e9rences dans la r\u00e9ponse spectrale des capteurs sont n\u00e9gligeables, et utilisons la longueur d\u2019onde centrale des bandes du capteur Sentinel-2A. 5.4. Automatisation des t\u00e2ches Les t\u00e2ches de d\u00e9compression, d\u00e9coupage des images sur une zone d'\u00e9tude, harmonisation de la r\u00e9solution spatiale entre bandes (\u00e0 10 m ou 20 m), empilement des bandes au sein d\u2019un fichier image unique, et de calcul d\u2019un indice spectral associ\u00e9 aux images Sentinel-2, peuvent s'av\u00e9rer chronophages et complexes a mettre en oeuvre sur de gros volumes de donn\u00e9es. Afin de faciliter cette succession de traitements, une librairie a \u00e9t\u00e9 d\u00e9velopp\u00e9e et int\u00e9gr\u00e9e au package fordead. Cette librairie, nomm\u00e9e maja_fun , est mise en application dans le script ex_preprocess_theia.py pr\u00e9sent\u00e9 dans le dossier d\u2019exemples du package et situ\u00e9e \u00e0 l'emplacement suivant : <MyWorkingDirectory>\\B_PROGRAMS\\Libraries\\fordead_package\\examples\\ Ce script peut \u00eatre ouvert \u00e0 l'aide d\u2019un \u00e9diteur de texte (comme notepad++) ou un environnement de d\u00e9veloppement (comme spyder). Une fois les chemins relatifs mis \u00e0 jour, il peut ensuite \u00eatre lanc\u00e9 depuis une invite de commande anaconda avec l\u2019instruction suivante : bash= python ex_preprocess_theia.py A l\u2019issue de l'ex\u00e9cution, diff\u00e9rentes images ont ete cr\u00e9\u00e9es dans le r\u00e9pertoire suivant : <MyWorkingDirectory>\\C_RESULTS\\maja_preprocess Ce repertoire inclut: un repertoire Unzip contenant l\u2019image SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2 d\u00e9compress\u00e9e un repertoire Subsets contenant des images d\u00e9coup\u00e9es sur la zone d'\u00e9tude, dont: une image au format netcdf comprenant diff\u00e9rents produits raster (notamment l\u2019image Sentinel-2 ajust\u00e9e sur la zone d'\u00e9tude, masque de la zone, indices spectraux NDVI et CRSWIR associ\u00e9s) : SENTINEL2A_20180823-103535-335_L2A_T31UGP_D.nc les images correspondant \u00e0 ces produits individualis\u00e9s et au format tif : SENTINEL2A_20180823-103535-335_L2A_T31UGP_D_bands.tif , SENTINEL2A_20180823-103535-335_L2A_T31UGP_D_CRSWIR.tif , SENTINEL2A_20180823-103535-335_L2A_T31UGP_D_mask.tif , SENTINEL2A_20180823-103535-335_L2A_T31UGP_D_NDVI.tif Ce script d\u2019exemple peut-\u00eatre copi\u00e9 dans le r\u00e9pertoire principal des programmes : <MyWorkingDirectory>\\B_PROGRAMS\\ puis modifi\u00e9 pour ajuster ce traitement automatis\u00e9 \u00e0 d\u2019autres jeux de donn\u00e9es. Le param\u00e9trage des variables d'entr\u00e9e des fonctions incluses dans la librairie maja_fun.py offre de nombreuses possibilit\u00e9s, et celles-ci seront enrichies au fur et \u00e0 mesure des versions du package. 5.5. Pr\u00e9paration et int\u00e9gration du masque for\u00eat Pour cet exercice, le masque est construit \u00e0 partir de la BD For\u00eat \u00ae V2 de l\u2019IGN. Il faut tout d\u2019abord d\u00e9finir les essences \u00e0 conserver, ici les classes \u201cFF2-00-00\", \"FF2-90-90\", \"FF2-91-91\", \"FF2G61-61\" du champ CODE_TFV. Les r\u00e9sultats sont ensuite fusionn\u00e9s et convertis en raster. Cette conversion requiert en entr\u00e9e un champ attributaire cod\u00e9 en entier. Ici, les essences vis\u00e9es seront cod\u00e9es \u00e0 1, les autres \u00e0 0. 5.5.1. S\u00e9lection des entit\u00e9s vectorielles sur la zone d\u2019\u00e9tude La zone d\u2019\u00e9tude \u00e9tant \u00e0 cheval sur deux d\u00e9partements, il convient dans un premier temps d\u2019effectuer une s\u00e9lection zonale afin de r\u00e9duire le jeu de donn\u00e9es initial, de fusionner ensuite ces r\u00e9sultats dans une seule et m\u00eame couche. Dans QGis, s\u2019assurer que les couches vectorielles suivantes sont charg\u00e9es : Dans le r\u00e9pertoire [...]\\A_DATA\\VECTOR\\ZONE_ETUDE : ZoneEtude.shp Dans le r\u00e9pertoire [...]\\A_DATA\\VECTOR\\BD_FORET : BD_Foret_V2_Dep070_2015\\BD_Foret_V2_Dep070_2015.shp BD_Foret_V2_Dep088_2014\\BD_Foret_V2_Dep088_2014.shp Effectuer des s\u00e9lections zonales sur les deux couches d\u00e9partementales de la BD For\u00eat \u00ae et ce, en fonction de l\u2019emprise de la zone d\u2019\u00e9tude. Par exemple pour le d\u00e9partement 70, suivre la proc\u00e9dure suivante : Dans le menu, cliquer sur : Vecteur > Outils de recherche > S\u00e9lection par localisation\u2026 Dans le fen\u00eatre de \u201cS\u00e9lection par localisation\u201d, param\u00e9trer comme suit : Cliquer-droit sur la couche BD For\u00eat \u00ae du d\u00e9partement 70 et exporter les entit\u00e9s s\u00e9lectionn\u00e9es sous : C_RESULTS\\BD_Foret_V2_Dep070_zoneEtude.shp Lors de l\u2019enregistrement, modifier la projection en sortie ( SCR : EPSG:32631 ) afin qu\u2019elle soit conforme aux donn\u00e9es Sentinel-2 ici utilis\u00e9es : Reproduire ce traitement pour la BD For\u00eat \u00ae IGN du d\u00e9partement 88, et enregistrer le r\u00e9sultat sous : C_RESULTS\\BD_Foret_V2_Dep088_zoneEtude.shp Les deux fichiers r\u00e9sultants sont enfin fusionn\u00e9s dans un seul et m\u00eame fichier. - Dans le menu, cliquer sur : Vecteur > Outils de gestion de donn\u00e9es > Fusionner des couches vecteur\u2026 - S\u00e9lectionner en couches d\u2019entr\u00e9e : - C_RESULTS\\BD_Foret_V2_Dep070_zoneEtude.shp - C_RESULTS\\BD_Foret_V2_Dep088_zoneEtude.shp Et enregistrer le r\u00e9sultat sous : BD_Foret_zoneEtude.shp 5.5.2. Ajout et renseignement d\u2019un champ dans la table attributaire Il est n\u00e9cessaire de cr\u00e9er un nouveau champ dans la couche vectorielle afin de pr\u00e9ciser quelles essences seront conserv\u00e9es ou non dans le masque final. Ouvrir la couche vectorielle C_RESULTS/BD_Foret_zoneEtude.shp S\u00e9lectionner la couche et ouvrir la calculatrice de champ en cliquant sur l\u2019ic\u00f4ne dans la barre de menu. Dans la calculatrice de champ : cocher l\u2019option \u201ccr\u00e9er un nouveau champ\u201d choisir un nom de champ, par exemple : masque choisir le type de codage : Nombre entier dans l\u2019espace \u201cExpression\u201d, saisir l\u2019instruction suivante : CASE WHEN \"CODE_TFV\" = 'FF2-00-00' OR \"CODE_TFV\" = 'FF2-90-90' OR \"CODE_TFV\" = 'FF2-91-91' OR \"CODE_TFV\" = 'FF2G61-61' THEN 1 ELSE 0 END Enregistrer les modifications 5.5.3. Cr\u00e9ation du masque en mode raster Une fois le champ des valeurs enti\u00e8res cr\u00e9\u00e9, il faut produire un raster binaire sur la m\u00eame grille (origine, r\u00e9solution, et dimension) que les images Sentinel-2 trait\u00e9es (pr\u00e9fix\u00e9es \u2018CROP_10m_*\u2019). Dans le menu, cliquer sur : Raster > Conversion > Rasteriser (vecteur vers raster) \u2026 Param\u00e9trer comme suit : N.B. Pour le param\u00e8tre \u201cEmprise du r\u00e9sultat\u201d, utiliser l\u2019option \u201cCalculer depuis la couche\u201d pour obtenir les coordonn\u00e9es extr\u00e9males de l\u2019image de r\u00e9f\u00e9rence. Le r\u00e9sultat est une image binaire, 1 pour les zones d\u2019int\u00e9r\u00eat, 0 pour le reste. 6. Fiche E : D\u00e9tection de changements Plusieurs solutions techniques sont possibles pour identifier les changements et tenter de les qualifier. Ces approches vont principalement de la mise \u00e0 disposition ou non de donn\u00e9es de terrain et des jeux de donn\u00e9es image disponibles. Dans le cadre de cet exercice, le jeu de donn\u00e9es est limit\u00e9 \u00e0 deux images acquises sur une m\u00eame zone \u00e0 deux dates diff\u00e9rentes. Il ne s\u2019agit donc pas d\u2019une s\u00e9rie temporelle. Pour d\u00e9tecter les changements, il est possible de produire un indice de changement en d\u00e9terminant des seuils soit manuellement soit en fonction de la distribution statistique des pixels, de tester \u00e9galement des algorithmes de classification supervis\u00e9e ou non. 6.1. Test 1. Diff\u00e9rence normalis\u00e9e d\u2019indices de v\u00e9g\u00e9tation Le principe ici est de mettre en place un indice de changement en utilisant les indices NDVI ou CRSWIR calcul\u00e9s aux deux dates. Pour ce faire, \u00e0 l\u2019instar du NDVI, nous travaillons sur une diff\u00e9rence normalis\u00e9e. Ouvrir la calculatrice raster Saisir l\u2019expression suivante : (\"MASQUE_FORET@1\"=0) * 255 + (\"MASQUE_FORET@1\"=1) * ((\"NDVI_2018@1\"-\"NDVI_2017@1\")/(\"NDVI_2018@1\"+\"NDVI_2017@1\")) Enregistrer le r\u00e9sultat sous : C_RESULTS\\DIFF_CRSWIR_2017_2018_MASK.tif Pour afficher correctement l\u2019image sur QGis, il convient d\u2019indiquer la valeur 255 en no data afin d\u2019\u00e9tablir un contraste uniquement sur les valeurs du delta NDVI. Double-cliquer sur le r\u00e9sultat dans la table des couches de QGis Dans les propri\u00e9t\u00e9s de la couche, cliquer sur l\u2019onglet Transparence et saisir 255 en tant que valeur nulle compl\u00e9mentaire Le r\u00e9sultat est une image \u00e0 une bande dont les valeurs sont th\u00e9oriquement comprises entre -1 et 1. La valeur 255 \u00e9tant associ\u00e9e aux essences non suivies. Les valeurs de pixels situ\u00e9es au voisinage de 0 correspondent \u00e0 un \u00e9tat stable, celles qui tendent vers -1 refl\u00e8tent une baisse d'activit\u00e9 photosynth\u00e9tique due \u00e0 des probl\u00e8mes sanitaires, des pratiques sylvicoles ou autres. De la m\u00eame mani\u00e8re, calculer la diff\u00e9rence de CRSWIR et, Enregistrer le r\u00e9sultat sous : C_RESULTS\\DIFF_CRSWIR_2017_2018_MASK.tif Analyser visuellement le r\u00e9sultat et comparer avec la diff\u00e9rence des NDVI. \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 6.2. Test 2. Classifications automatiques Une premi\u00e8re approche possible pour d\u00e9tecter des anomalies en milieu forestier est de faire appel \u00e0 des algorithmes de classification automatique d\u2019images, supervis\u00e9s ou non. Nous allons tester ici ces deux approches dans QGis, et cerner \u00e0 la fois leurs avantages et inconv\u00e9nients. 6.2.1. Classification non supervis\u00e9e La classification non supervis\u00e9e regroupe les pixels qui partagent des caract\u00e9ristiques similaires (par exemple, la radiom\u00e9trie) en classe, sans toutefois les \u00e9tiqueter. Il appartient alors \u00e0 l\u2019utilisateur d\u2019attribuer chacune des classes \u00e0 un type d\u2019occupation du sol, un type de changement, etc. Dans QGis, ouvrir \u00e0 la bo\u00eete \u00e0 outils de traitements en cliquant dans le menu sur : Traitement > Bo\u00eete \u00e0 outils Dans la bo\u00eete \u00e0 outils de traitements, affich\u00e9e par d\u00e9faut \u00e0 droite de l\u2019interface, d\u00e9rouler les menus suivants : SAGA > Image analysis Cette rubrique regroupe plusieurs outils de classification d\u2019image. Nous limiterons les tests aux seules applications utilisables avec une configuration classique de QGis. En effet, certaines applications n\u00e9cessitent l\u2019installation de d\u00e9pendances (par ex. opencv). Ouvrir l\u2019outil K-means clustering for grids, et configurer comme suit : Dans le champ Grilles, ins\u00e9rer les fichiers suivants : CROP_10m_SENTINEL2A_20180823-103535-335_L2A_T31UGP_D_V1-8_FRE_B2.tif CROP_10m_SENTINEL2A_20180823-103535-335_L2A_T31UGP_D_V1-8_FRE_B3.tif CROP_10m_SENTINEL2A_20180823-103535-335_L2A_T31UGP_D_V1-8_FRE_B4.tif CROP_10m_SENTINEL2A_20180823-103535-335_L2A_T31UGP_D_V1-8_FRE_B8.tif Dans le champ M\u00e9thode, choisir : [2] Combined Minimum Distance / Hillclimbing Dans le champ Clusters, saisir : 10 Dans le champ Maximum Iterations, saisir 10 Cocher l\u2019option Normalize Enregistrer la classification (Clusters) sous : C_RESULTS\\classif_kmeans_2018.sdat En sortie, l\u2019image est class\u00e9e en 10 classes (clusters) sans \u00e9tiquette. Attribuer une couleur et une \u00e9tiquette \u00e0 chacune des classes via les propri\u00e9t\u00e9s de la couche. Relancer cet outil en incluant cette fois soit les bandes du visible et du proche infrarouge des ann\u00e9es 2017 et 2018, soit les NDVI aux deux dates. En analysant les r\u00e9sultats, quels sont selon vous les avantages et inconv\u00e9nients de cette m\u00e9thode dans une perspective op\u00e9rationnelle ? \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 6.2.2. Classification supervis\u00e9e La classification supervis\u00e9e requiert en entr\u00e9e des donn\u00e9es d\u2019apprentissage pour entra\u00eener le mod\u00e8le de classification. Dans le cas pr\u00e9sent, il s\u2019agit des relev\u00e9s terrain. Pour les besoins de l\u2019exercice, la couche vectorielle des relev\u00e9s terrain ( A_DATA\\VECTOR\\BD_SCOLYTE\\ValidatedScolytes.shp ) a \u00e9t\u00e9 pr\u00e9trait\u00e9e de mani\u00e8re \u00e0 ne conserver que les entit\u00e9s situ\u00e9es \u00e0 l\u2019int\u00e9rieur de la zone d\u2019\u00e9tude, \u00e0 coder un champ (\u2018class\u2019) en valeur enti\u00e8re pour les parcelles saines (1) et celles impact\u00e9es (2) par le scolyte. Ouvrir la couche vectorielle : A_DATA\\VECTOR\\BD_SCOLYTE\\ValidatedScolytes.shp Dans la Bo\u00eete \u00e0 outils de traitements, ouvrir l\u2019application suivante : SAGA > Image analysis > Supervised classification for grids Param\u00e9trer comme suit : Dans le champ Entit\u00e9s, ins\u00e9rer les fichiers suivants : CROP_10m_SENTINEL2A_20180823-103535-335_L2A_T31UGP_D_V1-8_FRE_B2.tif CROP_10m_SENTINEL2A_20180823-103535-335_L2A_T31UGP_D_V1-8_FRE_B3.tif CROP_10m_SENTINEL2A_20180823-103535-335_L2A_T31UGP_D_V1-8_FRE_B4.tif CROP_10m_SENTINEL2A_20180823-103535-335_L2A_T31UGP_D_V1-8_FRE_B8.tif Cocher l\u2019option Normalize Dans le champ Training Areas, s\u00e9lectionner la couche : ValidatedScolytes.shp Dans le champ Class Identifier, s\u00e9lectionner la couche : ValidatedScolytes.shp Dans le champ M\u00e9thode, s\u00e9lectionner : [5] Spectral Angle Mapping Enregistrer la classification sous : C_RESULTS\\classif_specang_2018.sdat La qualit\u00e9 d\u2019une classification est \u00e9valu\u00e9e en g\u00e9n\u00e9ral sur le crit\u00e8re th\u00e9matique, en estimant la coh\u00e9rence de l'\u00e9tiquetage vis-\u00e0-vis de la \u201cr\u00e9alit\u00e9\u201d (cf. matrice de confusion et m\u00e9triques d\u00e9riv\u00e9es). Or, cette qualit\u00e9 d\u00e9pend du classifieur en lui-m\u00eame, mais aussi des jeux d\u2019apprentissage et des caract\u00e9ristiques descriptives (par ex. bandes spectrales d\u2019une image) utilis\u00e9es. En utilisant toujour le m\u00eame outil SAGA, Tester une \u00e0 deux autres m\u00e9thodes de classification supervis\u00e9e et, Comparer visuellement les r\u00e9sultats : \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 Ajouter simultan\u00e9ment les bandes spectrales des ann\u00e9es 2017 et 2018 et relancer la m\u00e9thode qui vous para\u00eet la plus efficace. Comparer les r\u00e9sultats avec la m\u00eame m\u00e9thode entra\u00een\u00e9e sur une seule ann\u00e9e : \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 La classification supervis\u00e9e repose sur des donn\u00e9es d\u2019apprentissage, souvent des relev\u00e9s terrain. Cette m\u00e9thode vous para\u00eet-elle adapt\u00e9e pour le suivi de ph\u00e9nom\u00e8nes \u00e9voluant dans le temps et dans l\u2019espace ? Pr\u00e9ciser les avantages et/ou inconv\u00e9nients de cette approche. \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026","title":"02 Pretraitement Classification"},{"location":"docs/02_pretraitement_classification/#detection-des-foyers-de-mortalite-dans-les-massifs-de-coniferes-par-imagerie-satellite-sentinel-2","text":"Equipe de formation INRAE : Florian de Boissieu, Rapha\u00ebl Dutrieux, Jean-Baptiste F\u00e9ret, Kenji Ose","title":"D\u00e9tection des foyers de mortalit\u00e9 dans les massifs de conif\u00e8res par imagerie satellite Sentinel-2"},{"location":"docs/02_pretraitement_classification/#tp-01-decouverte-des-donnees-sentinel-2-et-detection-bi-date","text":"","title":"TP-01 : D\u00e9couverte des donn\u00e9es Sentinel-2 et d\u00e9tection bi-date"},{"location":"docs/02_pretraitement_classification/#5-fiche-d-pretraitement-des-donnees-s2-sous-qgis","text":"Les donn\u00e9es Sentinel-2 t\u00e9l\u00e9charg\u00e9es depuis THEIA sont fournies sous forme d\u2019archive ZIP, et doivent d\u2019abord \u00eatre d\u00e9compress\u00e9es pour \u00eatre ensuite mise en forme en fonction des besoins.","title":"5. Fiche D : Pr\u00e9traitement des donn\u00e9es S2 sous QGIS"},{"location":"docs/02_pretraitement_classification/#51-decompression-des-donnees-s2","text":"A l\u2019aide de l\u2019explorateur Windows, ouvrir le r\u00e9pertoire A_DATA/RASTER/THEIA qui contient les deux images S2 zipp\u00e9es. D\u00e9compresser les images dans ce m\u00eame r\u00e9pertoire. Vous obtenez les deux r\u00e9pertoires suivants : SENTINEL2B_20170823-103018-461_L2A_T31UGP_D SENTINEL2A_20180823-103535-335_L2A_T31UGP_D Ces r\u00e9pertoires sont organis\u00e9s de la mani\u00e8re suivante : bash= ..\\THEIA_DATA\\SENTINEL2B_20170823-103018-461_L2A_T31UGP_D \u2514\u2500\u2500\u2500SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2 \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_ATB_R1.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_ATB_R2.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B11.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B12.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B2.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B3.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B4.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B5.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B6.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B7.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B8.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B8A.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_MTD_ALL.xml \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_QKL_ALL.jpg \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_SRE_B11.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_SRE_B12.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_SRE_B2.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_SRE_B3.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_SRE_B4.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_SRE_B5.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_SRE_B6.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_SRE_B7.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_SRE_B8.tif \u2502 SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_SRE_B8A.tif \u251c\u2500\u2500\u2500DATA \u2514\u2500\u2500\u2500MASKS Dans cet exemple, le r\u00e9pertoire SENTINEL2B..V2-2 contient l\u2019ensemble des bandes spectrales de l\u2019image Sentinel-2, soit un fichier image par bande. Deux types de conversion en r\u00e9flectance au sol (ou TOC pour Top of Canopy ) sont ici propos\u00e9s : SRE pour Surface Reflectance et, FRE pour Flat Reflectance . Ce dernier mode int\u00e8gre, en plus des corrections atmosph\u00e9riques, des corrections topographiques. Il est ici privil\u00e9gi\u00e9. Supprimer les fichiers ayant pour suffixe SRE_B .tif","title":"5.1. D\u00e9compression des donn\u00e9es S2"},{"location":"docs/02_pretraitement_classification/#52-ajuster-les-images-a-lemprise-dune-zone-detude-et-harmoniser-la-resolution-spatiale","text":"Ouvrir le logiciel QGis (version utilis\u00e9e : 3.16.1) Dans QGis, ouvrir la bo\u00eete \u00e0 outils de traitements : Traitement > Bo\u00eete \u00e0 outils Dans la bo\u00eete \u00e0 outils de traitements, rechercher l\u2019outil : GDAL > Extraction raster > D\u00e9couper un raster selon [...] masque Cliquer-droit sur l\u2019outil et, s\u00e9lectionner \u201cEx\u00e9cuter comme processus de lot\u2026\u201d Dans la fen\u00eatre de Traitements par lots : pour le champ \u201cCouche source\u201d : cliquer sur Auto-remplissage > s\u00e9lectionner des fichiers... et ouvrir tous les fichiers FRE de l\u2019image S2 acquise en 2017 pour le champ \u201cCouche de masquage\u201d : s\u00e9lectionner dans la premi\u00e8re ligne le fichier ZoneEtude.shp dans le r\u00e9pertoire A_DATA/VECTOR cliquer sur Auto-Remplissage\u2026 > Remplir afin de renseigner automatiquement les lignes qui suivent. pour le champ \u201cD\u00e9finir la r\u00e9solution du fichier en sortie\u201d : s\u00e9lectionner sur la premi\u00e8re ligne l\u2019option \u201cOui\u201d et effectuer un remplissage automatique pour les lignes qui suivent pour le champ \u201cR\u00e9solution X pour les bandes en sortie\u201d, saisir la valeur 10 et effectuer un remplissage automatique pour le lignes qui suivent pour le champ \u201cR\u00e9solution Y pour les bandes en sortie\u201d, saisir la valeur 10 et effectuer un remplissage automatique pour le lignes qui suivent pour le champ \u201cD\u00e9coup\u00e9 (masque)\u201d, enregistrer le r\u00e9sultat dans le r\u00e9pertoire C_RESULTS et donner en nom de fichier le pr\u00e9fixe \u201cCROP_10m_\u201d choisir les options comme indiqu\u00e9 sur la figure ci-dessous : Cliquer enfin sur le bouton \u201cEx\u00e9cuter\u201d Chacune des bandes spectrales de l\u2019image S2 de 2017 est ainsi d\u00e9coup\u00e9e suivant l\u2019emprise de la zone d\u2019\u00e9tude et r\u00e9-\u00e9chantillonn\u00e9e \u00e0 10 m de r\u00e9solution spatiale. Les r\u00e9sultats sont enregistr\u00e9s dans le r\u00e9pertoire C_RESULTS et leur nom de fichier est pr\u00e9fix\u00e9 par la cha\u00eene de caract\u00e8res \u201cCROP_10m_\u201d. Reproduire ce traitement pour l\u2019image S2 de 2018 Suite aux traitements des deux images, le r\u00e9pertoire C_RESULTS devrait disposer de 20 fichiers images, soit 10 bandes spectrales par date.","title":"5.2. Ajuster les images \u00e0 l'emprise d\u2019une zone d'\u00e9tude et harmoniser la r\u00e9solution spatiale"},{"location":"docs/02_pretraitement_classification/#53-calcul-dindices-de-vegetation","text":"Deux types d\u2019indice de v\u00e9g\u00e9tation sont produits et test\u00e9s : le NDVI et le CRSWIR . Leur calcul est r\u00e9alis\u00e9 \u00e0 l\u2019aide de la calculatrice Raster de QGis. Dans un premier temps, charger si n\u00e9cessaire dans QGis toutes les bandes spectrales pr\u00e9trait\u00e9es (cf. exercice pr\u00e9c\u00e9dent) de l\u2019image S2 2017 : cliquer sur : Couche > Ajouter une couche > Ajouter une couche raster\u2026","title":"5.3. Calcul d\u2019indices de v\u00e9g\u00e9tation"},{"location":"docs/02_pretraitement_classification/#531-le-ndvi","text":"Le NDVI exploite les bandes situ\u00e9es dans les domaines visible rouge (R) et proche infrarouge (PIR), correspondant respectivement aux canaux B4 (665 nm) et B8 (842 nm) de Sentinel-2. Cet indice est particuli\u00e8rement int\u00e9ressant pour l'\u00e9tude de la v\u00e9g\u00e9tation et plus particuli\u00e8rement de l'activit\u00e9 photosynth\u00e9tique : il permet de tirer parti du contraste de r\u00e9flectance entre les domaines rouge (tr\u00e8s forte absorption due \u00e0 la chlorophylle) et le domaine proche infrarouge (absence d'\u00e9l\u00e9ments absorbants dans la v\u00e9g\u00e9tation). le NDVI est normalis\u00e9 afin d\u2019obtenir des valeurs comprises entre -1 et 1. L\u2019expression du NDVI est la suivante : NDVI = (B8 - B4)/(B8 + B4) La proc\u00e9dure pour calculer le NDVI \u00e0 partir de QGIS est la suivante: Cliquer sur le menu : Raster > Calculatrice Raster Saisir l\u2019expression suivante : (\"CROP_10m_SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B8@1\" - \"CROP_10m_SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B4@1\") / (\"CROP_10m_SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B8@1\" + \"CROP_10m_SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B4@1\") Enregistrer le r\u00e9sultat sous C_RESULTS\\NDVI_2017.tif Ex\u00e9cuter le calcul R\u00e9p\u00e9ter cette proc\u00e9dure pour calculer le NDVI de l\u2019image S2 2018 et enregistrer le r\u00e9sultat sous C_RESULTS\\NDVI_2018.tif .","title":"5.3.1. Le\u00a0NDVI"},{"location":"docs/02_pretraitement_classification/#532-le-crswir","text":"L\u2019indice CRSWIR exploite une bande du proche infrarouge et deux bandes du moyen infrarouge, respectivement les bandes B8A (864 nm), B11 (1610.4 nm) et B12 (2185.7 nm) de Sentinel-2. Cet indice se base sur le principe du Continuum Removal (CR), technique r\u00e9pandue dans le domaine hyperspectral qui permet de d\u2019augmenter le contraste des domaines d\u2019absorption de certains constituants distinguables par les mesures de spectroscopie, mais dont l\u2019amplitude est possiblement tr\u00e8s inf\u00e9rieure \u00e0 la variabilit\u00e9 de la \u2018ligne de base\u2019 de la r\u00e9flectance, induite par des conditions environnementales telles que la luminosit\u00e9, l'humidit\u00e9\u2026 Dans notre cas, le CRSWIR permet de rehausser l'intensit\u00e9 relative des variations de r\u00e9flectance associ\u00e9es \u00e0 la pr\u00e9sence d\u2019eau dans la v\u00e9g\u00e9tation, caract\u00e9ris\u00e9e par un pic d'absorption important autour de 1500 nm. L\u2019expression du CRSWIR est la suivante : CRSWIR = B11/(B8A+((B12-B8A)/(2185.7-864))x(1610.4-864)) Comme pour le NDVI, calculer \u00e0 l\u2019aide de la calculatrice raster l\u2019indice CRSWIR pour les ann\u00e9es 2017 ( CRSWIR_2017.tif ) et 2018 ( CRSWIR_2018.tif ). A titre d\u2019exemple, l\u2019expression attendue pour 2017 est la suivante : \"CROP_10m_SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B11@1\" / (\"CROP_10m_SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B8A@1\" + ((\"CROP_10m_SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B12@1\" - \"CROP_10m_SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2_FRE_B8A@1\") / (2185.7 - 864)) * (1610.4 - 864)) Pour \u00eatre tout \u00e0 fait rigoureux, il serait n\u00e9cessaire d\u2019adapter la longueur d\u2019onde centrale des bandes 8A, 11 et 12 en fonction des caract\u00e9ristiques de Sentinel-2A ou Sentinel-2B. Ici, nous partons du principe que les diff\u00e9rences dans la r\u00e9ponse spectrale des capteurs sont n\u00e9gligeables, et utilisons la longueur d\u2019onde centrale des bandes du capteur Sentinel-2A.","title":"5.3.2. Le\u00a0CRSWIR"},{"location":"docs/02_pretraitement_classification/#54-automatisation-des-taches","text":"Les t\u00e2ches de d\u00e9compression, d\u00e9coupage des images sur une zone d'\u00e9tude, harmonisation de la r\u00e9solution spatiale entre bandes (\u00e0 10 m ou 20 m), empilement des bandes au sein d\u2019un fichier image unique, et de calcul d\u2019un indice spectral associ\u00e9 aux images Sentinel-2, peuvent s'av\u00e9rer chronophages et complexes a mettre en oeuvre sur de gros volumes de donn\u00e9es. Afin de faciliter cette succession de traitements, une librairie a \u00e9t\u00e9 d\u00e9velopp\u00e9e et int\u00e9gr\u00e9e au package fordead. Cette librairie, nomm\u00e9e maja_fun , est mise en application dans le script ex_preprocess_theia.py pr\u00e9sent\u00e9 dans le dossier d\u2019exemples du package et situ\u00e9e \u00e0 l'emplacement suivant : <MyWorkingDirectory>\\B_PROGRAMS\\Libraries\\fordead_package\\examples\\ Ce script peut \u00eatre ouvert \u00e0 l'aide d\u2019un \u00e9diteur de texte (comme notepad++) ou un environnement de d\u00e9veloppement (comme spyder). Une fois les chemins relatifs mis \u00e0 jour, il peut ensuite \u00eatre lanc\u00e9 depuis une invite de commande anaconda avec l\u2019instruction suivante : bash= python ex_preprocess_theia.py A l\u2019issue de l'ex\u00e9cution, diff\u00e9rentes images ont ete cr\u00e9\u00e9es dans le r\u00e9pertoire suivant : <MyWorkingDirectory>\\C_RESULTS\\maja_preprocess Ce repertoire inclut: un repertoire Unzip contenant l\u2019image SENTINEL2B_20170823-103018-461_L2A_T31UGP_C_V2-2 d\u00e9compress\u00e9e un repertoire Subsets contenant des images d\u00e9coup\u00e9es sur la zone d'\u00e9tude, dont: une image au format netcdf comprenant diff\u00e9rents produits raster (notamment l\u2019image Sentinel-2 ajust\u00e9e sur la zone d'\u00e9tude, masque de la zone, indices spectraux NDVI et CRSWIR associ\u00e9s) : SENTINEL2A_20180823-103535-335_L2A_T31UGP_D.nc les images correspondant \u00e0 ces produits individualis\u00e9s et au format tif : SENTINEL2A_20180823-103535-335_L2A_T31UGP_D_bands.tif , SENTINEL2A_20180823-103535-335_L2A_T31UGP_D_CRSWIR.tif , SENTINEL2A_20180823-103535-335_L2A_T31UGP_D_mask.tif , SENTINEL2A_20180823-103535-335_L2A_T31UGP_D_NDVI.tif Ce script d\u2019exemple peut-\u00eatre copi\u00e9 dans le r\u00e9pertoire principal des programmes : <MyWorkingDirectory>\\B_PROGRAMS\\ puis modifi\u00e9 pour ajuster ce traitement automatis\u00e9 \u00e0 d\u2019autres jeux de donn\u00e9es. Le param\u00e9trage des variables d'entr\u00e9e des fonctions incluses dans la librairie maja_fun.py offre de nombreuses possibilit\u00e9s, et celles-ci seront enrichies au fur et \u00e0 mesure des versions du package.","title":"5.4. Automatisation des t\u00e2ches"},{"location":"docs/02_pretraitement_classification/#55-preparation-et-integration-du-masque-foret","text":"Pour cet exercice, le masque est construit \u00e0 partir de la BD For\u00eat \u00ae V2 de l\u2019IGN. Il faut tout d\u2019abord d\u00e9finir les essences \u00e0 conserver, ici les classes \u201cFF2-00-00\", \"FF2-90-90\", \"FF2-91-91\", \"FF2G61-61\" du champ CODE_TFV. Les r\u00e9sultats sont ensuite fusionn\u00e9s et convertis en raster. Cette conversion requiert en entr\u00e9e un champ attributaire cod\u00e9 en entier. Ici, les essences vis\u00e9es seront cod\u00e9es \u00e0 1, les autres \u00e0 0.","title":"5.5. Pr\u00e9paration et int\u00e9gration du masque for\u00eat"},{"location":"docs/02_pretraitement_classification/#551-selection-des-entites-vectorielles-sur-la-zone-detude","text":"La zone d\u2019\u00e9tude \u00e9tant \u00e0 cheval sur deux d\u00e9partements, il convient dans un premier temps d\u2019effectuer une s\u00e9lection zonale afin de r\u00e9duire le jeu de donn\u00e9es initial, de fusionner ensuite ces r\u00e9sultats dans une seule et m\u00eame couche. Dans QGis, s\u2019assurer que les couches vectorielles suivantes sont charg\u00e9es : Dans le r\u00e9pertoire [...]\\A_DATA\\VECTOR\\ZONE_ETUDE : ZoneEtude.shp Dans le r\u00e9pertoire [...]\\A_DATA\\VECTOR\\BD_FORET : BD_Foret_V2_Dep070_2015\\BD_Foret_V2_Dep070_2015.shp BD_Foret_V2_Dep088_2014\\BD_Foret_V2_Dep088_2014.shp Effectuer des s\u00e9lections zonales sur les deux couches d\u00e9partementales de la BD For\u00eat \u00ae et ce, en fonction de l\u2019emprise de la zone d\u2019\u00e9tude. Par exemple pour le d\u00e9partement 70, suivre la proc\u00e9dure suivante : Dans le menu, cliquer sur : Vecteur > Outils de recherche > S\u00e9lection par localisation\u2026 Dans le fen\u00eatre de \u201cS\u00e9lection par localisation\u201d, param\u00e9trer comme suit : Cliquer-droit sur la couche BD For\u00eat \u00ae du d\u00e9partement 70 et exporter les entit\u00e9s s\u00e9lectionn\u00e9es sous : C_RESULTS\\BD_Foret_V2_Dep070_zoneEtude.shp Lors de l\u2019enregistrement, modifier la projection en sortie ( SCR : EPSG:32631 ) afin qu\u2019elle soit conforme aux donn\u00e9es Sentinel-2 ici utilis\u00e9es : Reproduire ce traitement pour la BD For\u00eat \u00ae IGN du d\u00e9partement 88, et enregistrer le r\u00e9sultat sous : C_RESULTS\\BD_Foret_V2_Dep088_zoneEtude.shp Les deux fichiers r\u00e9sultants sont enfin fusionn\u00e9s dans un seul et m\u00eame fichier. - Dans le menu, cliquer sur : Vecteur > Outils de gestion de donn\u00e9es > Fusionner des couches vecteur\u2026 - S\u00e9lectionner en couches d\u2019entr\u00e9e : - C_RESULTS\\BD_Foret_V2_Dep070_zoneEtude.shp - C_RESULTS\\BD_Foret_V2_Dep088_zoneEtude.shp Et enregistrer le r\u00e9sultat sous : BD_Foret_zoneEtude.shp","title":"5.5.1. S\u00e9lection\u00a0des entit\u00e9s vectorielles sur la zone d\u2019\u00e9tude"},{"location":"docs/02_pretraitement_classification/#552-ajout-et-renseignement-dun-champ-dans-la-table-attributaire","text":"Il est n\u00e9cessaire de cr\u00e9er un nouveau champ dans la couche vectorielle afin de pr\u00e9ciser quelles essences seront conserv\u00e9es ou non dans le masque final. Ouvrir la couche vectorielle C_RESULTS/BD_Foret_zoneEtude.shp S\u00e9lectionner la couche et ouvrir la calculatrice de champ en cliquant sur l\u2019ic\u00f4ne dans la barre de menu. Dans la calculatrice de champ : cocher l\u2019option \u201ccr\u00e9er un nouveau champ\u201d choisir un nom de champ, par exemple : masque choisir le type de codage : Nombre entier dans l\u2019espace \u201cExpression\u201d, saisir l\u2019instruction suivante : CASE WHEN \"CODE_TFV\" = 'FF2-00-00' OR \"CODE_TFV\" = 'FF2-90-90' OR \"CODE_TFV\" = 'FF2-91-91' OR \"CODE_TFV\" = 'FF2G61-61' THEN 1 ELSE 0 END Enregistrer les modifications","title":"5.5.2. Ajout et renseignement d\u2019un champ dans la table attributaire"},{"location":"docs/02_pretraitement_classification/#553-creation-du-masque-en-mode-raster","text":"Une fois le champ des valeurs enti\u00e8res cr\u00e9\u00e9, il faut produire un raster binaire sur la m\u00eame grille (origine, r\u00e9solution, et dimension) que les images Sentinel-2 trait\u00e9es (pr\u00e9fix\u00e9es \u2018CROP_10m_*\u2019). Dans le menu, cliquer sur : Raster > Conversion > Rasteriser (vecteur vers raster) \u2026 Param\u00e9trer comme suit : N.B. Pour le param\u00e8tre \u201cEmprise du r\u00e9sultat\u201d, utiliser l\u2019option \u201cCalculer depuis la couche\u201d pour obtenir les coordonn\u00e9es extr\u00e9males de l\u2019image de r\u00e9f\u00e9rence. Le r\u00e9sultat est une image binaire, 1 pour les zones d\u2019int\u00e9r\u00eat, 0 pour le reste.","title":"5.5.3. Cr\u00e9ation\u00a0du masque en mode raster"},{"location":"docs/02_pretraitement_classification/#6-fiche-e-detection-de-changements","text":"Plusieurs solutions techniques sont possibles pour identifier les changements et tenter de les qualifier. Ces approches vont principalement de la mise \u00e0 disposition ou non de donn\u00e9es de terrain et des jeux de donn\u00e9es image disponibles. Dans le cadre de cet exercice, le jeu de donn\u00e9es est limit\u00e9 \u00e0 deux images acquises sur une m\u00eame zone \u00e0 deux dates diff\u00e9rentes. Il ne s\u2019agit donc pas d\u2019une s\u00e9rie temporelle. Pour d\u00e9tecter les changements, il est possible de produire un indice de changement en d\u00e9terminant des seuils soit manuellement soit en fonction de la distribution statistique des pixels, de tester \u00e9galement des algorithmes de classification supervis\u00e9e ou non.","title":"6. Fiche E : D\u00e9tection\u00a0de changements"},{"location":"docs/02_pretraitement_classification/#61-test-1-difference-normalisee-dindices-de-vegetation","text":"Le principe ici est de mettre en place un indice de changement en utilisant les indices NDVI ou CRSWIR calcul\u00e9s aux deux dates. Pour ce faire, \u00e0 l\u2019instar du NDVI, nous travaillons sur une diff\u00e9rence normalis\u00e9e. Ouvrir la calculatrice raster Saisir l\u2019expression suivante : (\"MASQUE_FORET@1\"=0) * 255 + (\"MASQUE_FORET@1\"=1) * ((\"NDVI_2018@1\"-\"NDVI_2017@1\")/(\"NDVI_2018@1\"+\"NDVI_2017@1\")) Enregistrer le r\u00e9sultat sous : C_RESULTS\\DIFF_CRSWIR_2017_2018_MASK.tif Pour afficher correctement l\u2019image sur QGis, il convient d\u2019indiquer la valeur 255 en no data afin d\u2019\u00e9tablir un contraste uniquement sur les valeurs du delta NDVI. Double-cliquer sur le r\u00e9sultat dans la table des couches de QGis Dans les propri\u00e9t\u00e9s de la couche, cliquer sur l\u2019onglet Transparence et saisir 255 en tant que valeur nulle compl\u00e9mentaire Le r\u00e9sultat est une image \u00e0 une bande dont les valeurs sont th\u00e9oriquement comprises entre -1 et 1. La valeur 255 \u00e9tant associ\u00e9e aux essences non suivies. Les valeurs de pixels situ\u00e9es au voisinage de 0 correspondent \u00e0 un \u00e9tat stable, celles qui tendent vers -1 refl\u00e8tent une baisse d'activit\u00e9 photosynth\u00e9tique due \u00e0 des probl\u00e8mes sanitaires, des pratiques sylvicoles ou autres. De la m\u00eame mani\u00e8re, calculer la diff\u00e9rence de CRSWIR et, Enregistrer le r\u00e9sultat sous : C_RESULTS\\DIFF_CRSWIR_2017_2018_MASK.tif Analyser visuellement le r\u00e9sultat et comparer avec la diff\u00e9rence des NDVI. \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026","title":"6.1. Test 1. Diff\u00e9rence normalis\u00e9e d\u2019indices de v\u00e9g\u00e9tation"},{"location":"docs/02_pretraitement_classification/#62-test-2-classifications-automatiques","text":"Une premi\u00e8re approche possible pour d\u00e9tecter des anomalies en milieu forestier est de faire appel \u00e0 des algorithmes de classification automatique d\u2019images, supervis\u00e9s ou non. Nous allons tester ici ces deux approches dans QGis, et cerner \u00e0 la fois leurs avantages et inconv\u00e9nients.","title":"6.2. Test 2. Classifications automatiques"},{"location":"docs/02_pretraitement_classification/#621-classification-non-supervisee","text":"La classification non supervis\u00e9e regroupe les pixels qui partagent des caract\u00e9ristiques similaires (par exemple, la radiom\u00e9trie) en classe, sans toutefois les \u00e9tiqueter. Il appartient alors \u00e0 l\u2019utilisateur d\u2019attribuer chacune des classes \u00e0 un type d\u2019occupation du sol, un type de changement, etc. Dans QGis, ouvrir \u00e0 la bo\u00eete \u00e0 outils de traitements en cliquant dans le menu sur : Traitement > Bo\u00eete \u00e0 outils Dans la bo\u00eete \u00e0 outils de traitements, affich\u00e9e par d\u00e9faut \u00e0 droite de l\u2019interface, d\u00e9rouler les menus suivants : SAGA > Image analysis Cette rubrique regroupe plusieurs outils de classification d\u2019image. Nous limiterons les tests aux seules applications utilisables avec une configuration classique de QGis. En effet, certaines applications n\u00e9cessitent l\u2019installation de d\u00e9pendances (par ex. opencv). Ouvrir l\u2019outil K-means clustering for grids, et configurer comme suit : Dans le champ Grilles, ins\u00e9rer les fichiers suivants : CROP_10m_SENTINEL2A_20180823-103535-335_L2A_T31UGP_D_V1-8_FRE_B2.tif CROP_10m_SENTINEL2A_20180823-103535-335_L2A_T31UGP_D_V1-8_FRE_B3.tif CROP_10m_SENTINEL2A_20180823-103535-335_L2A_T31UGP_D_V1-8_FRE_B4.tif CROP_10m_SENTINEL2A_20180823-103535-335_L2A_T31UGP_D_V1-8_FRE_B8.tif Dans le champ M\u00e9thode, choisir : [2] Combined Minimum Distance / Hillclimbing Dans le champ Clusters, saisir : 10 Dans le champ Maximum Iterations, saisir 10 Cocher l\u2019option Normalize Enregistrer la classification (Clusters) sous : C_RESULTS\\classif_kmeans_2018.sdat En sortie, l\u2019image est class\u00e9e en 10 classes (clusters) sans \u00e9tiquette. Attribuer une couleur et une \u00e9tiquette \u00e0 chacune des classes via les propri\u00e9t\u00e9s de la couche. Relancer cet outil en incluant cette fois soit les bandes du visible et du proche infrarouge des ann\u00e9es 2017 et 2018, soit les NDVI aux deux dates. En analysant les r\u00e9sultats, quels sont selon vous les avantages et inconv\u00e9nients de cette m\u00e9thode dans une perspective op\u00e9rationnelle ? \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026","title":"6.2.1. Classification non supervis\u00e9e"},{"location":"docs/02_pretraitement_classification/#622-classification-supervisee","text":"La classification supervis\u00e9e requiert en entr\u00e9e des donn\u00e9es d\u2019apprentissage pour entra\u00eener le mod\u00e8le de classification. Dans le cas pr\u00e9sent, il s\u2019agit des relev\u00e9s terrain. Pour les besoins de l\u2019exercice, la couche vectorielle des relev\u00e9s terrain ( A_DATA\\VECTOR\\BD_SCOLYTE\\ValidatedScolytes.shp ) a \u00e9t\u00e9 pr\u00e9trait\u00e9e de mani\u00e8re \u00e0 ne conserver que les entit\u00e9s situ\u00e9es \u00e0 l\u2019int\u00e9rieur de la zone d\u2019\u00e9tude, \u00e0 coder un champ (\u2018class\u2019) en valeur enti\u00e8re pour les parcelles saines (1) et celles impact\u00e9es (2) par le scolyte. Ouvrir la couche vectorielle : A_DATA\\VECTOR\\BD_SCOLYTE\\ValidatedScolytes.shp Dans la Bo\u00eete \u00e0 outils de traitements, ouvrir l\u2019application suivante : SAGA > Image analysis > Supervised classification for grids Param\u00e9trer comme suit : Dans le champ Entit\u00e9s, ins\u00e9rer les fichiers suivants : CROP_10m_SENTINEL2A_20180823-103535-335_L2A_T31UGP_D_V1-8_FRE_B2.tif CROP_10m_SENTINEL2A_20180823-103535-335_L2A_T31UGP_D_V1-8_FRE_B3.tif CROP_10m_SENTINEL2A_20180823-103535-335_L2A_T31UGP_D_V1-8_FRE_B4.tif CROP_10m_SENTINEL2A_20180823-103535-335_L2A_T31UGP_D_V1-8_FRE_B8.tif Cocher l\u2019option Normalize Dans le champ Training Areas, s\u00e9lectionner la couche : ValidatedScolytes.shp Dans le champ Class Identifier, s\u00e9lectionner la couche : ValidatedScolytes.shp Dans le champ M\u00e9thode, s\u00e9lectionner : [5] Spectral Angle Mapping Enregistrer la classification sous : C_RESULTS\\classif_specang_2018.sdat La qualit\u00e9 d\u2019une classification est \u00e9valu\u00e9e en g\u00e9n\u00e9ral sur le crit\u00e8re th\u00e9matique, en estimant la coh\u00e9rence de l'\u00e9tiquetage vis-\u00e0-vis de la \u201cr\u00e9alit\u00e9\u201d (cf. matrice de confusion et m\u00e9triques d\u00e9riv\u00e9es). Or, cette qualit\u00e9 d\u00e9pend du classifieur en lui-m\u00eame, mais aussi des jeux d\u2019apprentissage et des caract\u00e9ristiques descriptives (par ex. bandes spectrales d\u2019une image) utilis\u00e9es. En utilisant toujour le m\u00eame outil SAGA, Tester une \u00e0 deux autres m\u00e9thodes de classification supervis\u00e9e et, Comparer visuellement les r\u00e9sultats : \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 Ajouter simultan\u00e9ment les bandes spectrales des ann\u00e9es 2017 et 2018 et relancer la m\u00e9thode qui vous para\u00eet la plus efficace. Comparer les r\u00e9sultats avec la m\u00eame m\u00e9thode entra\u00een\u00e9e sur une seule ann\u00e9e : \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 La classification supervis\u00e9e repose sur des donn\u00e9es d\u2019apprentissage, souvent des relev\u00e9s terrain. Cette m\u00e9thode vous para\u00eet-elle adapt\u00e9e pour le suivi de ph\u00e9nom\u00e8nes \u00e9voluant dans le temps et dans l\u2019espace ? Pr\u00e9ciser les avantages et/ou inconv\u00e9nients de cette approche. \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026 \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026","title":"6.2.2. Classification supervis\u00e9e"},{"location":"docs/03_Formation_scolytes/","text":"D\u00e9tection des foyers de mortalit\u00e9 dans les massifs de conif\u00e8res par imagerie satellite Sentinel-2 Equipe de formation INRAE : Rapha\u00ebl Dutrieux, Forian de Boissieu, Jean-Baptiste Feret, Kenji Ose TP-02 : Utilisation du package fordead : d\u00e9tection de d\u00e9perissement en for\u00eat \u00e0 partir de s\u00e9ries temporelles SENTINEL-2 Introduction Pr\u00e9ambule Objectifs Pr\u00e9-requis Cr\u00e9ation d'un script pour d\u00e9tecter le d\u00e9p\u00e9rissement li\u00e9 au scolyte sur une zone donn\u00e9e \u00e0 l'aide du package fordead \u00c9tape 1 : Calcul de l'indice de v\u00e9g\u00e9tation et du masque pour chaque date SENTINEL \u00c9tape 2 : Mod\u00e9lisation du comportement p\u00e9riodique de l'indice de v\u00e9g\u00e9tation \u00c9tape 3 : D\u00e9tection du d\u00e9perissement \u00c9tape 4 : Calcul du masque for\u00eat Visualisation des r\u00e9sultats Visualisation d'un timelapse Visualisation de la s\u00e9rie temporelle de pixels en particulier Rajouter des dates SENTINEL et mettre \u00e0 jour la d\u00e9tection Changer les param\u00e8tres de la d\u00e9tection Changer l'indice de v\u00e9g\u00e9tation Changer le seuil de d\u00e9tection d'anomalies Changer de zone d'\u00e9tude Exporter des r\u00e9sultats adapt\u00e9s \u00e0 ses besoins Introduction Pr\u00e9ambule Le monde forestier fait face \u00e0 une acc\u00e9l\u00e9ration sans pr\u00e9cedent des d\u00e9perissements \u00e0 large \u00e9chelle, notamment en lien avec le changement climatique et l'apparition de ravageurs. En particulier, la crise sanitaire du scolyte met en p\u00e9ril la sant\u00e9 des for\u00eats ainsi que la fili\u00e8re bois dans le Nord-Est de la France. Pour r\u00e9pondre \u00e0 cet enjeu, des travaux R&D ont \u00e9t\u00e9 men\u00e9s par l\u2019UMR TETIS (INRAE, anciennement IRSTEA) \u00e0 la demande du Minist\u00e8re de l\u2019Agriculture et de l\u2019Alimentation pour mettre au point un outil d\u2019identification des foyers de scolytes par t\u00e9l\u00e9d\u00e9tection de mani\u00e8re pr\u00e9coce et en continu. Cet outil prend aujourd'hui la forme du package python fordead permettant une cartographie des d\u00e9perissements \u00e0 partir d'images SENTINEL-2, potentiellement mise \u00e0 jour \u00e0 chaque revisite des satellites SENTINEL-2. Objectifs Les objectifs de ce TD sont les suivants : - \u00eatre capable de faire fonctionner l'ensemble des \u00e9tapes permettant la cartographie des d\u00e9perissements sur une zone donn\u00e9e, ainsi que comprendre l'articulation de ces diff\u00e9rentes \u00e9tapes - Savoir modifier les param\u00e8tres de l'outil afin de pouvoir s'adapter selon la probl\u00e9matique - Faire sortir les r\u00e9sultats sous la forme souhait\u00e9e - Visualiser ces r\u00e9sultats - Appr\u00e9hender le potentiel et les limites de l'outil Pr\u00e9-requis Si le package n'est pas encore install\u00e9, suivre le guide d'installation . Sinon, lancer l'invit\u00e9 de commande anaconda prompt , puis activer l'environnement par la commande : conda activate ForDeadEnv Cr\u00e9ation d'un script pour d\u00e9tecter le d\u00e9p\u00e9rissement li\u00e9 au scolyte sur une zone donn\u00e9e \u00e0 l'aide du package fordead La d\u00e9tection du d\u00e9perissement permet d'utiliser l'ensemble des donn\u00e9es SENTINEL-2 depuis le lancement du premier satellite. M\u00eame en prenant une seule tuile, un tel jeu de donn\u00e9es p\u00e8se plusieurs centaines de gigaoctets et prend plusieurs heures de temps de calcul pour r\u00e9aliser l'ensemble des \u00e9tapes de d\u00e9tection du d\u00e9perissement. Pour cette raison, un jeu de donn\u00e9es plus r\u00e9duit a \u00e9t\u00e9 pr\u00e9par\u00e9 pour cette formation. Il contient l'ensemble des donn\u00e9es SENTINEL-2 disponible sur une zone d'\u00e9tude restreinte, en croppant \u00e0 partir des donn\u00e9es de la tuile. Cette zone est touch\u00e9e par les scolytes, et contient plusieurs polygones de donn\u00e9es de validation, ce qui en fait un bon exemple pour l'application de la d\u00e9tection de d\u00e9perissement et la visualisation des r\u00e9sultats. Cr\u00e9er un script python en cr\u00e9ant un nouveau fichier de texte dans le dossier /B_PROGRAMS, et en le nommant detection_scolytes.py (ou le nom de votre choix, mais avec l'extension .py) Ouvrez ce script avec l'\u00e9diteur de votre choix \u00c9tape 1 : Calcul de l'indice de v\u00e9g\u00e9tation et du masque pour chaque date SENTINEL La premi\u00e8re \u00e9tape consiste \u00e0 calculer pour chaque date l'indice de v\u00e9g\u00e9tation, et le masque. Le masque correspond \u00e0 l'ensemble des donn\u00e9es invalides, car ennuag\u00e9es, enneig\u00e9es, dans l'ombre, hors de la fauch\u00e9e du satellite, peuplement d\u00e9j\u00e0 coup\u00e9... Vous pouvez retrouver le guide d'utilisation de cette \u00e9tape . Faire tourner l'\u00e9tape \u00e0 partir du script Pour effectuer cette \u00e9tape, ajoutez dans le script : - Pour importer la fonction from fordead.steps.step1_compute_masked_vegetationindex import compute_masked_vegetationindex Pour choisir les param\u00e8tres en entr\u00e9e : input_directory = \"<MyWorkingDirectory>/A_DATA/RASTER/SERIES_SENTINEL/ZoneEtude\" data_directory = \"<MyWorkingDirectory>/C_RESULTS/ZoneEtude\" NOTE : Il est pr\u00e9f\u00e9rable d'utiliser \"/\" plut\u00f4t que \"\\\" \u00e0 l'\u00e9criture des chemins afin d'\u00e9viter les soucis. Pour lancer la fonction compute_masked_vegetationindex ( input_directory = input_directory, data_directory = data_directory ) Puis lancer le script python depuis l'invit\u00e9 de commande en vous pla\u00e7ant dans le r\u00e9pertoire du script en utilisant la commande suivante : cd <MyWorkingDirectory>/B_PROGRAMS Puis lancer le script : python detection_scolytes.py Faire tourner l'\u00e9tape en lan\u00e7ant la fonction depuis l'invit\u00e9 de commande Il est \u00e9galement possible d'appliquer la m\u00eame \u00e9tape en passant par l'invit\u00e9 de commande. Depuis l'invit\u00e9 de commande, placez vous dans le dossier du package fordead_package/fordead/steps par la commande : cd <MyWorkingDirectory>/B_PROGRAMS/Libraries/fordead_package/fordead/steps Puis, la commande suivante permet d'afficher l'aide : python step1_compute_masked_vegetationindex.py -h A partir de l'aide, lancez la fonction en appliquant vos param\u00e8tres. Exemple : python step1_compute_masked_vegetationindex.py -i <MyWorkingDirectory>/A_DATA/RASTER/SERIES_SENTINEL/ZoneEtude -o <MyWorkingDirectory>/C_RESULTS/ZoneEtude NOTE : -i permet de d\u00e9finir le param\u00e8tre input_directory et -o le param\u00e8tre data_directory , ainsi exactement la m\u00eame fonction est lanc\u00e9e. Vous remarquerez que si vous avez utilis\u00e9 les m\u00eame param\u00e8tres dans les deux cas, il s'affiche \"0 new SENTINEL dates\" et le programme tourne plus rapidement la deuxi\u00e8me fois, car les indices de v\u00e9g\u00e9tation d\u00e9j\u00e0 calcul\u00e9s ne sont pas recalcul\u00e9s. En revanche, si vous changez les param\u00e8tres, les r\u00e9sultats pr\u00e9c\u00e9dants seront supprim\u00e9s et remplac\u00e9s. Les param\u00e8tres input_directory et data_directory sont les deux seuls \u00e0 ne pas conna\u00eetre de valeur par d\u00e9faut puisqu'elles d\u00e9pendent de l'emplacement de vos fichiers. Ce sont donc les deux seuls param\u00e8tres \u00e0 renseigner obligatoirement, mais il est tout de m\u00eame possible de modifier les autres param\u00e8tres. A l'aide du guide d'utilisateur, v\u00e9rifiez que vous comprenez le sens des diff\u00e9rents param\u00e8tres et n'h\u00e9sitez pas \u00e0 poser des questions si ce n'est pas le cas ! L'ensemble des \u00e9tapes de la d\u00e9tection peuvent se r\u00e9aliser de mani\u00e8re identique depuis l'invit\u00e9 de commande, ou par import des diff\u00e9rentes fonctions dans un script. Dans la suite de ce TD, nous nous focaliseront sur le script en le compl\u00e9tant au fur et \u00e0 mesure. Observation des sorties Pour mieux vous repr\u00e9senter les sorties de cette \u00e9tape, lancez QGIS et ajoutez les rasters VegetationIndex/VegetationIndex_2018-07-27.tif et Mask/Mask_2018-07-27.tif . Nous allons \u00e9galement comparer ces exports avec les rasters des donn\u00e9es SENTINEL-2 dont ils sont issus. Pour cela, allez dans le dossier /A_DATA/RASTER/SERIES_SENTINEL/ZoneEtude/SENTINEL2A_20180727-104023-458_L2A_T31UGP_D_V1-8 , puis rajoutez les bandes B2, B3, B4 \u00e0 QGIS, soit respectivement les bandes rouge, vert et bleu. Ensuite, nous allons cr\u00e9er un raster virtuelle \u00e0 partir de ces trois bandes pour visualiser une image en couleur. - Aller dans Raster/Divers/Construire un raster virtuel - S\u00e9lectionner les bandes ajout\u00e9es - Cocher pour que chaque fichier de bande aille dans une bande diff\u00e9rente - Executer - Aller dans les propri\u00e9t\u00e9s du raster cr\u00e9e - Les bandes devraient ne pas \u00eatre dans le bon ordre, mettre la bande 3 en rouge et la bande 1 en bleu. Modifiez l'\u00e9chelle pour aller de 0 \u00e0 600 pour chaque bande. Observez les r\u00e9sultats. Les rasters dans le dossier DataSoil contiennent les informations relatives \u00e0 la d\u00e9tection du sol nu. Ce sol d\u00e9tect\u00e9 peut correspondre \u00e0 des zones non foresti\u00e8res, \u00e0 des peuplements feuillus dont le sol est d\u00e9tect\u00e9 en hiver, ou des coupes rases. Il y a trois rasters, qui, ensemble, permettent de reconstituer l'ensemble de l'information, et de la mettre \u00e0 jour avec l'arriv\u00e9e de nouvelles dates SENTINEL : - Le raster count_soil.tif compte le nombre d'anomalies de sol successives. - Lorsque count_soil atteint 3, pour trois anomalies successives, le raster state_soil.tif passe de 0 \u00e0 1. Les pixels avec la valeur 1 correspondent donc \u00e0 ceux d\u00e9tect\u00e9s comme sol nu / coupe au bout de l'analyse de l'ensemble des dates. - Le raster first_date_soil.tif contient l'index de la date de premi\u00e8re anomalie de sol. Si state_soil vaut 1, il s'agit alors de la date \u00e0 partir de laquelle le sol est d\u00e9tect\u00e9e. Ces rasters peuvent \u00eatre difficiles \u00e0 analyser puisque, n'\u00e9tant pas possible de mettre une date dans un raster, le raster first_date_soil contient l'index de la date qui peut \u00eatre interpr\u00e9t\u00e9 par le package dans les \u00e9tapes suivantes. \u00c9tape 2 : Mod\u00e9lisation du comportement p\u00e9riodique de l'indice de v\u00e9g\u00e9tation Pour mod\u00e9liser le comportement normal de l'indice de v\u00e9g\u00e9tation, on utilise seulement les dates SENTINEL les plus anciennes, en faisant l'hypoth\u00e8se qu'elles sont ant\u00e9rieures \u00e0 un possible d\u00e9perissement. La fonction harmonique suivante est ajust\u00e9e \u00e0 ces donn\u00e9es : \ud835\udc87(\ud835\udc95)=\ud835\udc82\ud835\udfcf+\ud835\udc83\ud835\udfcf.\ud835\udc2c\ud835\udc22\ud835\udc27\u2061(\ud835\udfd0\ud835\udf45\ud835\udc95/\ud835\udc47)+\ud835\udc83\ud835\udfd0.\ud835\udc1c\ud835\udc28\ud835\udc2c\u2061(\ud835\udfd0\ud835\udf45\ud835\udc95/\ud835\udc47)+\ud835\udc83\ud835\udfd1.\ud835\udc2c\ud835\udc22\ud835\udc27\u2061(\ud835\udfd2\ud835\udf45\ud835\udc95/\ud835\udc47)+\ud835\udc83\ud835\udfd2.\ud835\udc1c\ud835\udc28\ud835\udc2c\u2061(\ud835\udfd2\ud835\udf45\ud835\udc95/\ud835\udc47) o\u00f9 T = 365,25. Vous pouvez retrouver le guide d'utilisation de cette \u00e9tape . Pour effectuer cette \u00e9tape, ajoutez dans le script : - Pour importer la fonction from fordead.steps.step2_train_model import train_model Pour lancer la fonction train_model ( data_directory = data_directory ) Puis, comme pour l'\u00e9tape 1, relancez le script depuis l'invit\u00e9 de commande : python detection_scolytes.py Le reste des param\u00e8tres connaissent une valeur par d\u00e9faut dans la fonction et n'ont pas besoin d'\u00eatre renseign\u00e9es. Ces valeurs par d\u00e9faut ont \u00e9t\u00e9 d\u00e9termin\u00e9es de mani\u00e8re empirique pour la probl\u00e9matique du scolyte et peuvent ne pas \u00eatre optimales selon la localisation ou la probl\u00e9matique donn\u00e9e. Le guide d'utilisation donne des d\u00e9tails sur les diff\u00e9rents param\u00e8tres, lisez le et v\u00e9rifiez que vous comprenez bien leur sens. NOTE : Si l'utilisateur ne souhaite pas utiliser la premi\u00e8re \u00e9tape et choisit de calculer ses propres indices de v\u00e9g\u00e9tations et masques. Il peut sauter l'\u00e9tape 1 et simplement donner le chemin de son dossier d'indices de v\u00e9g\u00e9tation avec le param\u00e8tre path_vi et son dossier de masques avec path_masks . Il suffit simplement que le nom des rasters contiennent la date sous un des formats suivants : AAAA-MM-JJ, AAAA_MM_JJ, AAAAMMJJ, JJ-MM-AAAA, JJ_MM_AAAA ou JJMMAAAA. Observation des sorties Dans le dossier DataModel : - Ouvrez le raster coeff_model.tif dans QGIS. Faites un clique droit sur un des pixels, vous pouvez constater qu'il s'agit d'un raster \u00e0 cinq bandes. QGIS affiche une image en RGB \u00e0 partir des trois premi\u00e8res bandes. Chacune des bandes correspond \u00e0 un des coefficients (a1, b1, b2, b3, b4) du mod\u00e8le (voir \u00e9quation). On a bien un mod\u00e8le diff\u00e9rent par pixel ce qui permet qu'il soit adapt\u00e9 aux conditions de ce pixel. On peut en effet imaginer que la composition du peuplement, sa surface terri\u00e8re, sa pente, son exposition ont probablement un r\u00f4le \u00e0 jouer dans la valeur donn\u00e9e des indices de v\u00e9g\u00e9tation. A partir de ces coefficients, il est possible de pr\u00e9dire l'indice de v\u00e9g\u00e9tation \u00e0 n'importe quelle date, pour un peuplement sain. Ouvrez maintenant le raster first_detection_date_index.tif. Il permet de conna\u00eetre pour chaque pixel les dates utilis\u00e9es pour l'apprentissage du mod\u00e8le, et celles utilis\u00e9es pour la d\u00e9tection de d\u00e9perissement. Il contient l'index de la premi\u00e8re date \u00e0 partir de laquelle le d\u00e9perissement est d\u00e9tect\u00e9. Sur cette zone, il y a assez de dates valides pour que l'ensemble des pixels terminent leur apprentissage avant la premi\u00e8re date de 2018 (le param\u00e8tre min_last_date_training est fix\u00e9 \u00e0 2018-01-01 par d\u00e9faut ce qui permet d'avoir un recul de deux ans d'images satellites SENTINEL-2), ils ont donc tous la m\u00eame valeur sauf les zones \"sans donn\u00e9es\" qui correspondent aux zones d\u00e9tect\u00e9es comme \"sol nu / coupe\" tr\u00e8s t\u00f4t, qui sont donc masqu\u00e9es sur la quasi-totalit\u00e9 des dates et qui n'ont donc pas le nombre de dates valides minimum pour le calcul du mod\u00e8le. Dans le dossier ForestMask, ouvrez \u00e9galement le raster valid_area_mask.tif. Il s'agit d'un raster binaire qui vaut 1 l\u00e0 o\u00f9 il y avait suffisamment de dates valides pour le calcul du mod\u00e8le et 0 ailleurs. \u00c9tape 3 : D\u00e9tection du d\u00e9perissement Lors de cette \u00e9tape, pour chaque date SENTINEL non utilis\u00e9e pour l'apprentissage, l'indice de v\u00e9g\u00e9tation r\u00e9el est compar\u00e9 \u00e0 l'indice de v\u00e9g\u00e9tation pr\u00e9dit \u00e0 partir des mod\u00e8les calcul\u00e9s dans l'\u00e9tape pr\u00e9c\u00e8dente. Si la diff\u00e9rence d\u00e9passe un seuil, une anomalie est d\u00e9tect\u00e9e. Si trois anomalies successives sont d\u00e9tect\u00e9es, le pixel est consid\u00e9r\u00e9 comme d\u00e9p\u00e9rissant. Si apr\u00e8s avoir \u00e9t\u00e9 d\u00e9tect\u00e9 comme d\u00e9perissant, le pixel a trois dates successives sans anomalies, il n'est plus consid\u00e9r\u00e9 comme d\u00e9p\u00e9rissant. N'h\u00e9sitez pas \u00e0 consulter le guide d'utilisation de cette \u00e9tape. Pour effectuer cette \u00e9tape, ajouter au script : - Pour importer la fonction from fordead.steps.step3_decline_detection import decline_detection Pour lancer la fonction decline_detection ( data_directory = data_directory ) Puis, relancez le script depuis l'invit\u00e9 de commande : python detection_scolytes.py Observation des sorties Pour chaque date post\u00e9rieure \u00e0 la date renseign\u00e9e par le param\u00e8tre min_last_date_training , un raster Anomalies_ .tif est export\u00e9 dans le dossier DataAnomalies . - Ouvrez dans QGIS le raster Anomalies_2018-07-27.tif . - Mettez en regard ces r\u00e9sultats avec l'indice de v\u00e9g\u00e9tation et le masque calcul\u00e9 pour la date et ouvert pr\u00e9c\u00e9demment, ainsi que l'image en RGB. On peut voir que des anomalies sont d\u00e9tect\u00e9es m\u00eame l\u00e0 o\u00f9 les donn\u00e9es sont masqu\u00e9es, comme pour les nuages sur la gauche de l'image, o\u00f9 les zones d\u00e9tect\u00e9es comme sol nu. Ces anomalies ne sont bien entendu pas prises en compte. Les anomalies pouvant correspondre \u00e0 des d\u00e9gats de scolytes sont celles qui ne sont pas masqu\u00e9es. Un autre dossier a \u00e9t\u00e9 cr\u00e9e, DataDecline. Les rasters de ce dossier contiennent les informations relatives \u00e0 la d\u00e9tection de d\u00e9p\u00e9rissement \u00e0 partir des anomalies observ\u00e9es pr\u00e9c\u00e9demment. Ces rasters sont exactement sous la m\u00eame forme que les rasters dans DataSoil observ\u00e9s lors de l'\u00e9tape 1. La seule diff\u00e9rence est que un \"retour \u00e0 la normale\" est possible. Une fois que le sol est d\u00e9tect\u00e9, l'\u00e9tat \"sol nu\" est permanent, tandis que pour le d\u00e9p\u00e9rissement, un pixel d\u00e9tect\u00e9 comme d\u00e9p\u00e9rissant peut retourner \u00e0 l'\u00e9tat non-d\u00e9p\u00e9rissant s'il y a trois dates successives sans anomalies. Cela permet d'\u00e9viter des faux positifs caus\u00e9s par des stress hydriques importants mais temporaires et ne causant pas de d\u00e9p\u00e9rissement. Les informations de ces rasters sont les suivantes : - le raster state_decline.tif, un raster binaire qui vaut 1 pour les pixels d\u00e9p\u00e9rissants, 0 pour les pixels sains - Le raster count_decline.tif compte le nombre d'anomalies successives pour les pixels sains dans state_decline, ou le nombre de dates sans anomalies successives pour les pixels d\u00e9p\u00e9rissants dans state_decline. Quand count_decline atteint trois, le pixel change d'\u00e9tat, de sain \u00e0 d\u00e9p\u00e9rissant ou inversement. - Le raster first_date_decline.tif contient l'index de la date de premi\u00e8re anomalie. Si state_decline vaut 1, il s'agit alors de la date \u00e0 partir de laquelle le d\u00e9p\u00e9rissement est d\u00e9t\u00e9ct\u00e9. \u00c9tape 4 : Calcul du masque for\u00eat L'ensemble des calculs pr\u00e9cedents sont r\u00e9alis\u00e9s sur l'ensemble des pixels de la zone d'\u00e9tude. Cependant, en particulier lorsqu'on travaille sur de larges zones, il est n\u00e9cessaire de d\u00e9finir les zones d'int\u00e9r\u00eats pour ne pas interpr\u00e9ter des r\u00e9sultats sur des zones urbaines, des cultures, etc... Dans le cas du scolyte, on s'int\u00e9resse uniquement aux peuplements forestiers r\u00e9sineux. Cette \u00e9tape permet de cr\u00e9er le masque for\u00eat correspondant \u00e0 notre zone d'int\u00e9r\u00eat. Vous pouvez consulter son guide d'utilisation . Pour effectuer cette \u00e9tape, ajouter au script : - Pour importer la fonction from fordead.steps.step4_compute_forest_mask import compute_forest_mask Pour lancer la fonction compute_forest_mask ( data_directory, forest_mask_source = 'BDFORET' , dep_path = \"<MyWorkingDirectory>/A_DATA/VECTOR/BD_ADMIN/departements-20140306-100m.shp\" , bdforet_dirpath = \"<MyWorkingDirectory>/A_DATA/VECTOR/BD_FORET\" ) Puis, relancez le script depuis l'invit\u00e9 de commande : python detection_scolytes.py NOTE : Il est possible d'utiliser cette \u00e9tape d\u00e9connect\u00e9e des autres en pr\u00e9cisant le param\u00e8tre path_example_raster avec le chemin d'un raster \"exemple\" qui donnera son syst\u00e8me de projection, sa r\u00e9solution, son extent au masque produit. Ne pas renseigner ce param\u00e8tre ne pose pas de soucis puisque le chemin d'un raster exemple peut \u00eatre r\u00e9cup\u00e9r\u00e9 depuis les \u00e9tapes pr\u00e9c\u00e9dentes par le biais du fichier TileInfo. Observation des sorties Cette \u00e9tape permet d'\u00e9crire un uniquement raster, Forest_Mask.tif dans le dossier ForestMask. Ouvrez ce raster. Il s'agit d'un raster binaire qui vaut 1 dans la zone d'int\u00e9r\u00eat, 0 ailleurs. Avec les param\u00e8tres renseign\u00e9s ici, il est cr\u00e9e \u00e0 partir de la rasterisation de la BD For\u00eat de l'IGN en gardant uniquement les peuplements r\u00e9sineux. Visualisation des r\u00e9sultats Les \u00e9tapes r\u00e9alis\u00e9es pr\u00e9c\u00e9demment ont permis d'obtenir l'ensemble des r\u00e9sultats relatifs \u00e0 la d\u00e9tection de scolytes, mais sous une forme difficile \u00e0 analyser. Le package contient certains outils permettant de visualiser les r\u00e9sultats sous une forme plus digeste. Cr\u00e9ation d'un timelapse Pour commencer, nous allons cr\u00e9er un timelapse de la d\u00e9tection sur la zone analys\u00e9e. Pour ce faire, ajouter dans le script : - Pour importer la fonction from fordead.visualisation.create_timelapse import create_timelapse Pour ajouter les param\u00e8tres n\u00e9c\u00e9ssaires : shape_path = \"<MyWorkingDirectory>/A_DATA/VECTOR/ZONE_ETUDE/ZoneEtude.shp\" Pour lancer la fonction : create_timelapse ( data_directory = data_directory,shape_path = shape_path, obs_terrain_path = \"<MyWorkingDirectory>/A_DATA/VECTOR/BD_SCOLYTE/ValidatedScolytes.shp\" ) Enfin, relancez le script. Cette fonction prend en entr\u00e9e un shapefile avec un champ \"Id\" dans lequel il peut y avoir un ou plusieurs polygones et \u00e9crit pour chaque polygone un fichier .html dans le dossier \"Timelapses\". Elle est plut\u00f4t pens\u00e9e pour visualiser les r\u00e9sultats sur une zone r\u00e9duite \u00e0 partir des r\u00e9sultats d'une tuile enti\u00e8re, il est recommand\u00e9 d'\u00e9viter de lancer cette op\u00e9ration avec des polygones de plus d'une vingtaine de km\u00b2. Cependant, on travaille ici d\u00e9j\u00e0 sur une zone r\u00e9duite, en utilisant un shapefile d'un seul polygone couvrant l'ensemble de la zone. Le timelapse devrait se lancer automatiquement, sinon ouvrez le fichier .html (il est possible que sa lecture fonctionne mieux sous Chrome). Une fois le timelapse ouvert, faites glisser le slider en bas de l'image pour vous d\u00e9placer temporellement dans l'animation. Les polygones noirs correspondent aux zones d\u00e9tect\u00e9es comme sol nu, les polygones jaunes correspondent aux zones d\u00e9tect\u00e9es comme d\u00e9p\u00e9rissantes et les polygones bleus correspondent aux coupes sanitaires, c'est \u00e0 dire les zones d\u00e9tect\u00e9es comme sol-nu/coupe apr\u00e8s avoir \u00e9t\u00e9 d\u00e9tect\u00e9es comme atteintes. Les donn\u00e9es d'observation sur le terrain sont \u00e9galement affich\u00e9es, passez la souris sur ces polygones pour obtenir leurs informations : | : . Sur cette zone, on peut observer des zones saines en vert fonc\u00e9 et des zones scolyt\u00e9es au stade rouge en rouge. Vous pouvez \u00e9galement zoomer sur la zone souhait\u00e9e en maintenant le clique appuy\u00e9 tout en d\u00e9limitant une zone. Vous pouvez ensuite d\u00e9zoomer en double cliquant sur l'image. Passer la souris sur un pixel permet \u00e9galement d'obtenir ses informations : - x : coordonn\u00e9es en x - y : coordonn\u00e9es en y - z : [ , , ], c'est \u00e0 dire la valeur de la bande SENTINEL correspondante \u00e0 la date donn\u00e9e. Les r\u00e9sultats apparaissent \u00e0 la date de la premi\u00e8re anomalie, confirm\u00e9e par la suite. Les fausses d\u00e9tections li\u00e9es \u00e0 un stress hydrique temporaire et corrig\u00e9es par la suite n'apparaissent pas. De m\u00eame, pour les derni\u00e8res dates, il peut y avoir des anomalies n'apparaissant pas encore par manque de dates valides pour confirmer la d\u00e9tection. Prenez le temps d'explorer cet outil et les r\u00e9sultats de la d\u00e9tection. Vous pouvez remarquer que les polygones observ\u00e9s comme atteints sur le terrain sont d\u00e9tect\u00e9s comme atteints avant la date d'observation, tandis que les polygones observ\u00e9s comme sains sont encore sains \u00e0 la date d'observation, mais pas forc\u00e9ment par la suite. Visualisation de la s\u00e9rie temporelle de pixels en particulier Lors de la visualisation du timelapse, vous avez pu vous poser des questions sur les r\u00e9sultats de pixels en particulier. L'outil suivant va permettre d'afficher l'ensemble de la s\u00e9rie temporelle utilis\u00e9e pour un pixel en particulier, mis en relation avec les r\u00e9sultats de l'algorithme. Pour utiliser cet outil, ajouter dans le script : Pour importer la fonction from fordead.visualisation.vi_series_visualisation import vi_series_visualisation Pour lancer la fonction : vi_series_visualisation ( data_directory = data_directory ) De plus, pour \u00e9viter que le timelapse soit recalcul\u00e9, mettez en commentaire la fonction \u00e0 l'origine du timelapse en ajoutant \"#\" en d\u00e9but de ligne. Toute ligne comment\u00e9e est ignor\u00e9e au lancement du script : #create_timelapse(data_directory = data_directory,shape_path = shape_path, obs_terrain_path = obs_terrain_path) Enfin, relancez le script Cette fonction permet de donner les coordonn\u00e9es en X,Y du pixel souhait\u00e9 afin d'en visualiser les r\u00e9sultats. A l'aide du timelapse r\u00e9alis\u00e9 pr\u00e9c\u00e9demment, choisissez un pixel, r\u00e9cup\u00e9rez ses coordonn\u00e9es en passant votre souris sur celui ci, puis renseignez ces coordonn\u00e9es dans l'invit\u00e9 de commande qui devrait indiquer : X ? Puis Y ? Un graphique doit alors s'afficher, avec la l\u00e9gende associ\u00e9e. Chaque point correspond \u00e0 une date SENTINEL valide, avec la valeur de l'indice de v\u00e9g\u00e9tation calcul\u00e9. V\u00e9rifiez que vous comprenez chaque \u00e9l\u00e9ment du graphique, et n'h\u00e9sitez pas \u00e0 poser la question s'il y a des points de doute. Apr\u00e8s avoir ferm\u00e9 le graphique, vous pourrez renseigner d'autres coordonn\u00e9es. R\u00e9p\u00e9tez cette op\u00e9ration pour au moins cinq pixels : - Un pixel qui reste sain jusqu'\u00e0 la derni\u00e8re date SENTINEL disponible - Un pixel manifestement atteint \u00e0 la derni\u00e8re date SENTINEL disponible - Un pixel atteint puis coup\u00e9 - Un pixel coup\u00e9 sans avoir \u00e9t\u00e9 d\u00e9tect\u00e9 comme atteint - Un pixel hors du masque for\u00eat. Ce masque n'est pas renseign\u00e9 sur le timelapse, mais vous pouvez deviner que certaines zones auraient d\u00fb \u00eatre d\u00e9tect\u00e9es comme \"sol nu\" \u00e0 certaines parties de l'ann\u00e9e. Ou vous pouvez vous aider du masque for\u00eat ouvert dans QGIS. Vous pouvez aussi appuyer sur Entr\u00e9e sans renseigner de coordonn\u00e9e X, dans ce cas, la fonction affiche la s\u00e9rie temporelle d'un pixel au hasard au sein du masque for\u00eat. Prenez le temps d'observer les pixels qui vous int\u00e9ressent. Une fois que vous avez termin\u00e9 vos observations, renseignez -1 comme coordonn\u00e9e X pour terminer le programme. L'ensemble des graphiques ayant \u00e9t\u00e9 cr\u00e9es sont disponibles dans le dossier \"SeriesTemporelles\". NOTE : Il est \u00e9galement possible d'utiliser la fonction vi_series_visualisation en ajoutant le param\u00e8tre shape_path = . Ce shapefile de points doit contenir un champ \"id\" avec un identifiant num\u00e9rique pour chaque point. Les pixels correspondants \u00e0 chaque point sont alors identifi\u00e9s et leurs graphiques sont sauvegard\u00e9s dans le dossier \"SeriesTemporelles\". Cela permet de r\u00e9aliser ces graphiques sans passer par la cr\u00e9ation du timelapse pour r\u00e9cup\u00e9rer les coordonn\u00e9es X,Y qui ne sont pas associ\u00e9es \u00e0 un syst\u00e8me de projection. Rajouter des dates SENTINEL et mettre \u00e0 jour la d\u00e9tection L'algorithme permet \u00e9galement de mettre \u00e0 jour la d\u00e9tection avec de nouvelles images SENTINEL. Nous utilisions auparavant les dates SENTINEL depuis les premi\u00e8res images jusqu'au 01/06/2020. Dans le dossier /A_DATA/RASTER/SERIES_SENTINEL/MAJ_ZoneEtude sont disponibles les dates SENTINEL allant jusqu'\u00e0 la fin de 2020. Nous allons mettre \u00e0 jour la d\u00e9tection \u00e0 partir de ces donn\u00e9es. Pour ce faire : Copiez ou coupez ces donn\u00e9es dans le dossier /A_DATA/RASTER/SERIES_SENTINEL/ZoneEtude D\u00e9commentez la fonction permettant de cr\u00e9er le timelapse en retirant le \"#\" Coupez-collez le dossier \"Timelapses\" et \"SeriesTemporelles\" dans un autre dossier, par exemple en cr\u00e9ant un dossier /C_RESULTS/Save_ZoneEtude. Cela permettra de comparer avant et apr\u00e8s mise \u00e0 jour, puisque les nouveaux timelapses et graphiques cr\u00e9es remplaceront les anciens. C'est optionnel mais permettra de ne rien \u00e9craser. relancez le script On peut voir que l'algorithme ne r\u00e9alise les calculs que sur les nouvelles dates, \u00e0 partir du mod\u00e8le d\u00e9j\u00e0 \u00e9tabli. Prenez le temps d'examiner les nouveaux r\u00e9sultats, et \u00e9ventuellement de les comparer avec les anciens. Changer les param\u00e8tres de la d\u00e9tection Depuis le d\u00e9but de ce TD, nous avons laiss\u00e9 tous les param\u00e8tres \u00e0 leur valeur par d\u00e9faut. Ces valeurs ont \u00e9t\u00e9 d\u00e9termin\u00e9es de mani\u00e8re empirique pour la d\u00e9tection de scolytes. Il est int\u00e9ressant de savoir modifier ces param\u00e8tres afin de s'adapter \u00e0 des situations locales, ou d'autres probl\u00e9matiques. Pour commencer, supprimez l'ensemble des couches rajout\u00e9es \u00e0 QGIS li\u00e9es aux r\u00e9sultats pr\u00e9c\u00e9dents (pas besoin de retirer le raster virtuel en RGB). Le changement des param\u00e8tres entra\u00eenera la suppression des r\u00e9sultats pr\u00e9c\u00e9dents, si ils sont ouverts dans QGIS, ils ne pourront pas \u00eatre supprim\u00e9s et cela occasionnera des bugs. Changer l'indice de v\u00e9g\u00e9tation L'indice de v\u00e9g\u00e9tation utilis\u00e9 jusqu'ici est le CRSWIR, sensible \u00e0 la teneur en eau. La teneur en eau \u00e9tant la premi\u00e8re caract\u00e9ristique de la v\u00e9g\u00e9tation affect\u00e9e lors d'attaques de scolytes, il donne de bons r\u00e9sultats pour la d\u00e9tection de scolytes. Cependant, il existe d'autres indices de v\u00e9g\u00e9tation, dont le plus connu est probablement le NDVI, plut\u00f4t sensible \u00e0 l'activit\u00e9 photo-synth\u00e9tique, les pigments chlorophylliens... - L'utilisation du NDVI est d\u00e9j\u00e0 pr\u00e9vue dans le package, pour l'utiliser il suffit donc simplement de rajouter le param\u00e8tre vi = \"NDVI\" dans la fonction compute_masked_vegetationindex : compute_masked_vegetationindex ( input_directory = input_directory, data_directory = data_directory, vi = \"NDVI\" ) Rajouter les param\u00e8tres ymin = 0, ymax = 1.1 \u00e0 la fonction vi_series_visualisation(data_directory = data_directory) . Ces param\u00e8tres permettent de donner les limites en ordonn\u00e9e des graphiques de s\u00e9ries temporelles, car le NDVI n'a pas la m\u00eame \u00e9chelle que le CRSWIR. vi_series_visualisation ( data_directory = data_directory,ymin = 0 , ymax = 1 .1 ) Sauvegardez vos visualisations si vous souhaitez effectuer une comparaison (optionnel) Relancez le script. Prenez le temps de visualiser les r\u00e9sultats. Utiliser un indice de v\u00e9g\u00e9tation non pr\u00e9vu dans le package La version actuelle du package ne pr\u00e9voit que les indices de v\u00e9g\u00e9tation \"CRSWIR\" et \"NDVI\". Nous allons donc maintenant apprendre comment rajouter n'importe quel indice de v\u00e9g\u00e9tation pour l'utiliser dans la d\u00e9tection. Par exemple, prenons le NDWI (Normalized Difference Water Index), un indice de v\u00e9g\u00e9tation li\u00e9 \u00e0 la teneur en eau de la v\u00e9g\u00e9tation qui suit la formule suivante : \\frac{B8A-B11}{B8A+B11} Cr\u00e9er un fichier texte dict_vi.txt dans le dossier /B_PROGRAMS (Vous pouvez en r\u00e9alit\u00e9 utiliser le nom et dossier de votre choix) Dans ce fichier texte, ajoutez la ligne suivante, avant de sauvegarder : NDWI ( B8A-B11 ) / ( B8A+B11 ) - o\u00f9 \"NDWI\" est le nom de l'indice, \"(B8A-B11)/(B8A+B11)\" est sa formule, et \"-\" est la direction vers laquelle l'indice de v\u00e9g\u00e9tation tend lorsqu'il y a d\u00e9perissement. L'algorithme accepte \"-\" ou \"+\", on a d\u00e9j\u00e0 pu voir que le CRSWIR augmente en cas de d\u00e9perissement, tandis que le NDVI diminue. - Ajouter dans le script le param\u00e8tre path_dict_vi = \"<MyWorkingDirectory>/B_PROGRAMS/dict_vi.txt\" \u00e0 la fonction compute_masked_vegetationindex , et changer le nom de l'indice de v\u00e9g\u00e9tation pour \"NDWI\" : compute_masked_vegetationindex ( input_directory = input_directory, data_directory = data_directory, vi = \"NDWI\" , path_dict_vi = \"<MyWorkingDirectory>/B_PROGRAMS/dict_vi.txt\" ) Relancez le script Observez les r\u00e9sultats Changer le seuil de d\u00e9tection d'anomalies Le seuil de d\u00e9tection des anomalies est r\u00e9gl\u00e9 par d\u00e9faut \u00e0 0.16, c'est \u00e0 dire que la diff\u00e9rence entre la courbe \"Mod\u00e9lisation de l'indice de v\u00e9g\u00e9tation sur les dates d'apprentissage\" et la courbe \"Seuil de d\u00e9tection des anomalies\" est de 0.16. Il n'y a pas de raisons que ce seuil soit identique entre les diff\u00e9rents indices de v\u00e9g\u00e9tations. Modifiez ce seuil en rajoutant le param\u00e8tre threshold_anomaly = 0.12 \u00e0 la fonction decline_detection : decline_detection ( data_directory = data_directory, threshold_anomaly = 0 .12 ) Essayez diff\u00e9rents seuils, observez les r\u00e9sultats. Plus ce seuil est \u00e9lev\u00e9, moins la d\u00e9tection est sensible. Il y a un juste milieu \u00e0 trouver afin de d\u00e9tecter les d\u00e9perissements le plus pr\u00e9cocement possible, en \u00e9vitant les faux positifs. Changer de zone d'\u00e9tude A partir du m\u00eame script, nous allons maintenant faire tourner l'algorithme sur une deuxi\u00e8me zone d'\u00e9tude, celle-ci situ\u00e9e en Meuse et dont les premi\u00e8res attaques de scolytes sont d\u00e9j\u00e0 anciennes. Pour ce faire, modifiez \"ZoneEtude\" dans les param\u00e8tres input_directory , data_directory et shape_path en \"ZoneEtude2\", afin de donner le chemin des donn\u00e9es li\u00e9es \u00e0 cette zone : input_directory = \"D:/Documents/Deperissement/FORMATION_SANTE_FORETS/A_DATA/RASTER/SERIES_SENTINEL/ZoneEtude2\" data_directory = \"D:/Documents/Deperissement/FORMATION_SANTE_FORETS/C_RESULTS/ZoneEtude2\" shape_path = \"D:/Documents/Deperissement/FORMATION_SANTE_FORETS/A_DATA/VECTOR/ZONE_ETUDE/ZoneEtude2.shp\" Utilisez les param\u00e8tres de votre choix parmi ceux modifi\u00e9s pr\u00e9cedemment Relancez le script Prenez le temps d'observer les r\u00e9sultats du timelapse et des s\u00e9ries temporelles. Vous pourrez remarquer que cette zone, non situ\u00e9e dans la zone de chevauchement entre orbites, dispose d'un nombre de dates plus faible que la zone pr\u00e9cedente. Pour certains pixels, des dates entre 2018-01-01 et 2018-06-01 sont utilis\u00e9es dans l'apprentissage afin d'atteindre le nombre de 10 dates valides. Vous pouvez ouvrir le raster DataModel/first_detection_date_index.tif dans QGIS pour constater qu'\u00e0 la diff\u00e9rence de la zone d'\u00e9tude pr\u00e9c\u00e9dente, il y a effectivements des diff\u00e9rences de premi\u00e8re date utilis\u00e9e pour la d\u00e9tection. Exporter des r\u00e9sultats adapt\u00e9s \u00e0 ses besoins Les timelapses cr\u00e9es pour visualiser les r\u00e9sultats jusqu'ici ne peuvent pas \u00eatre r\u00e9alis\u00e9s \u00e0 grande \u00e9chelle. Pour sortir des r\u00e9sultats \u00e0 l'\u00e9chelle de tuiles enti\u00e8res qui soient utilisables facilement par les utilisateurs, il existe une cinqui\u00e8me \u00e9tape qui permet d'exporter les r\u00e9sultats sous forme de shapefile au pas de temps souhait\u00e9. Vous pouvez retrouver le guide d'utilisation de cette \u00e9tape . Pour effectuer cette \u00e9tape, ajouter au script : - Pour importer la fonction from fordead.steps.step5_export_results import export_results Pour lancer la fonction export_results ( data_directory = data_directory, start_date = \"2015-05-23\" , end_date = \"2022-05-23\" , frequency = \"M\" , export_soil = True, multiple_files = False ) Mettez en commentaire les fonctions de visualisation pour \u00e9viter leurs temps de calcul en rajoutant # au d\u00e9but de leurs lignes. Puis, relancez le script depuis l'invit\u00e9 de commande : python detection_scolytes.py Les r\u00e9sultats sont dans le dossier Results, importez les dans QGIS, ajoutez une symbologie Cat\u00e9goris\u00e9e \u00e0 partir du champ \"period\". - Dans le shapefile periodic_results_decline, les polygones contiennent la p\u00e9riode \u00e0 laquelle la premi\u00e8re anomalie a \u00e9t\u00e9 d\u00e9tect\u00e9 pour les zones d\u00e9p\u00e9rissantes. - Dans le shapefile periodic_results_soil, les polygones contiennent la p\u00e9riode \u00e0 laquelle la premi\u00e8re anomalie de sol a \u00e9t\u00e9 d\u00e9tect\u00e9 pour les zones d\u00e9tect\u00e9es comme sol nu/coupe. Explorez ces r\u00e9sultats et assurez vous de bien les comprendre. Ensuite, supprimez ces r\u00e9sultats de QGIS, puis sauvegardez les dans un dossier de sauvegarde si vous le souhaitez, car ils seront \u00e9cras\u00e9s par la suite. Essayez un param\u00e8trage diff\u00e9rent en modifiant multiple_files = False en multiple_files = True avant de relancer le script. Dans le m\u00eame dossier, vous devriez trouver un shapefile par mois dont le nom correspond \u00e0 la fin de chaque p\u00e9riode, ils contiennent des polygones correspondant \u00e0 l'\u00e9tat du peuplement \u00e0 la fin de la p\u00e9riode, m\u00eame si les premi\u00e8res anomalies ont lieu avant la date renseign\u00e9e par le param\u00e8tre start_date . L'\u00e9tat peut \u00eatre Atteint, Coupe ou Coupe sanitaire. Importez en quelques un entre 2018 et fin 2020 pour voir l'\u00e9volution. Ajoutez une symbologie Cat\u00e9goris\u00e9e \u00e0 partir du champ \"state\". Vous pouvez copier le style d'une des couches aux autres couches. Ensuite, supprimez ces r\u00e9sultats de QGIS, puis sauvegardez les dans un dossier de sauvegarde si vous le souhaitez, car ils seront \u00e9cras\u00e9s par la suite. Maintenant, modifiez le param\u00e8tre frequency , ce param\u00e8tre accepte des fr\u00e9quences journali\u00e8res (\"D\"), mensuelles (\"M\") ou annuelles (\"A\") ou des multiples (\"15D\" = jours, \"3M\" = trois mois...). Il est d\u00e9conseill\u00e9 de mettre une p\u00e9riode trop courte, puisqu'il faut qu'il y ait des dates SENTINEL-2 au sein de ces p\u00e9riodes pour que les r\u00e9sultats soient int\u00e9ressants. Ce param\u00e8tre accepte \u00e9galement la valeur \"sentinel\", auquel cas chaque p\u00e9riode correspond au temps entre chaque date SENTINEL-2 utilis\u00e9e. Les p\u00e9riodes ne sont donc pas de dur\u00e9e constante, par exemple si multiple_files = False , alors on obtient un shapefile pour chaque date SENTINEL-2 utilis\u00e9e. Faites tourner le script en utilisant le param\u00e8tre frequency = \"sentinel\" . Observez les r\u00e9sultats. Ensuite, prenez le temps d'essayer diff\u00e9rents param\u00e8tres de fr\u00e9quences, avec multiple_files = False et multiple_files = True , trouvez les param\u00e8tres qui vous semblent les plus adapt\u00e9s, r\u00e9flechissez aux am\u00e9liorations que vous aimeriez voir, tout cela pourra nourrir la discussion autour des informations produites par la m\u00e9thode et leur exploitation. N'h\u00e9sitez pas \u00e9galement \u00e0 modifier des param\u00e8tres plus en amont pour vous familiariser avec l'outil.","title":"03 Formation Scolytes"},{"location":"docs/03_Formation_scolytes/#detection-des-foyers-de-mortalite-dans-les-massifs-de-coniferes-par-imagerie-satellite-sentinel-2","text":"Equipe de formation INRAE : Rapha\u00ebl Dutrieux, Forian de Boissieu, Jean-Baptiste Feret, Kenji Ose","title":" D\u00e9tection des foyers de mortalit\u00e9 dans les massifs de conif\u00e8res par imagerie satellite Sentinel-2 "},{"location":"docs/03_Formation_scolytes/#tp-02-utilisation-du-package-fordead-detection-de-deperissement-en-foret-a-partir-de-series-temporelles-sentinel-2","text":"Introduction Pr\u00e9ambule Objectifs Pr\u00e9-requis Cr\u00e9ation d'un script pour d\u00e9tecter le d\u00e9p\u00e9rissement li\u00e9 au scolyte sur une zone donn\u00e9e \u00e0 l'aide du package fordead \u00c9tape 1 : Calcul de l'indice de v\u00e9g\u00e9tation et du masque pour chaque date SENTINEL \u00c9tape 2 : Mod\u00e9lisation du comportement p\u00e9riodique de l'indice de v\u00e9g\u00e9tation \u00c9tape 3 : D\u00e9tection du d\u00e9perissement \u00c9tape 4 : Calcul du masque for\u00eat Visualisation des r\u00e9sultats Visualisation d'un timelapse Visualisation de la s\u00e9rie temporelle de pixels en particulier Rajouter des dates SENTINEL et mettre \u00e0 jour la d\u00e9tection Changer les param\u00e8tres de la d\u00e9tection Changer l'indice de v\u00e9g\u00e9tation Changer le seuil de d\u00e9tection d'anomalies Changer de zone d'\u00e9tude Exporter des r\u00e9sultats adapt\u00e9s \u00e0 ses besoins","title":"TP-02 : Utilisation du package fordead : d\u00e9tection de d\u00e9perissement en for\u00eat \u00e0 partir de s\u00e9ries temporelles SENTINEL-2"},{"location":"docs/03_Formation_scolytes/#introduction","text":"","title":"Introduction"},{"location":"docs/03_Formation_scolytes/#preambule","text":"Le monde forestier fait face \u00e0 une acc\u00e9l\u00e9ration sans pr\u00e9cedent des d\u00e9perissements \u00e0 large \u00e9chelle, notamment en lien avec le changement climatique et l'apparition de ravageurs. En particulier, la crise sanitaire du scolyte met en p\u00e9ril la sant\u00e9 des for\u00eats ainsi que la fili\u00e8re bois dans le Nord-Est de la France. Pour r\u00e9pondre \u00e0 cet enjeu, des travaux R&D ont \u00e9t\u00e9 men\u00e9s par l\u2019UMR TETIS (INRAE, anciennement IRSTEA) \u00e0 la demande du Minist\u00e8re de l\u2019Agriculture et de l\u2019Alimentation pour mettre au point un outil d\u2019identification des foyers de scolytes par t\u00e9l\u00e9d\u00e9tection de mani\u00e8re pr\u00e9coce et en continu. Cet outil prend aujourd'hui la forme du package python fordead permettant une cartographie des d\u00e9perissements \u00e0 partir d'images SENTINEL-2, potentiellement mise \u00e0 jour \u00e0 chaque revisite des satellites SENTINEL-2.","title":"Pr\u00e9ambule"},{"location":"docs/03_Formation_scolytes/#objectifs","text":"Les objectifs de ce TD sont les suivants : - \u00eatre capable de faire fonctionner l'ensemble des \u00e9tapes permettant la cartographie des d\u00e9perissements sur une zone donn\u00e9e, ainsi que comprendre l'articulation de ces diff\u00e9rentes \u00e9tapes - Savoir modifier les param\u00e8tres de l'outil afin de pouvoir s'adapter selon la probl\u00e9matique - Faire sortir les r\u00e9sultats sous la forme souhait\u00e9e - Visualiser ces r\u00e9sultats - Appr\u00e9hender le potentiel et les limites de l'outil","title":"Objectifs"},{"location":"docs/03_Formation_scolytes/#pre-requis","text":"Si le package n'est pas encore install\u00e9, suivre le guide d'installation . Sinon, lancer l'invit\u00e9 de commande anaconda prompt , puis activer l'environnement par la commande : conda activate ForDeadEnv","title":"Pr\u00e9-requis"},{"location":"docs/03_Formation_scolytes/#creation-dun-script-pour-detecter-le-deperissement-lie-au-scolyte-sur-une-zone-donnee-a-laide-du-package-fordead","text":"La d\u00e9tection du d\u00e9perissement permet d'utiliser l'ensemble des donn\u00e9es SENTINEL-2 depuis le lancement du premier satellite. M\u00eame en prenant une seule tuile, un tel jeu de donn\u00e9es p\u00e8se plusieurs centaines de gigaoctets et prend plusieurs heures de temps de calcul pour r\u00e9aliser l'ensemble des \u00e9tapes de d\u00e9tection du d\u00e9perissement. Pour cette raison, un jeu de donn\u00e9es plus r\u00e9duit a \u00e9t\u00e9 pr\u00e9par\u00e9 pour cette formation. Il contient l'ensemble des donn\u00e9es SENTINEL-2 disponible sur une zone d'\u00e9tude restreinte, en croppant \u00e0 partir des donn\u00e9es de la tuile. Cette zone est touch\u00e9e par les scolytes, et contient plusieurs polygones de donn\u00e9es de validation, ce qui en fait un bon exemple pour l'application de la d\u00e9tection de d\u00e9perissement et la visualisation des r\u00e9sultats. Cr\u00e9er un script python en cr\u00e9ant un nouveau fichier de texte dans le dossier /B_PROGRAMS, et en le nommant detection_scolytes.py (ou le nom de votre choix, mais avec l'extension .py) Ouvrez ce script avec l'\u00e9diteur de votre choix","title":"Cr\u00e9ation d'un script pour d\u00e9tecter le d\u00e9p\u00e9rissement li\u00e9 au scolyte sur une zone donn\u00e9e \u00e0 l'aide du package fordead"},{"location":"docs/03_Formation_scolytes/#etape-1-calcul-de-lindice-de-vegetation-et-du-masque-pour-chaque-date-sentinel","text":"La premi\u00e8re \u00e9tape consiste \u00e0 calculer pour chaque date l'indice de v\u00e9g\u00e9tation, et le masque. Le masque correspond \u00e0 l'ensemble des donn\u00e9es invalides, car ennuag\u00e9es, enneig\u00e9es, dans l'ombre, hors de la fauch\u00e9e du satellite, peuplement d\u00e9j\u00e0 coup\u00e9... Vous pouvez retrouver le guide d'utilisation de cette \u00e9tape .","title":"\u00c9tape 1 : Calcul de l'indice de v\u00e9g\u00e9tation et du masque pour chaque date SENTINEL"},{"location":"docs/03_Formation_scolytes/#faire-tourner-letape-a-partir-du-script","text":"Pour effectuer cette \u00e9tape, ajoutez dans le script : - Pour importer la fonction from fordead.steps.step1_compute_masked_vegetationindex import compute_masked_vegetationindex Pour choisir les param\u00e8tres en entr\u00e9e : input_directory = \"<MyWorkingDirectory>/A_DATA/RASTER/SERIES_SENTINEL/ZoneEtude\" data_directory = \"<MyWorkingDirectory>/C_RESULTS/ZoneEtude\" NOTE : Il est pr\u00e9f\u00e9rable d'utiliser \"/\" plut\u00f4t que \"\\\" \u00e0 l'\u00e9criture des chemins afin d'\u00e9viter les soucis. Pour lancer la fonction compute_masked_vegetationindex ( input_directory = input_directory, data_directory = data_directory ) Puis lancer le script python depuis l'invit\u00e9 de commande en vous pla\u00e7ant dans le r\u00e9pertoire du script en utilisant la commande suivante : cd <MyWorkingDirectory>/B_PROGRAMS Puis lancer le script : python detection_scolytes.py","title":"Faire tourner l'\u00e9tape \u00e0 partir du script"},{"location":"docs/03_Formation_scolytes/#faire-tourner-letape-en-lancant-la-fonction-depuis-linvite-de-commande","text":"Il est \u00e9galement possible d'appliquer la m\u00eame \u00e9tape en passant par l'invit\u00e9 de commande. Depuis l'invit\u00e9 de commande, placez vous dans le dossier du package fordead_package/fordead/steps par la commande : cd <MyWorkingDirectory>/B_PROGRAMS/Libraries/fordead_package/fordead/steps Puis, la commande suivante permet d'afficher l'aide : python step1_compute_masked_vegetationindex.py -h A partir de l'aide, lancez la fonction en appliquant vos param\u00e8tres. Exemple : python step1_compute_masked_vegetationindex.py -i <MyWorkingDirectory>/A_DATA/RASTER/SERIES_SENTINEL/ZoneEtude -o <MyWorkingDirectory>/C_RESULTS/ZoneEtude NOTE : -i permet de d\u00e9finir le param\u00e8tre input_directory et -o le param\u00e8tre data_directory , ainsi exactement la m\u00eame fonction est lanc\u00e9e. Vous remarquerez que si vous avez utilis\u00e9 les m\u00eame param\u00e8tres dans les deux cas, il s'affiche \"0 new SENTINEL dates\" et le programme tourne plus rapidement la deuxi\u00e8me fois, car les indices de v\u00e9g\u00e9tation d\u00e9j\u00e0 calcul\u00e9s ne sont pas recalcul\u00e9s. En revanche, si vous changez les param\u00e8tres, les r\u00e9sultats pr\u00e9c\u00e9dants seront supprim\u00e9s et remplac\u00e9s. Les param\u00e8tres input_directory et data_directory sont les deux seuls \u00e0 ne pas conna\u00eetre de valeur par d\u00e9faut puisqu'elles d\u00e9pendent de l'emplacement de vos fichiers. Ce sont donc les deux seuls param\u00e8tres \u00e0 renseigner obligatoirement, mais il est tout de m\u00eame possible de modifier les autres param\u00e8tres. A l'aide du guide d'utilisateur, v\u00e9rifiez que vous comprenez le sens des diff\u00e9rents param\u00e8tres et n'h\u00e9sitez pas \u00e0 poser des questions si ce n'est pas le cas ! L'ensemble des \u00e9tapes de la d\u00e9tection peuvent se r\u00e9aliser de mani\u00e8re identique depuis l'invit\u00e9 de commande, ou par import des diff\u00e9rentes fonctions dans un script. Dans la suite de ce TD, nous nous focaliseront sur le script en le compl\u00e9tant au fur et \u00e0 mesure.","title":"Faire tourner l'\u00e9tape en lan\u00e7ant la fonction depuis l'invit\u00e9 de commande"},{"location":"docs/03_Formation_scolytes/#observation-des-sorties","text":"Pour mieux vous repr\u00e9senter les sorties de cette \u00e9tape, lancez QGIS et ajoutez les rasters VegetationIndex/VegetationIndex_2018-07-27.tif et Mask/Mask_2018-07-27.tif . Nous allons \u00e9galement comparer ces exports avec les rasters des donn\u00e9es SENTINEL-2 dont ils sont issus. Pour cela, allez dans le dossier /A_DATA/RASTER/SERIES_SENTINEL/ZoneEtude/SENTINEL2A_20180727-104023-458_L2A_T31UGP_D_V1-8 , puis rajoutez les bandes B2, B3, B4 \u00e0 QGIS, soit respectivement les bandes rouge, vert et bleu. Ensuite, nous allons cr\u00e9er un raster virtuelle \u00e0 partir de ces trois bandes pour visualiser une image en couleur. - Aller dans Raster/Divers/Construire un raster virtuel - S\u00e9lectionner les bandes ajout\u00e9es - Cocher pour que chaque fichier de bande aille dans une bande diff\u00e9rente - Executer - Aller dans les propri\u00e9t\u00e9s du raster cr\u00e9e - Les bandes devraient ne pas \u00eatre dans le bon ordre, mettre la bande 3 en rouge et la bande 1 en bleu. Modifiez l'\u00e9chelle pour aller de 0 \u00e0 600 pour chaque bande. Observez les r\u00e9sultats. Les rasters dans le dossier DataSoil contiennent les informations relatives \u00e0 la d\u00e9tection du sol nu. Ce sol d\u00e9tect\u00e9 peut correspondre \u00e0 des zones non foresti\u00e8res, \u00e0 des peuplements feuillus dont le sol est d\u00e9tect\u00e9 en hiver, ou des coupes rases. Il y a trois rasters, qui, ensemble, permettent de reconstituer l'ensemble de l'information, et de la mettre \u00e0 jour avec l'arriv\u00e9e de nouvelles dates SENTINEL : - Le raster count_soil.tif compte le nombre d'anomalies de sol successives. - Lorsque count_soil atteint 3, pour trois anomalies successives, le raster state_soil.tif passe de 0 \u00e0 1. Les pixels avec la valeur 1 correspondent donc \u00e0 ceux d\u00e9tect\u00e9s comme sol nu / coupe au bout de l'analyse de l'ensemble des dates. - Le raster first_date_soil.tif contient l'index de la date de premi\u00e8re anomalie de sol. Si state_soil vaut 1, il s'agit alors de la date \u00e0 partir de laquelle le sol est d\u00e9tect\u00e9e. Ces rasters peuvent \u00eatre difficiles \u00e0 analyser puisque, n'\u00e9tant pas possible de mettre une date dans un raster, le raster first_date_soil contient l'index de la date qui peut \u00eatre interpr\u00e9t\u00e9 par le package dans les \u00e9tapes suivantes.","title":"Observation des sorties"},{"location":"docs/03_Formation_scolytes/#etape-2-modelisation-du-comportement-periodique-de-lindice-de-vegetation","text":"Pour mod\u00e9liser le comportement normal de l'indice de v\u00e9g\u00e9tation, on utilise seulement les dates SENTINEL les plus anciennes, en faisant l'hypoth\u00e8se qu'elles sont ant\u00e9rieures \u00e0 un possible d\u00e9perissement. La fonction harmonique suivante est ajust\u00e9e \u00e0 ces donn\u00e9es : \ud835\udc87(\ud835\udc95)=\ud835\udc82\ud835\udfcf+\ud835\udc83\ud835\udfcf.\ud835\udc2c\ud835\udc22\ud835\udc27\u2061(\ud835\udfd0\ud835\udf45\ud835\udc95/\ud835\udc47)+\ud835\udc83\ud835\udfd0.\ud835\udc1c\ud835\udc28\ud835\udc2c\u2061(\ud835\udfd0\ud835\udf45\ud835\udc95/\ud835\udc47)+\ud835\udc83\ud835\udfd1.\ud835\udc2c\ud835\udc22\ud835\udc27\u2061(\ud835\udfd2\ud835\udf45\ud835\udc95/\ud835\udc47)+\ud835\udc83\ud835\udfd2.\ud835\udc1c\ud835\udc28\ud835\udc2c\u2061(\ud835\udfd2\ud835\udf45\ud835\udc95/\ud835\udc47) o\u00f9 T = 365,25. Vous pouvez retrouver le guide d'utilisation de cette \u00e9tape . Pour effectuer cette \u00e9tape, ajoutez dans le script : - Pour importer la fonction from fordead.steps.step2_train_model import train_model Pour lancer la fonction train_model ( data_directory = data_directory ) Puis, comme pour l'\u00e9tape 1, relancez le script depuis l'invit\u00e9 de commande : python detection_scolytes.py Le reste des param\u00e8tres connaissent une valeur par d\u00e9faut dans la fonction et n'ont pas besoin d'\u00eatre renseign\u00e9es. Ces valeurs par d\u00e9faut ont \u00e9t\u00e9 d\u00e9termin\u00e9es de mani\u00e8re empirique pour la probl\u00e9matique du scolyte et peuvent ne pas \u00eatre optimales selon la localisation ou la probl\u00e9matique donn\u00e9e. Le guide d'utilisation donne des d\u00e9tails sur les diff\u00e9rents param\u00e8tres, lisez le et v\u00e9rifiez que vous comprenez bien leur sens. NOTE : Si l'utilisateur ne souhaite pas utiliser la premi\u00e8re \u00e9tape et choisit de calculer ses propres indices de v\u00e9g\u00e9tations et masques. Il peut sauter l'\u00e9tape 1 et simplement donner le chemin de son dossier d'indices de v\u00e9g\u00e9tation avec le param\u00e8tre path_vi et son dossier de masques avec path_masks . Il suffit simplement que le nom des rasters contiennent la date sous un des formats suivants : AAAA-MM-JJ, AAAA_MM_JJ, AAAAMMJJ, JJ-MM-AAAA, JJ_MM_AAAA ou JJMMAAAA.","title":"\u00c9tape 2 : Mod\u00e9lisation du comportement p\u00e9riodique de l'indice de v\u00e9g\u00e9tation"},{"location":"docs/03_Formation_scolytes/#observation-des-sorties_1","text":"Dans le dossier DataModel : - Ouvrez le raster coeff_model.tif dans QGIS. Faites un clique droit sur un des pixels, vous pouvez constater qu'il s'agit d'un raster \u00e0 cinq bandes. QGIS affiche une image en RGB \u00e0 partir des trois premi\u00e8res bandes. Chacune des bandes correspond \u00e0 un des coefficients (a1, b1, b2, b3, b4) du mod\u00e8le (voir \u00e9quation). On a bien un mod\u00e8le diff\u00e9rent par pixel ce qui permet qu'il soit adapt\u00e9 aux conditions de ce pixel. On peut en effet imaginer que la composition du peuplement, sa surface terri\u00e8re, sa pente, son exposition ont probablement un r\u00f4le \u00e0 jouer dans la valeur donn\u00e9e des indices de v\u00e9g\u00e9tation. A partir de ces coefficients, il est possible de pr\u00e9dire l'indice de v\u00e9g\u00e9tation \u00e0 n'importe quelle date, pour un peuplement sain. Ouvrez maintenant le raster first_detection_date_index.tif. Il permet de conna\u00eetre pour chaque pixel les dates utilis\u00e9es pour l'apprentissage du mod\u00e8le, et celles utilis\u00e9es pour la d\u00e9tection de d\u00e9perissement. Il contient l'index de la premi\u00e8re date \u00e0 partir de laquelle le d\u00e9perissement est d\u00e9tect\u00e9. Sur cette zone, il y a assez de dates valides pour que l'ensemble des pixels terminent leur apprentissage avant la premi\u00e8re date de 2018 (le param\u00e8tre min_last_date_training est fix\u00e9 \u00e0 2018-01-01 par d\u00e9faut ce qui permet d'avoir un recul de deux ans d'images satellites SENTINEL-2), ils ont donc tous la m\u00eame valeur sauf les zones \"sans donn\u00e9es\" qui correspondent aux zones d\u00e9tect\u00e9es comme \"sol nu / coupe\" tr\u00e8s t\u00f4t, qui sont donc masqu\u00e9es sur la quasi-totalit\u00e9 des dates et qui n'ont donc pas le nombre de dates valides minimum pour le calcul du mod\u00e8le. Dans le dossier ForestMask, ouvrez \u00e9galement le raster valid_area_mask.tif. Il s'agit d'un raster binaire qui vaut 1 l\u00e0 o\u00f9 il y avait suffisamment de dates valides pour le calcul du mod\u00e8le et 0 ailleurs.","title":"Observation des sorties"},{"location":"docs/03_Formation_scolytes/#etape-3-detection-du-deperissement","text":"Lors de cette \u00e9tape, pour chaque date SENTINEL non utilis\u00e9e pour l'apprentissage, l'indice de v\u00e9g\u00e9tation r\u00e9el est compar\u00e9 \u00e0 l'indice de v\u00e9g\u00e9tation pr\u00e9dit \u00e0 partir des mod\u00e8les calcul\u00e9s dans l'\u00e9tape pr\u00e9c\u00e8dente. Si la diff\u00e9rence d\u00e9passe un seuil, une anomalie est d\u00e9tect\u00e9e. Si trois anomalies successives sont d\u00e9tect\u00e9es, le pixel est consid\u00e9r\u00e9 comme d\u00e9p\u00e9rissant. Si apr\u00e8s avoir \u00e9t\u00e9 d\u00e9tect\u00e9 comme d\u00e9perissant, le pixel a trois dates successives sans anomalies, il n'est plus consid\u00e9r\u00e9 comme d\u00e9p\u00e9rissant. N'h\u00e9sitez pas \u00e0 consulter le guide d'utilisation de cette \u00e9tape. Pour effectuer cette \u00e9tape, ajouter au script : - Pour importer la fonction from fordead.steps.step3_decline_detection import decline_detection Pour lancer la fonction decline_detection ( data_directory = data_directory ) Puis, relancez le script depuis l'invit\u00e9 de commande : python detection_scolytes.py","title":"\u00c9tape 3 : D\u00e9tection du d\u00e9perissement"},{"location":"docs/03_Formation_scolytes/#observation-des-sorties_2","text":"Pour chaque date post\u00e9rieure \u00e0 la date renseign\u00e9e par le param\u00e8tre min_last_date_training , un raster Anomalies_ .tif est export\u00e9 dans le dossier DataAnomalies . - Ouvrez dans QGIS le raster Anomalies_2018-07-27.tif . - Mettez en regard ces r\u00e9sultats avec l'indice de v\u00e9g\u00e9tation et le masque calcul\u00e9 pour la date et ouvert pr\u00e9c\u00e9demment, ainsi que l'image en RGB. On peut voir que des anomalies sont d\u00e9tect\u00e9es m\u00eame l\u00e0 o\u00f9 les donn\u00e9es sont masqu\u00e9es, comme pour les nuages sur la gauche de l'image, o\u00f9 les zones d\u00e9tect\u00e9es comme sol nu. Ces anomalies ne sont bien entendu pas prises en compte. Les anomalies pouvant correspondre \u00e0 des d\u00e9gats de scolytes sont celles qui ne sont pas masqu\u00e9es. Un autre dossier a \u00e9t\u00e9 cr\u00e9e, DataDecline. Les rasters de ce dossier contiennent les informations relatives \u00e0 la d\u00e9tection de d\u00e9p\u00e9rissement \u00e0 partir des anomalies observ\u00e9es pr\u00e9c\u00e9demment. Ces rasters sont exactement sous la m\u00eame forme que les rasters dans DataSoil observ\u00e9s lors de l'\u00e9tape 1. La seule diff\u00e9rence est que un \"retour \u00e0 la normale\" est possible. Une fois que le sol est d\u00e9tect\u00e9, l'\u00e9tat \"sol nu\" est permanent, tandis que pour le d\u00e9p\u00e9rissement, un pixel d\u00e9tect\u00e9 comme d\u00e9p\u00e9rissant peut retourner \u00e0 l'\u00e9tat non-d\u00e9p\u00e9rissant s'il y a trois dates successives sans anomalies. Cela permet d'\u00e9viter des faux positifs caus\u00e9s par des stress hydriques importants mais temporaires et ne causant pas de d\u00e9p\u00e9rissement. Les informations de ces rasters sont les suivantes : - le raster state_decline.tif, un raster binaire qui vaut 1 pour les pixels d\u00e9p\u00e9rissants, 0 pour les pixels sains - Le raster count_decline.tif compte le nombre d'anomalies successives pour les pixels sains dans state_decline, ou le nombre de dates sans anomalies successives pour les pixels d\u00e9p\u00e9rissants dans state_decline. Quand count_decline atteint trois, le pixel change d'\u00e9tat, de sain \u00e0 d\u00e9p\u00e9rissant ou inversement. - Le raster first_date_decline.tif contient l'index de la date de premi\u00e8re anomalie. Si state_decline vaut 1, il s'agit alors de la date \u00e0 partir de laquelle le d\u00e9p\u00e9rissement est d\u00e9t\u00e9ct\u00e9.","title":"Observation des sorties"},{"location":"docs/03_Formation_scolytes/#etape-4-calcul-du-masque-foret","text":"L'ensemble des calculs pr\u00e9cedents sont r\u00e9alis\u00e9s sur l'ensemble des pixels de la zone d'\u00e9tude. Cependant, en particulier lorsqu'on travaille sur de larges zones, il est n\u00e9cessaire de d\u00e9finir les zones d'int\u00e9r\u00eats pour ne pas interpr\u00e9ter des r\u00e9sultats sur des zones urbaines, des cultures, etc... Dans le cas du scolyte, on s'int\u00e9resse uniquement aux peuplements forestiers r\u00e9sineux. Cette \u00e9tape permet de cr\u00e9er le masque for\u00eat correspondant \u00e0 notre zone d'int\u00e9r\u00eat. Vous pouvez consulter son guide d'utilisation . Pour effectuer cette \u00e9tape, ajouter au script : - Pour importer la fonction from fordead.steps.step4_compute_forest_mask import compute_forest_mask Pour lancer la fonction compute_forest_mask ( data_directory, forest_mask_source = 'BDFORET' , dep_path = \"<MyWorkingDirectory>/A_DATA/VECTOR/BD_ADMIN/departements-20140306-100m.shp\" , bdforet_dirpath = \"<MyWorkingDirectory>/A_DATA/VECTOR/BD_FORET\" ) Puis, relancez le script depuis l'invit\u00e9 de commande : python detection_scolytes.py NOTE : Il est possible d'utiliser cette \u00e9tape d\u00e9connect\u00e9e des autres en pr\u00e9cisant le param\u00e8tre path_example_raster avec le chemin d'un raster \"exemple\" qui donnera son syst\u00e8me de projection, sa r\u00e9solution, son extent au masque produit. Ne pas renseigner ce param\u00e8tre ne pose pas de soucis puisque le chemin d'un raster exemple peut \u00eatre r\u00e9cup\u00e9r\u00e9 depuis les \u00e9tapes pr\u00e9c\u00e9dentes par le biais du fichier TileInfo.","title":"\u00c9tape 4 : Calcul du masque for\u00eat"},{"location":"docs/03_Formation_scolytes/#observation-des-sorties_3","text":"Cette \u00e9tape permet d'\u00e9crire un uniquement raster, Forest_Mask.tif dans le dossier ForestMask. Ouvrez ce raster. Il s'agit d'un raster binaire qui vaut 1 dans la zone d'int\u00e9r\u00eat, 0 ailleurs. Avec les param\u00e8tres renseign\u00e9s ici, il est cr\u00e9e \u00e0 partir de la rasterisation de la BD For\u00eat de l'IGN en gardant uniquement les peuplements r\u00e9sineux.","title":"Observation des sorties"},{"location":"docs/03_Formation_scolytes/#visualisation-des-resultats","text":"Les \u00e9tapes r\u00e9alis\u00e9es pr\u00e9c\u00e9demment ont permis d'obtenir l'ensemble des r\u00e9sultats relatifs \u00e0 la d\u00e9tection de scolytes, mais sous une forme difficile \u00e0 analyser. Le package contient certains outils permettant de visualiser les r\u00e9sultats sous une forme plus digeste.","title":"Visualisation des r\u00e9sultats"},{"location":"docs/03_Formation_scolytes/#creation-dun-timelapse","text":"Pour commencer, nous allons cr\u00e9er un timelapse de la d\u00e9tection sur la zone analys\u00e9e. Pour ce faire, ajouter dans le script : - Pour importer la fonction from fordead.visualisation.create_timelapse import create_timelapse Pour ajouter les param\u00e8tres n\u00e9c\u00e9ssaires : shape_path = \"<MyWorkingDirectory>/A_DATA/VECTOR/ZONE_ETUDE/ZoneEtude.shp\" Pour lancer la fonction : create_timelapse ( data_directory = data_directory,shape_path = shape_path, obs_terrain_path = \"<MyWorkingDirectory>/A_DATA/VECTOR/BD_SCOLYTE/ValidatedScolytes.shp\" ) Enfin, relancez le script. Cette fonction prend en entr\u00e9e un shapefile avec un champ \"Id\" dans lequel il peut y avoir un ou plusieurs polygones et \u00e9crit pour chaque polygone un fichier .html dans le dossier \"Timelapses\". Elle est plut\u00f4t pens\u00e9e pour visualiser les r\u00e9sultats sur une zone r\u00e9duite \u00e0 partir des r\u00e9sultats d'une tuile enti\u00e8re, il est recommand\u00e9 d'\u00e9viter de lancer cette op\u00e9ration avec des polygones de plus d'une vingtaine de km\u00b2. Cependant, on travaille ici d\u00e9j\u00e0 sur une zone r\u00e9duite, en utilisant un shapefile d'un seul polygone couvrant l'ensemble de la zone. Le timelapse devrait se lancer automatiquement, sinon ouvrez le fichier .html (il est possible que sa lecture fonctionne mieux sous Chrome). Une fois le timelapse ouvert, faites glisser le slider en bas de l'image pour vous d\u00e9placer temporellement dans l'animation. Les polygones noirs correspondent aux zones d\u00e9tect\u00e9es comme sol nu, les polygones jaunes correspondent aux zones d\u00e9tect\u00e9es comme d\u00e9p\u00e9rissantes et les polygones bleus correspondent aux coupes sanitaires, c'est \u00e0 dire les zones d\u00e9tect\u00e9es comme sol-nu/coupe apr\u00e8s avoir \u00e9t\u00e9 d\u00e9tect\u00e9es comme atteintes. Les donn\u00e9es d'observation sur le terrain sont \u00e9galement affich\u00e9es, passez la souris sur ces polygones pour obtenir leurs informations : | : . Sur cette zone, on peut observer des zones saines en vert fonc\u00e9 et des zones scolyt\u00e9es au stade rouge en rouge. Vous pouvez \u00e9galement zoomer sur la zone souhait\u00e9e en maintenant le clique appuy\u00e9 tout en d\u00e9limitant une zone. Vous pouvez ensuite d\u00e9zoomer en double cliquant sur l'image. Passer la souris sur un pixel permet \u00e9galement d'obtenir ses informations : - x : coordonn\u00e9es en x - y : coordonn\u00e9es en y - z : [ , , ], c'est \u00e0 dire la valeur de la bande SENTINEL correspondante \u00e0 la date donn\u00e9e. Les r\u00e9sultats apparaissent \u00e0 la date de la premi\u00e8re anomalie, confirm\u00e9e par la suite. Les fausses d\u00e9tections li\u00e9es \u00e0 un stress hydrique temporaire et corrig\u00e9es par la suite n'apparaissent pas. De m\u00eame, pour les derni\u00e8res dates, il peut y avoir des anomalies n'apparaissant pas encore par manque de dates valides pour confirmer la d\u00e9tection. Prenez le temps d'explorer cet outil et les r\u00e9sultats de la d\u00e9tection. Vous pouvez remarquer que les polygones observ\u00e9s comme atteints sur le terrain sont d\u00e9tect\u00e9s comme atteints avant la date d'observation, tandis que les polygones observ\u00e9s comme sains sont encore sains \u00e0 la date d'observation, mais pas forc\u00e9ment par la suite.","title":"Cr\u00e9ation d'un timelapse"},{"location":"docs/03_Formation_scolytes/#visualisation-de-la-serie-temporelle-de-pixels-en-particulier","text":"Lors de la visualisation du timelapse, vous avez pu vous poser des questions sur les r\u00e9sultats de pixels en particulier. L'outil suivant va permettre d'afficher l'ensemble de la s\u00e9rie temporelle utilis\u00e9e pour un pixel en particulier, mis en relation avec les r\u00e9sultats de l'algorithme. Pour utiliser cet outil, ajouter dans le script : Pour importer la fonction from fordead.visualisation.vi_series_visualisation import vi_series_visualisation Pour lancer la fonction : vi_series_visualisation ( data_directory = data_directory ) De plus, pour \u00e9viter que le timelapse soit recalcul\u00e9, mettez en commentaire la fonction \u00e0 l'origine du timelapse en ajoutant \"#\" en d\u00e9but de ligne. Toute ligne comment\u00e9e est ignor\u00e9e au lancement du script : #create_timelapse(data_directory = data_directory,shape_path = shape_path, obs_terrain_path = obs_terrain_path) Enfin, relancez le script Cette fonction permet de donner les coordonn\u00e9es en X,Y du pixel souhait\u00e9 afin d'en visualiser les r\u00e9sultats. A l'aide du timelapse r\u00e9alis\u00e9 pr\u00e9c\u00e9demment, choisissez un pixel, r\u00e9cup\u00e9rez ses coordonn\u00e9es en passant votre souris sur celui ci, puis renseignez ces coordonn\u00e9es dans l'invit\u00e9 de commande qui devrait indiquer : X ? Puis Y ? Un graphique doit alors s'afficher, avec la l\u00e9gende associ\u00e9e. Chaque point correspond \u00e0 une date SENTINEL valide, avec la valeur de l'indice de v\u00e9g\u00e9tation calcul\u00e9. V\u00e9rifiez que vous comprenez chaque \u00e9l\u00e9ment du graphique, et n'h\u00e9sitez pas \u00e0 poser la question s'il y a des points de doute. Apr\u00e8s avoir ferm\u00e9 le graphique, vous pourrez renseigner d'autres coordonn\u00e9es. R\u00e9p\u00e9tez cette op\u00e9ration pour au moins cinq pixels : - Un pixel qui reste sain jusqu'\u00e0 la derni\u00e8re date SENTINEL disponible - Un pixel manifestement atteint \u00e0 la derni\u00e8re date SENTINEL disponible - Un pixel atteint puis coup\u00e9 - Un pixel coup\u00e9 sans avoir \u00e9t\u00e9 d\u00e9tect\u00e9 comme atteint - Un pixel hors du masque for\u00eat. Ce masque n'est pas renseign\u00e9 sur le timelapse, mais vous pouvez deviner que certaines zones auraient d\u00fb \u00eatre d\u00e9tect\u00e9es comme \"sol nu\" \u00e0 certaines parties de l'ann\u00e9e. Ou vous pouvez vous aider du masque for\u00eat ouvert dans QGIS. Vous pouvez aussi appuyer sur Entr\u00e9e sans renseigner de coordonn\u00e9e X, dans ce cas, la fonction affiche la s\u00e9rie temporelle d'un pixel au hasard au sein du masque for\u00eat. Prenez le temps d'observer les pixels qui vous int\u00e9ressent. Une fois que vous avez termin\u00e9 vos observations, renseignez -1 comme coordonn\u00e9e X pour terminer le programme. L'ensemble des graphiques ayant \u00e9t\u00e9 cr\u00e9es sont disponibles dans le dossier \"SeriesTemporelles\". NOTE : Il est \u00e9galement possible d'utiliser la fonction vi_series_visualisation en ajoutant le param\u00e8tre shape_path = . Ce shapefile de points doit contenir un champ \"id\" avec un identifiant num\u00e9rique pour chaque point. Les pixels correspondants \u00e0 chaque point sont alors identifi\u00e9s et leurs graphiques sont sauvegard\u00e9s dans le dossier \"SeriesTemporelles\". Cela permet de r\u00e9aliser ces graphiques sans passer par la cr\u00e9ation du timelapse pour r\u00e9cup\u00e9rer les coordonn\u00e9es X,Y qui ne sont pas associ\u00e9es \u00e0 un syst\u00e8me de projection.","title":"Visualisation de la s\u00e9rie temporelle de pixels en particulier"},{"location":"docs/03_Formation_scolytes/#rajouter-des-dates-sentinel-et-mettre-a-jour-la-detection","text":"L'algorithme permet \u00e9galement de mettre \u00e0 jour la d\u00e9tection avec de nouvelles images SENTINEL. Nous utilisions auparavant les dates SENTINEL depuis les premi\u00e8res images jusqu'au 01/06/2020. Dans le dossier /A_DATA/RASTER/SERIES_SENTINEL/MAJ_ZoneEtude sont disponibles les dates SENTINEL allant jusqu'\u00e0 la fin de 2020. Nous allons mettre \u00e0 jour la d\u00e9tection \u00e0 partir de ces donn\u00e9es. Pour ce faire : Copiez ou coupez ces donn\u00e9es dans le dossier /A_DATA/RASTER/SERIES_SENTINEL/ZoneEtude D\u00e9commentez la fonction permettant de cr\u00e9er le timelapse en retirant le \"#\" Coupez-collez le dossier \"Timelapses\" et \"SeriesTemporelles\" dans un autre dossier, par exemple en cr\u00e9ant un dossier /C_RESULTS/Save_ZoneEtude. Cela permettra de comparer avant et apr\u00e8s mise \u00e0 jour, puisque les nouveaux timelapses et graphiques cr\u00e9es remplaceront les anciens. C'est optionnel mais permettra de ne rien \u00e9craser. relancez le script On peut voir que l'algorithme ne r\u00e9alise les calculs que sur les nouvelles dates, \u00e0 partir du mod\u00e8le d\u00e9j\u00e0 \u00e9tabli. Prenez le temps d'examiner les nouveaux r\u00e9sultats, et \u00e9ventuellement de les comparer avec les anciens.","title":"Rajouter des dates SENTINEL et mettre \u00e0 jour la d\u00e9tection"},{"location":"docs/03_Formation_scolytes/#changer-les-parametres-de-la-detection","text":"Depuis le d\u00e9but de ce TD, nous avons laiss\u00e9 tous les param\u00e8tres \u00e0 leur valeur par d\u00e9faut. Ces valeurs ont \u00e9t\u00e9 d\u00e9termin\u00e9es de mani\u00e8re empirique pour la d\u00e9tection de scolytes. Il est int\u00e9ressant de savoir modifier ces param\u00e8tres afin de s'adapter \u00e0 des situations locales, ou d'autres probl\u00e9matiques. Pour commencer, supprimez l'ensemble des couches rajout\u00e9es \u00e0 QGIS li\u00e9es aux r\u00e9sultats pr\u00e9c\u00e9dents (pas besoin de retirer le raster virtuel en RGB). Le changement des param\u00e8tres entra\u00eenera la suppression des r\u00e9sultats pr\u00e9c\u00e9dents, si ils sont ouverts dans QGIS, ils ne pourront pas \u00eatre supprim\u00e9s et cela occasionnera des bugs.","title":"Changer les param\u00e8tres de la d\u00e9tection"},{"location":"docs/03_Formation_scolytes/#changer-lindice-de-vegetation","text":"L'indice de v\u00e9g\u00e9tation utilis\u00e9 jusqu'ici est le CRSWIR, sensible \u00e0 la teneur en eau. La teneur en eau \u00e9tant la premi\u00e8re caract\u00e9ristique de la v\u00e9g\u00e9tation affect\u00e9e lors d'attaques de scolytes, il donne de bons r\u00e9sultats pour la d\u00e9tection de scolytes. Cependant, il existe d'autres indices de v\u00e9g\u00e9tation, dont le plus connu est probablement le NDVI, plut\u00f4t sensible \u00e0 l'activit\u00e9 photo-synth\u00e9tique, les pigments chlorophylliens... - L'utilisation du NDVI est d\u00e9j\u00e0 pr\u00e9vue dans le package, pour l'utiliser il suffit donc simplement de rajouter le param\u00e8tre vi = \"NDVI\" dans la fonction compute_masked_vegetationindex : compute_masked_vegetationindex ( input_directory = input_directory, data_directory = data_directory, vi = \"NDVI\" ) Rajouter les param\u00e8tres ymin = 0, ymax = 1.1 \u00e0 la fonction vi_series_visualisation(data_directory = data_directory) . Ces param\u00e8tres permettent de donner les limites en ordonn\u00e9e des graphiques de s\u00e9ries temporelles, car le NDVI n'a pas la m\u00eame \u00e9chelle que le CRSWIR. vi_series_visualisation ( data_directory = data_directory,ymin = 0 , ymax = 1 .1 ) Sauvegardez vos visualisations si vous souhaitez effectuer une comparaison (optionnel) Relancez le script. Prenez le temps de visualiser les r\u00e9sultats.","title":"Changer l'indice de v\u00e9g\u00e9tation"},{"location":"docs/03_Formation_scolytes/#utiliser-un-indice-de-vegetation-non-prevu-dans-le-package","text":"La version actuelle du package ne pr\u00e9voit que les indices de v\u00e9g\u00e9tation \"CRSWIR\" et \"NDVI\". Nous allons donc maintenant apprendre comment rajouter n'importe quel indice de v\u00e9g\u00e9tation pour l'utiliser dans la d\u00e9tection. Par exemple, prenons le NDWI (Normalized Difference Water Index), un indice de v\u00e9g\u00e9tation li\u00e9 \u00e0 la teneur en eau de la v\u00e9g\u00e9tation qui suit la formule suivante : \\frac{B8A-B11}{B8A+B11} Cr\u00e9er un fichier texte dict_vi.txt dans le dossier /B_PROGRAMS (Vous pouvez en r\u00e9alit\u00e9 utiliser le nom et dossier de votre choix) Dans ce fichier texte, ajoutez la ligne suivante, avant de sauvegarder : NDWI ( B8A-B11 ) / ( B8A+B11 ) - o\u00f9 \"NDWI\" est le nom de l'indice, \"(B8A-B11)/(B8A+B11)\" est sa formule, et \"-\" est la direction vers laquelle l'indice de v\u00e9g\u00e9tation tend lorsqu'il y a d\u00e9perissement. L'algorithme accepte \"-\" ou \"+\", on a d\u00e9j\u00e0 pu voir que le CRSWIR augmente en cas de d\u00e9perissement, tandis que le NDVI diminue. - Ajouter dans le script le param\u00e8tre path_dict_vi = \"<MyWorkingDirectory>/B_PROGRAMS/dict_vi.txt\" \u00e0 la fonction compute_masked_vegetationindex , et changer le nom de l'indice de v\u00e9g\u00e9tation pour \"NDWI\" : compute_masked_vegetationindex ( input_directory = input_directory, data_directory = data_directory, vi = \"NDWI\" , path_dict_vi = \"<MyWorkingDirectory>/B_PROGRAMS/dict_vi.txt\" ) Relancez le script Observez les r\u00e9sultats","title":"Utiliser un indice de v\u00e9g\u00e9tation non pr\u00e9vu dans le package"},{"location":"docs/03_Formation_scolytes/#changer-le-seuil-de-detection-danomalies","text":"Le seuil de d\u00e9tection des anomalies est r\u00e9gl\u00e9 par d\u00e9faut \u00e0 0.16, c'est \u00e0 dire que la diff\u00e9rence entre la courbe \"Mod\u00e9lisation de l'indice de v\u00e9g\u00e9tation sur les dates d'apprentissage\" et la courbe \"Seuil de d\u00e9tection des anomalies\" est de 0.16. Il n'y a pas de raisons que ce seuil soit identique entre les diff\u00e9rents indices de v\u00e9g\u00e9tations. Modifiez ce seuil en rajoutant le param\u00e8tre threshold_anomaly = 0.12 \u00e0 la fonction decline_detection : decline_detection ( data_directory = data_directory, threshold_anomaly = 0 .12 ) Essayez diff\u00e9rents seuils, observez les r\u00e9sultats. Plus ce seuil est \u00e9lev\u00e9, moins la d\u00e9tection est sensible. Il y a un juste milieu \u00e0 trouver afin de d\u00e9tecter les d\u00e9perissements le plus pr\u00e9cocement possible, en \u00e9vitant les faux positifs.","title":"Changer le seuil de d\u00e9tection d'anomalies"},{"location":"docs/03_Formation_scolytes/#changer-de-zone-detude","text":"A partir du m\u00eame script, nous allons maintenant faire tourner l'algorithme sur une deuxi\u00e8me zone d'\u00e9tude, celle-ci situ\u00e9e en Meuse et dont les premi\u00e8res attaques de scolytes sont d\u00e9j\u00e0 anciennes. Pour ce faire, modifiez \"ZoneEtude\" dans les param\u00e8tres input_directory , data_directory et shape_path en \"ZoneEtude2\", afin de donner le chemin des donn\u00e9es li\u00e9es \u00e0 cette zone : input_directory = \"D:/Documents/Deperissement/FORMATION_SANTE_FORETS/A_DATA/RASTER/SERIES_SENTINEL/ZoneEtude2\" data_directory = \"D:/Documents/Deperissement/FORMATION_SANTE_FORETS/C_RESULTS/ZoneEtude2\" shape_path = \"D:/Documents/Deperissement/FORMATION_SANTE_FORETS/A_DATA/VECTOR/ZONE_ETUDE/ZoneEtude2.shp\" Utilisez les param\u00e8tres de votre choix parmi ceux modifi\u00e9s pr\u00e9cedemment Relancez le script Prenez le temps d'observer les r\u00e9sultats du timelapse et des s\u00e9ries temporelles. Vous pourrez remarquer que cette zone, non situ\u00e9e dans la zone de chevauchement entre orbites, dispose d'un nombre de dates plus faible que la zone pr\u00e9cedente. Pour certains pixels, des dates entre 2018-01-01 et 2018-06-01 sont utilis\u00e9es dans l'apprentissage afin d'atteindre le nombre de 10 dates valides. Vous pouvez ouvrir le raster DataModel/first_detection_date_index.tif dans QGIS pour constater qu'\u00e0 la diff\u00e9rence de la zone d'\u00e9tude pr\u00e9c\u00e9dente, il y a effectivements des diff\u00e9rences de premi\u00e8re date utilis\u00e9e pour la d\u00e9tection.","title":"Changer de zone d'\u00e9tude"},{"location":"docs/03_Formation_scolytes/#exporter-des-resultats-adaptes-a-ses-besoins","text":"Les timelapses cr\u00e9es pour visualiser les r\u00e9sultats jusqu'ici ne peuvent pas \u00eatre r\u00e9alis\u00e9s \u00e0 grande \u00e9chelle. Pour sortir des r\u00e9sultats \u00e0 l'\u00e9chelle de tuiles enti\u00e8res qui soient utilisables facilement par les utilisateurs, il existe une cinqui\u00e8me \u00e9tape qui permet d'exporter les r\u00e9sultats sous forme de shapefile au pas de temps souhait\u00e9. Vous pouvez retrouver le guide d'utilisation de cette \u00e9tape . Pour effectuer cette \u00e9tape, ajouter au script : - Pour importer la fonction from fordead.steps.step5_export_results import export_results Pour lancer la fonction export_results ( data_directory = data_directory, start_date = \"2015-05-23\" , end_date = \"2022-05-23\" , frequency = \"M\" , export_soil = True, multiple_files = False ) Mettez en commentaire les fonctions de visualisation pour \u00e9viter leurs temps de calcul en rajoutant # au d\u00e9but de leurs lignes. Puis, relancez le script depuis l'invit\u00e9 de commande : python detection_scolytes.py Les r\u00e9sultats sont dans le dossier Results, importez les dans QGIS, ajoutez une symbologie Cat\u00e9goris\u00e9e \u00e0 partir du champ \"period\". - Dans le shapefile periodic_results_decline, les polygones contiennent la p\u00e9riode \u00e0 laquelle la premi\u00e8re anomalie a \u00e9t\u00e9 d\u00e9tect\u00e9 pour les zones d\u00e9p\u00e9rissantes. - Dans le shapefile periodic_results_soil, les polygones contiennent la p\u00e9riode \u00e0 laquelle la premi\u00e8re anomalie de sol a \u00e9t\u00e9 d\u00e9tect\u00e9 pour les zones d\u00e9tect\u00e9es comme sol nu/coupe. Explorez ces r\u00e9sultats et assurez vous de bien les comprendre. Ensuite, supprimez ces r\u00e9sultats de QGIS, puis sauvegardez les dans un dossier de sauvegarde si vous le souhaitez, car ils seront \u00e9cras\u00e9s par la suite. Essayez un param\u00e8trage diff\u00e9rent en modifiant multiple_files = False en multiple_files = True avant de relancer le script. Dans le m\u00eame dossier, vous devriez trouver un shapefile par mois dont le nom correspond \u00e0 la fin de chaque p\u00e9riode, ils contiennent des polygones correspondant \u00e0 l'\u00e9tat du peuplement \u00e0 la fin de la p\u00e9riode, m\u00eame si les premi\u00e8res anomalies ont lieu avant la date renseign\u00e9e par le param\u00e8tre start_date . L'\u00e9tat peut \u00eatre Atteint, Coupe ou Coupe sanitaire. Importez en quelques un entre 2018 et fin 2020 pour voir l'\u00e9volution. Ajoutez une symbologie Cat\u00e9goris\u00e9e \u00e0 partir du champ \"state\". Vous pouvez copier le style d'une des couches aux autres couches. Ensuite, supprimez ces r\u00e9sultats de QGIS, puis sauvegardez les dans un dossier de sauvegarde si vous le souhaitez, car ils seront \u00e9cras\u00e9s par la suite. Maintenant, modifiez le param\u00e8tre frequency , ce param\u00e8tre accepte des fr\u00e9quences journali\u00e8res (\"D\"), mensuelles (\"M\") ou annuelles (\"A\") ou des multiples (\"15D\" = jours, \"3M\" = trois mois...). Il est d\u00e9conseill\u00e9 de mettre une p\u00e9riode trop courte, puisqu'il faut qu'il y ait des dates SENTINEL-2 au sein de ces p\u00e9riodes pour que les r\u00e9sultats soient int\u00e9ressants. Ce param\u00e8tre accepte \u00e9galement la valeur \"sentinel\", auquel cas chaque p\u00e9riode correspond au temps entre chaque date SENTINEL-2 utilis\u00e9e. Les p\u00e9riodes ne sont donc pas de dur\u00e9e constante, par exemple si multiple_files = False , alors on obtient un shapefile pour chaque date SENTINEL-2 utilis\u00e9e. Faites tourner le script en utilisant le param\u00e8tre frequency = \"sentinel\" . Observez les r\u00e9sultats. Ensuite, prenez le temps d'essayer diff\u00e9rents param\u00e8tres de fr\u00e9quences, avec multiple_files = False et multiple_files = True , trouvez les param\u00e8tres qui vous semblent les plus adapt\u00e9s, r\u00e9flechissez aux am\u00e9liorations que vous aimeriez voir, tout cela pourra nourrir la discussion autour des informations produites par la m\u00e9thode et leur exploitation. N'h\u00e9sitez pas \u00e9galement \u00e0 modifier des param\u00e8tres plus en amont pour vous familiariser avec l'outil.","title":"Exporter des r\u00e9sultats adapt\u00e9s \u00e0 ses besoins"},{"location":"docs/user_guides/00_installation/","text":"ForDead_package Installation Conda install (recommended) Depuis l'invite de commande, placer vous dans le r\u00e9pertoire de votre choix et lancez les commandes suivantes : git clone https://gitlab.com/jbferet/fordead_package.git cd fordead_package conda env create --name ForDeadEnv conda activate ForDeadEnv pip install .","title":"00 Installation"},{"location":"docs/user_guides/00_installation/#fordead_package","text":"","title":"ForDead_package"},{"location":"docs/user_guides/00_installation/#installation","text":"","title":"Installation"},{"location":"docs/user_guides/00_installation/#conda-install-recommended","text":"Depuis l'invite de commande, placer vous dans le r\u00e9pertoire de votre choix et lancez les commandes suivantes : git clone https://gitlab.com/jbferet/fordead_package.git cd fordead_package conda env create --name ForDeadEnv conda activate ForDeadEnv pip install .","title":"Conda install (recommended)"},{"location":"docs/user_guides/01_compute_masked_vegetationindex/","text":"\u00c9TAPE 1 : step1_compute_masked_vegetationindex.py Cette \u00e9tape permet le calcul d'indices de v\u00e9g\u00e9tation et de masques pour chaque date SENTINEL-2 ENTR\u00c9ES Les param\u00e8tres en entr\u00e9e sont : - input_directory : le chemin du dossier correspondant \u00e0 une tuile ou une zone contenant un dossier par date SENTINEL contenant les diff\u00e9rentes bandes. Les dossiers doivent contenir la date correspondante dans leur nom sous un des formats suivants : YYYY-MM-DD, YYYY_MM_DD, YYYYMMDD, DD-MM-YYYY, DD_MM_YYYY ou DDMMYYYY. Les fichiers des bandes doivent contenir le nom de la bande correspondante (B2 ou B02, B3 ou B03, etc...). - data_directory : Le chemin du dossier de sortie, dans lequel seront \u00e9crit les indices de v\u00e9g\u00e9tations et masques - lim_perc_cloud : Le pourcentage maximum de nuages. Si le pourcentage de nuage de la date SENTINEL, calcul\u00e9 \u00e0 partir de la classification du fournisseur, est sup\u00e9rieur \u00e0 ce seuil, la date est ignor\u00e9e. - interpolation_order : Ordre d'interpolation pour le passage des bandes de 20m de r\u00e9solution \u00e0 10m. 0 : plus proche voisin, 1 : lin\u00e9aire, 2 : bilin\u00e9aire, 3 : cubique - sentinel_source : Source des donn\u00e9es parmi 'THEIA' et 'Scihub' et 'PEPS' - vi : Indice de v\u00e9g\u00e9tation utilis\u00e9 - extent_shape_path : Chemin d'un shapefile contenant un polygone utilis\u00e9 pour restreindre les calculs \u00e0 une zone. Si non renseign\u00e9, le calcul est appliqu\u00e9 \u00e0 l'ensemble de la tuile - path_dict_vi : Chemin d'un fichier texte permettant d'ajouter des indices de v\u00e9g\u00e9tations utilisables. Si non renseign\u00e9, uniquement les indices pr\u00e9vus dans le package sont utilisable (CRSWIR, NDVI). Le fichier examples/ex_dict_vi.txt donne l'exemple du formattage de ce fichier. Il s'agit de renseigner son nom, sa formule, et \"+\" ou \"-\" selon si l'indice augmente en cas de d\u00e9perissement, ou si il diminue. Note : input_directory et data_directory n'ont pas de valeur par d\u00e9faut et doivent absolument \u00eatre renseign\u00e9s. sentinel_source doit correspondre au fournisseur de vos donn\u00e9es. Le package a presque exclusivement \u00e9t\u00e9 test\u00e9 \u00e0 partir des donn\u00e9es THEIA. SORTIES Les sorties de cette premi\u00e8re \u00e9tape, dans le dossier data_directory, sont : - Un fichier TileInfo qui contient les informations relatives \u00e0 la zone \u00e9tudi\u00e9e, dates utilis\u00e9es, chemins des rasters... Il est import\u00e9 par les \u00e9tapes suivantes pour r\u00e9utilisation de ces informations. - Dans le dossier VegetationIndex , un raster pour chaque date o\u00f9 l'indice de v\u00e9g\u00e9tation est calcul\u00e9 pour chaque pixel - Dans le dossier Mask , un raster binaire pour chaque date o\u00f9 les pixels masqu\u00e9s valent 1, et les pixels valides 0. - Dans le dossier DataSoil , trois rasters : - count_soil : le nombre de dates successives avec des anomalies de sol - first_date_soil : L'index de la premi\u00e8re date avec une anomalie de sol de la derni\u00e8re s\u00e9rie d'anomalies de sol - state_soil : Un raster binaire qui vaut 1 si le pixel est d\u00e9tect\u00e9 comme sol (Au moins trois anomalies de sol successives) A partir de state_soil et first_date_soil, il est donc possible de savoir quels pixels sont d\u00e9tect\u00e9s comme sol nu/coupe, et \u00e0 partir de quelle date. count_soil permet de mettre \u00e0 jour ces donn\u00e9es en ajoutant de nouvelles dates SENTINEL.","title":"01 Compute Masked Vegetationindex"},{"location":"docs/user_guides/01_compute_masked_vegetationindex/#etape-1-step1_compute_masked_vegetationindexpy","text":"Cette \u00e9tape permet le calcul d'indices de v\u00e9g\u00e9tation et de masques pour chaque date SENTINEL-2","title":"\u00c9TAPE 1 : step1_compute_masked_vegetationindex.py"},{"location":"docs/user_guides/01_compute_masked_vegetationindex/#entrees","text":"Les param\u00e8tres en entr\u00e9e sont : - input_directory : le chemin du dossier correspondant \u00e0 une tuile ou une zone contenant un dossier par date SENTINEL contenant les diff\u00e9rentes bandes. Les dossiers doivent contenir la date correspondante dans leur nom sous un des formats suivants : YYYY-MM-DD, YYYY_MM_DD, YYYYMMDD, DD-MM-YYYY, DD_MM_YYYY ou DDMMYYYY. Les fichiers des bandes doivent contenir le nom de la bande correspondante (B2 ou B02, B3 ou B03, etc...). - data_directory : Le chemin du dossier de sortie, dans lequel seront \u00e9crit les indices de v\u00e9g\u00e9tations et masques - lim_perc_cloud : Le pourcentage maximum de nuages. Si le pourcentage de nuage de la date SENTINEL, calcul\u00e9 \u00e0 partir de la classification du fournisseur, est sup\u00e9rieur \u00e0 ce seuil, la date est ignor\u00e9e. - interpolation_order : Ordre d'interpolation pour le passage des bandes de 20m de r\u00e9solution \u00e0 10m. 0 : plus proche voisin, 1 : lin\u00e9aire, 2 : bilin\u00e9aire, 3 : cubique - sentinel_source : Source des donn\u00e9es parmi 'THEIA' et 'Scihub' et 'PEPS' - vi : Indice de v\u00e9g\u00e9tation utilis\u00e9 - extent_shape_path : Chemin d'un shapefile contenant un polygone utilis\u00e9 pour restreindre les calculs \u00e0 une zone. Si non renseign\u00e9, le calcul est appliqu\u00e9 \u00e0 l'ensemble de la tuile - path_dict_vi : Chemin d'un fichier texte permettant d'ajouter des indices de v\u00e9g\u00e9tations utilisables. Si non renseign\u00e9, uniquement les indices pr\u00e9vus dans le package sont utilisable (CRSWIR, NDVI). Le fichier examples/ex_dict_vi.txt donne l'exemple du formattage de ce fichier. Il s'agit de renseigner son nom, sa formule, et \"+\" ou \"-\" selon si l'indice augmente en cas de d\u00e9perissement, ou si il diminue. Note : input_directory et data_directory n'ont pas de valeur par d\u00e9faut et doivent absolument \u00eatre renseign\u00e9s. sentinel_source doit correspondre au fournisseur de vos donn\u00e9es. Le package a presque exclusivement \u00e9t\u00e9 test\u00e9 \u00e0 partir des donn\u00e9es THEIA.","title":"ENTR\u00c9ES"},{"location":"docs/user_guides/01_compute_masked_vegetationindex/#sorties","text":"Les sorties de cette premi\u00e8re \u00e9tape, dans le dossier data_directory, sont : - Un fichier TileInfo qui contient les informations relatives \u00e0 la zone \u00e9tudi\u00e9e, dates utilis\u00e9es, chemins des rasters... Il est import\u00e9 par les \u00e9tapes suivantes pour r\u00e9utilisation de ces informations. - Dans le dossier VegetationIndex , un raster pour chaque date o\u00f9 l'indice de v\u00e9g\u00e9tation est calcul\u00e9 pour chaque pixel - Dans le dossier Mask , un raster binaire pour chaque date o\u00f9 les pixels masqu\u00e9s valent 1, et les pixels valides 0. - Dans le dossier DataSoil , trois rasters : - count_soil : le nombre de dates successives avec des anomalies de sol - first_date_soil : L'index de la premi\u00e8re date avec une anomalie de sol de la derni\u00e8re s\u00e9rie d'anomalies de sol - state_soil : Un raster binaire qui vaut 1 si le pixel est d\u00e9tect\u00e9 comme sol (Au moins trois anomalies de sol successives) A partir de state_soil et first_date_soil, il est donc possible de savoir quels pixels sont d\u00e9tect\u00e9s comme sol nu/coupe, et \u00e0 partir de quelle date. count_soil permet de mettre \u00e0 jour ces donn\u00e9es en ajoutant de nouvelles dates SENTINEL.","title":"SORTIES"},{"location":"docs/user_guides/02_train_model/","text":"\u00c9TAPE 2 : step2_TrainFordead.py Cette \u00e9tape permet le calcul d'un mod\u00e8le \u00e0 partir des premi\u00e8res dates SENTINEL, consid\u00e9r\u00e9es comme repr\u00e9sentatives du comportement saisonnier normal de l'indice de v\u00e9g\u00e9tation. Ce mod\u00e8le permet de pr\u00e9dire la valeur de l'indice de v\u00e9g\u00e9tation \u00e0 n'importe quelle date. ENTR\u00c9ES Les param\u00e8tres en entr\u00e9e sont : - data_directory : Le chemin du dossier de sortie dans lequel sera \u00e9crit les coefficients du mod\u00e8le. - nb_min_date : Nombre minimum de dates valides pour calculer un mod\u00e8le - min_last_date_training : Date au format AAAA-MM-JJ \u00e0 partir de laquelle les dates SENTINEL ne sont plus utilis\u00e9es pour l'apprentissage, tant qu'il y a au moins nb_min_date dates valides pour le pixel - max_last_date_training : Date au format AAAA-MM-JJ jusqu'\u00e0 laquelle les dates SENTINEL peuvent \u00eatre utilis\u00e9es pour l'apprentissage afin d'atteindre le nombre de nb_min_date dates valides - path_vi : Chemin du dossier contenant un raster pour chaque date o\u00f9 l'indice de v\u00e9g\u00e9tation est calcul\u00e9 pour chaque pixel. Inutile de le renseigner si les informations proviennent de l'\u00e9tape 1, auquel cas le chemin est contenu dans le fichier TileInfo. - path_masks : Chemin du dossier contenant un raster binaire pour chaque date o\u00f9 les pixels masqu\u00e9s valent 1, et les pixels valides 0. Inutile de le renseigner si les informations proviennent de l'\u00e9tape 1, auquel cas le chemin est contenu dans le fichier TileInfo. Les coefficients du mod\u00e8le sont calcul\u00e9s pour chaque pixel. Pour chaque pixel, uniquement les dates non masqu\u00e9es sont utilis\u00e9es. Si il y a nb_min_date dates valides \u00e0 la date max_last_date_training, l'apprentissage s'arr\u00eate \u00e0 cette date. Si le nombre de date de dates valides atteint nb_min_date entre \u00e0 une date situ\u00e9e entre min_last_date_training et max_last_date_training, l'apprentissage s'arr\u00eate \u00e0 cette date. Si le nombre de date de dates valides n'atteint pas nb_min_date \u00e0 la date max_last_date_training, le pixel est sorti de l'\u00e9tude et ne sera pas associ\u00e9 \u00e0 un mod\u00e8le. Cette m\u00e9thode permet, dans le cas d'une crise sanitaire relativement ancienne comme le scolyte, de commencer la d\u00e9tection d\u00e8s 2018 si l'on dispose de suffisamment de dates valides au d\u00e9but de l'ann\u00e9e, tout permettant l'\u00e9tude de pixels dans des situations de d\u00e9tection plus d\u00e9licates simplement en r\u00e9alisant l'apprentissage sur une p\u00e9riode plus longue pour r\u00e9cup\u00e9rer d'autres dates valides. Il parait difficile de terminer l'apprentissage avant 2018, car le mod\u00e8le p\u00e9riodique \u00e9tant annuel, l'utilisation d'au moins deux ans de donn\u00e9es SENTINEL-2 parait obligatoire. SORTIES Les sorties de cette deuxi\u00e8me \u00e9tape, dans le dossier data_directory, sont : - Dans le dossier DataModel , deux fichiers : - first_detection_date_index.tif , un raster qui contient l'index de la premi\u00e8re date qui sera utilis\u00e9e pour la d\u00e9tection de d\u00e9perissement. Il permet de savoir pour chaque pixel quelles dates ont \u00e9t\u00e9 utilis\u00e9es pour l'apprentissage et lesquelles sont utilis\u00e9es pour la d\u00e9tection. - coeff_model.tif , un stack \u00e0 5 bandes, une pour chaque coefficient du mod\u00e8le de l'indice de v\u00e9g\u00e9tation. - Dans le dossier ForestMask , le raster binaire valid_area_mask.tif qui vaut 1 pour les pixels o\u00f9 le mod\u00e8le a pu \u00eatre calcul\u00e9, 0 si il n'y avait pas assez de dates valides - Le fichier TileInfo est mis \u00e0 jour.","title":"02 Train Model"},{"location":"docs/user_guides/02_train_model/#etape-2-step2_trainfordeadpy","text":"Cette \u00e9tape permet le calcul d'un mod\u00e8le \u00e0 partir des premi\u00e8res dates SENTINEL, consid\u00e9r\u00e9es comme repr\u00e9sentatives du comportement saisonnier normal de l'indice de v\u00e9g\u00e9tation. Ce mod\u00e8le permet de pr\u00e9dire la valeur de l'indice de v\u00e9g\u00e9tation \u00e0 n'importe quelle date.","title":"\u00c9TAPE 2 : step2_TrainFordead.py"},{"location":"docs/user_guides/02_train_model/#entrees","text":"Les param\u00e8tres en entr\u00e9e sont : - data_directory : Le chemin du dossier de sortie dans lequel sera \u00e9crit les coefficients du mod\u00e8le. - nb_min_date : Nombre minimum de dates valides pour calculer un mod\u00e8le - min_last_date_training : Date au format AAAA-MM-JJ \u00e0 partir de laquelle les dates SENTINEL ne sont plus utilis\u00e9es pour l'apprentissage, tant qu'il y a au moins nb_min_date dates valides pour le pixel - max_last_date_training : Date au format AAAA-MM-JJ jusqu'\u00e0 laquelle les dates SENTINEL peuvent \u00eatre utilis\u00e9es pour l'apprentissage afin d'atteindre le nombre de nb_min_date dates valides - path_vi : Chemin du dossier contenant un raster pour chaque date o\u00f9 l'indice de v\u00e9g\u00e9tation est calcul\u00e9 pour chaque pixel. Inutile de le renseigner si les informations proviennent de l'\u00e9tape 1, auquel cas le chemin est contenu dans le fichier TileInfo. - path_masks : Chemin du dossier contenant un raster binaire pour chaque date o\u00f9 les pixels masqu\u00e9s valent 1, et les pixels valides 0. Inutile de le renseigner si les informations proviennent de l'\u00e9tape 1, auquel cas le chemin est contenu dans le fichier TileInfo. Les coefficients du mod\u00e8le sont calcul\u00e9s pour chaque pixel. Pour chaque pixel, uniquement les dates non masqu\u00e9es sont utilis\u00e9es. Si il y a nb_min_date dates valides \u00e0 la date max_last_date_training, l'apprentissage s'arr\u00eate \u00e0 cette date. Si le nombre de date de dates valides atteint nb_min_date entre \u00e0 une date situ\u00e9e entre min_last_date_training et max_last_date_training, l'apprentissage s'arr\u00eate \u00e0 cette date. Si le nombre de date de dates valides n'atteint pas nb_min_date \u00e0 la date max_last_date_training, le pixel est sorti de l'\u00e9tude et ne sera pas associ\u00e9 \u00e0 un mod\u00e8le. Cette m\u00e9thode permet, dans le cas d'une crise sanitaire relativement ancienne comme le scolyte, de commencer la d\u00e9tection d\u00e8s 2018 si l'on dispose de suffisamment de dates valides au d\u00e9but de l'ann\u00e9e, tout permettant l'\u00e9tude de pixels dans des situations de d\u00e9tection plus d\u00e9licates simplement en r\u00e9alisant l'apprentissage sur une p\u00e9riode plus longue pour r\u00e9cup\u00e9rer d'autres dates valides. Il parait difficile de terminer l'apprentissage avant 2018, car le mod\u00e8le p\u00e9riodique \u00e9tant annuel, l'utilisation d'au moins deux ans de donn\u00e9es SENTINEL-2 parait obligatoire.","title":"ENTR\u00c9ES"},{"location":"docs/user_guides/02_train_model/#sorties","text":"Les sorties de cette deuxi\u00e8me \u00e9tape, dans le dossier data_directory, sont : - Dans le dossier DataModel , deux fichiers : - first_detection_date_index.tif , un raster qui contient l'index de la premi\u00e8re date qui sera utilis\u00e9e pour la d\u00e9tection de d\u00e9perissement. Il permet de savoir pour chaque pixel quelles dates ont \u00e9t\u00e9 utilis\u00e9es pour l'apprentissage et lesquelles sont utilis\u00e9es pour la d\u00e9tection. - coeff_model.tif , un stack \u00e0 5 bandes, une pour chaque coefficient du mod\u00e8le de l'indice de v\u00e9g\u00e9tation. - Dans le dossier ForestMask , le raster binaire valid_area_mask.tif qui vaut 1 pour les pixels o\u00f9 le mod\u00e8le a pu \u00eatre calcul\u00e9, 0 si il n'y avait pas assez de dates valides - Le fichier TileInfo est mis \u00e0 jour.","title":"SORTIES"},{"location":"docs/user_guides/03_decline_detection/","text":"\u00c9TAPE 3 : step3_DetectionFordead.py Cette \u00e9tape permet la d\u00e9tection du d\u00e9perissement. Pour chaque date SENTINEL non utilis\u00e9e pour l'apprentissage, l'indice de v\u00e9g\u00e9tation r\u00e9el est compar\u00e9 \u00e0 l'indice de v\u00e9g\u00e9tation pr\u00e9dit \u00e0 partir des mod\u00e8les calcul\u00e9s dans l'\u00e9tape pr\u00e9c\u00e8dente. Si la diff\u00e9rence d\u00e9passe un seuil, une anomalie est d\u00e9tect\u00e9e. Si trois anomalies successives sont d\u00e9tect\u00e9es, le pixel est consid\u00e9r\u00e9 comme d\u00e9p\u00e9rissant. Si apr\u00e8s avoir \u00e9t\u00e9 d\u00e9tect\u00e9 comme d\u00e9perissant, le pixel a trois dates successives sans anomalies, il n'est plus consid\u00e9r\u00e9 comme d\u00e9p\u00e9rissant. ENTR\u00c9ES Les param\u00e8tres en entr\u00e9e sont : - data_directory : Le chemin du dossier de sortie dans lequel sera \u00e9crit les r\u00e9sultats de la d\u00e9tection. - threshold_anomaly : Seuil \u00e0 partir duquel la diff\u00e9rence entre l'indice de v\u00e9g\u00e9tation r\u00e9el et pr\u00e9dit est consid\u00e9r\u00e9 comme une anomalie SORTIES Les sorties de cette troisi\u00e8me \u00e9tape, dans le dossier data_directory, sont : - Dans le dossier DataDecline , trois rasters : - count_decline : le nombre de dates successives avec des anomalies - first_date_decline : L'index de la premi\u00e8re date avec une anomalie de la derni\u00e8re s\u00e9rie d'anomalies - state_decline : Un raster binaire qui vaut 1 si le pixel est d\u00e9tect\u00e9 comme d\u00e9perissant (Au moins trois anomalies successives)","title":"03 Decline Detection"},{"location":"docs/user_guides/03_decline_detection/#etape-3-step3_detectionfordeadpy","text":"Cette \u00e9tape permet la d\u00e9tection du d\u00e9perissement. Pour chaque date SENTINEL non utilis\u00e9e pour l'apprentissage, l'indice de v\u00e9g\u00e9tation r\u00e9el est compar\u00e9 \u00e0 l'indice de v\u00e9g\u00e9tation pr\u00e9dit \u00e0 partir des mod\u00e8les calcul\u00e9s dans l'\u00e9tape pr\u00e9c\u00e8dente. Si la diff\u00e9rence d\u00e9passe un seuil, une anomalie est d\u00e9tect\u00e9e. Si trois anomalies successives sont d\u00e9tect\u00e9es, le pixel est consid\u00e9r\u00e9 comme d\u00e9p\u00e9rissant. Si apr\u00e8s avoir \u00e9t\u00e9 d\u00e9tect\u00e9 comme d\u00e9perissant, le pixel a trois dates successives sans anomalies, il n'est plus consid\u00e9r\u00e9 comme d\u00e9p\u00e9rissant.","title":"\u00c9TAPE 3 : step3_DetectionFordead.py"},{"location":"docs/user_guides/03_decline_detection/#entrees","text":"Les param\u00e8tres en entr\u00e9e sont : - data_directory : Le chemin du dossier de sortie dans lequel sera \u00e9crit les r\u00e9sultats de la d\u00e9tection. - threshold_anomaly : Seuil \u00e0 partir duquel la diff\u00e9rence entre l'indice de v\u00e9g\u00e9tation r\u00e9el et pr\u00e9dit est consid\u00e9r\u00e9 comme une anomalie","title":"ENTR\u00c9ES"},{"location":"docs/user_guides/03_decline_detection/#sorties","text":"Les sorties de cette troisi\u00e8me \u00e9tape, dans le dossier data_directory, sont : - Dans le dossier DataDecline , trois rasters : - count_decline : le nombre de dates successives avec des anomalies - first_date_decline : L'index de la premi\u00e8re date avec une anomalie de la derni\u00e8re s\u00e9rie d'anomalies - state_decline : Un raster binaire qui vaut 1 si le pixel est d\u00e9tect\u00e9 comme d\u00e9perissant (Au moins trois anomalies successives)","title":"SORTIES"},{"location":"docs/user_guides/04_compute_forest_mask/","text":"\u00c9TAPE 4 : step4_compute_forest_mask.py Cette \u00e9tape permet de calculer le masque for\u00eat et ainsi d\u00e9finir les zones d'int\u00e9r\u00eat. ENTR\u00c9ES Les param\u00e8tres en entr\u00e9e sont : - data_directory : Le chemin du dossier de sortie dans lequel sera \u00e9crit le masque for\u00eat - forest_mask_source : Source du masque for\u00eat, peut \u00eatre \"BDFORET\" pour utiliser la BD For\u00eat de l'IGN, \"OSO\" pour utiliser la carte d'occupation des sols du CESBIO, ou None pour ne pas utiliser de masque for\u00eat et \u00e9tendre la zone d'int\u00e9r\u00eat \u00e0 l'ensemble des pixels - dep_path : Chemin d'un shapefile des d\u00e9partements fran\u00e7ais contenant le code insee dans un champ code_insee, seulement utile si forest_mask_source vaut \"BDFORET\" - bdforet_dirpath : Chemin du dossier contenant la BD For\u00eat de l'IGN avec un dossier par d\u00e9partement. Seulement utile si forest_mask_source vaut \"BDFORET\" - list_forest_type : Liste des types de peuplements \u00e0 garder dans le masque for\u00eat, correspond au CODE_TFV de la BD For\u00eat. Seulement utile si forest_mask_source vaut \"BDFORET\" - path_oso : Chemin du raster d'occupation des sols du CESBIO. Seulement utile si forest_mask_source vaut \"OSO\". - list_code_oso : Liste des valeurs du raster OSO \u00e0 conserver dans le masque for\u00eat. Seulement utile si forest_mask_source vaut \"OSO\". - path_example_raster : Chemin d'un raster \"example\" utilis\u00e9 pour conna\u00eetre l'extent, le syst\u00e8me de projection, etc... Seulement utile s'il n'y a pas dans le data_directory un fichier TileInfo cr\u00e9e par les \u00e9tapes pr\u00e9c\u00e8dentes d'o\u00f9 peuvent \u00eatre extraites ces informations. SORTIES Les sorties de cette quatri\u00e8me \u00e9tape, dans le dossier data_directory, sont : - Dans le dossier ForestMask , le raster binaire Forest_Mask.tif qui vaut 1 sur les pixels de for\u00eat \u00e0 \u00e9tudier et 0 ailleurs.","title":"04 Compute Forest Mask"},{"location":"docs/user_guides/04_compute_forest_mask/#etape-4-step4_compute_forest_maskpy","text":"Cette \u00e9tape permet de calculer le masque for\u00eat et ainsi d\u00e9finir les zones d'int\u00e9r\u00eat.","title":"\u00c9TAPE 4 : step4_compute_forest_mask.py"},{"location":"docs/user_guides/04_compute_forest_mask/#entrees","text":"Les param\u00e8tres en entr\u00e9e sont : - data_directory : Le chemin du dossier de sortie dans lequel sera \u00e9crit le masque for\u00eat - forest_mask_source : Source du masque for\u00eat, peut \u00eatre \"BDFORET\" pour utiliser la BD For\u00eat de l'IGN, \"OSO\" pour utiliser la carte d'occupation des sols du CESBIO, ou None pour ne pas utiliser de masque for\u00eat et \u00e9tendre la zone d'int\u00e9r\u00eat \u00e0 l'ensemble des pixels - dep_path : Chemin d'un shapefile des d\u00e9partements fran\u00e7ais contenant le code insee dans un champ code_insee, seulement utile si forest_mask_source vaut \"BDFORET\" - bdforet_dirpath : Chemin du dossier contenant la BD For\u00eat de l'IGN avec un dossier par d\u00e9partement. Seulement utile si forest_mask_source vaut \"BDFORET\" - list_forest_type : Liste des types de peuplements \u00e0 garder dans le masque for\u00eat, correspond au CODE_TFV de la BD For\u00eat. Seulement utile si forest_mask_source vaut \"BDFORET\" - path_oso : Chemin du raster d'occupation des sols du CESBIO. Seulement utile si forest_mask_source vaut \"OSO\". - list_code_oso : Liste des valeurs du raster OSO \u00e0 conserver dans le masque for\u00eat. Seulement utile si forest_mask_source vaut \"OSO\". - path_example_raster : Chemin d'un raster \"example\" utilis\u00e9 pour conna\u00eetre l'extent, le syst\u00e8me de projection, etc... Seulement utile s'il n'y a pas dans le data_directory un fichier TileInfo cr\u00e9e par les \u00e9tapes pr\u00e9c\u00e8dentes d'o\u00f9 peuvent \u00eatre extraites ces informations.","title":"ENTR\u00c9ES"},{"location":"docs/user_guides/04_compute_forest_mask/#sorties","text":"Les sorties de cette quatri\u00e8me \u00e9tape, dans le dossier data_directory, sont : - Dans le dossier ForestMask , le raster binaire Forest_Mask.tif qui vaut 1 sur les pixels de for\u00eat \u00e0 \u00e9tudier et 0 ailleurs.","title":"SORTIES"},{"location":"docs/user_guides/05_export_results/","text":"\u00c9TAPE 5 : step5_export_results.py Cette \u00e9tape permet de sortir les r\u00e9sultats sous la forme d\u00e9sir\u00e9e par l'utilisateur, pour la p\u00e9riode et fr\u00e9quence souhait\u00e9e. ENTR\u00c9ES Les param\u00e8tres en entr\u00e9e sont : - data_directory : Le chemin du dossier de sortie dans lequel sera \u00e9crit les r\u00e9sultats - start_date : Date de d\u00e9but, au format AAAA-MM-JJ - end_date : Date de fin, au format AAAA-MM-JJ - frequency : Fr\u00e9quence \u00e0 laquelle les r\u00e9sultats sont export\u00e9s. Peut \u00eatre \"sentinel\", auquel cas la fr\u00e9quence correspond aux dates SENTINEL, ou une fr\u00e9quence telle qu'accept\u00e9e par la fonction pandas.date_range (ex : 'M' (tous les mois), '3M' (tous les trois mois), '15D' (tous les 15 jours)\") - export_soil : Si True, les r\u00e9sultats relatifs \u00e0 la d\u00e9tection de sol nu/coupes sont export\u00e9s \u00e9galement. - multiple_files : Si True, un shapefile sera export\u00e9 par p\u00e9riode, o\u00f9 chaque polygone correspond \u00e0 l'\u00e9tat de la zone \u00e0 la fin de la p\u00e9riode. Sinon, un seul shapefile est export\u00e9 et les polygones contiennent la p\u00e9riode \u00e0 laquelle la premi\u00e8re anomalie a \u00e9t\u00e9 d\u00e9tect\u00e9. SORTIES Les sorties de cette cinqui\u00e8me \u00e9tape, dans le dossier data_directory/Results, sont : - si multiple_files vaut False : - le shapefile periodic_results_decline, dont les polygones contiennent la p\u00e9riode \u00e0 laquelle la premi\u00e8re anomalie a \u00e9t\u00e9 d\u00e9tect\u00e9 pour les zones d\u00e9p\u00e9rissantes. Les zones atteintes avant start_date ou apr\u00e8s end_date ne sont pas repr\u00e9sent\u00e9es. - si export_soil est activ\u00e9, le shapefile periodic_results_soil dont les polygones contiennent la p\u00e9riode \u00e0 laquelle la premi\u00e8re anomalie de sol a \u00e9t\u00e9 d\u00e9tect\u00e9 pour les zones d\u00e9tect\u00e9es comme sol nu/coupe. Les zones \u00e0 nu avant start_date ou apr\u00e8s end_date ne sont pas repr\u00e9sent\u00e9es. - si multiple_files vaut True : - Un shapefile par p\u00e9riode dont le nom est la date de fin de la p\u00e9riode (par exemple, avec start_date = 2018-01-01, end_date = 2018-04-01 et frequency = \"M\", on aura les fichiers suivants : 2018-01-30.shp, 2018-02-28.shp et 2018-03-31.shp. Chaque shapefile contient des polygones correspondant \u00e0 l'\u00e9tat du peuplement \u00e0 la fin de la p\u00e9riode, m\u00eame si les premi\u00e8res anomalies ont lieu avant start_date. L'\u00e9tat peut \u00eatre Atteint, Coupe ou Coupe sanitaire si export_soil est activ\u00e9, ou simplement \"Atteint\" sinon.","title":"05 Export Results"},{"location":"docs/user_guides/05_export_results/#etape-5-step5_export_resultspy","text":"Cette \u00e9tape permet de sortir les r\u00e9sultats sous la forme d\u00e9sir\u00e9e par l'utilisateur, pour la p\u00e9riode et fr\u00e9quence souhait\u00e9e.","title":"\u00c9TAPE 5 : step5_export_results.py"},{"location":"docs/user_guides/05_export_results/#entrees","text":"Les param\u00e8tres en entr\u00e9e sont : - data_directory : Le chemin du dossier de sortie dans lequel sera \u00e9crit les r\u00e9sultats - start_date : Date de d\u00e9but, au format AAAA-MM-JJ - end_date : Date de fin, au format AAAA-MM-JJ - frequency : Fr\u00e9quence \u00e0 laquelle les r\u00e9sultats sont export\u00e9s. Peut \u00eatre \"sentinel\", auquel cas la fr\u00e9quence correspond aux dates SENTINEL, ou une fr\u00e9quence telle qu'accept\u00e9e par la fonction pandas.date_range (ex : 'M' (tous les mois), '3M' (tous les trois mois), '15D' (tous les 15 jours)\") - export_soil : Si True, les r\u00e9sultats relatifs \u00e0 la d\u00e9tection de sol nu/coupes sont export\u00e9s \u00e9galement. - multiple_files : Si True, un shapefile sera export\u00e9 par p\u00e9riode, o\u00f9 chaque polygone correspond \u00e0 l'\u00e9tat de la zone \u00e0 la fin de la p\u00e9riode. Sinon, un seul shapefile est export\u00e9 et les polygones contiennent la p\u00e9riode \u00e0 laquelle la premi\u00e8re anomalie a \u00e9t\u00e9 d\u00e9tect\u00e9.","title":"ENTR\u00c9ES"},{"location":"docs/user_guides/05_export_results/#sorties","text":"Les sorties de cette cinqui\u00e8me \u00e9tape, dans le dossier data_directory/Results, sont : - si multiple_files vaut False : - le shapefile periodic_results_decline, dont les polygones contiennent la p\u00e9riode \u00e0 laquelle la premi\u00e8re anomalie a \u00e9t\u00e9 d\u00e9tect\u00e9 pour les zones d\u00e9p\u00e9rissantes. Les zones atteintes avant start_date ou apr\u00e8s end_date ne sont pas repr\u00e9sent\u00e9es. - si export_soil est activ\u00e9, le shapefile periodic_results_soil dont les polygones contiennent la p\u00e9riode \u00e0 laquelle la premi\u00e8re anomalie de sol a \u00e9t\u00e9 d\u00e9tect\u00e9 pour les zones d\u00e9tect\u00e9es comme sol nu/coupe. Les zones \u00e0 nu avant start_date ou apr\u00e8s end_date ne sont pas repr\u00e9sent\u00e9es. - si multiple_files vaut True : - Un shapefile par p\u00e9riode dont le nom est la date de fin de la p\u00e9riode (par exemple, avec start_date = 2018-01-01, end_date = 2018-04-01 et frequency = \"M\", on aura les fichiers suivants : 2018-01-30.shp, 2018-02-28.shp et 2018-03-31.shp. Chaque shapefile contient des polygones correspondant \u00e0 l'\u00e9tat du peuplement \u00e0 la fin de la p\u00e9riode, m\u00eame si les premi\u00e8res anomalies ont lieu avant start_date. L'\u00e9tat peut \u00eatre Atteint, Coupe ou Coupe sanitaire si export_soil est activ\u00e9, ou simplement \"Atteint\" sinon.","title":"SORTIES"},{"location":"reference/fordead/ImportData/","text":"Module fordead.ImportData Created on Mon Nov 2 09:42:31 2020 @author: Raphael Dutrieux Functions get_cloudiness def get_cloudiness ( path_cloudiness , dict_path_bands , sentinel_source ) For every date in dict_path_bands ( which is meant to contain each date available in the sentinel data directory ), computes the cloudiness percentage from the mask at path dict_path_bands [ date ][ \"Mask\" ] if it was not already computed and stored at path_cloudiness in a TileInfo object . Returns a dictionnary where the key is the date and the value is the cloudiness percentage . get_date_cloudiness_perc def get_date_cloudiness_perc ( date_paths , sentinel_source ) Computes cloudiness percentage of a Sentinel-2 date from the source mask (THEIA CLM or PEPS, scihub SCL) import_stackedmaskedVI def import_stackedmaskedVI ( tuile , max_last_date_training = None , chunks = None ) Parameters ---------- tuile : Object of class TileInfo Object containing paths of vegetation index and masks for each date Returns ------- stack_vi : xarray.DataArray DataArray containing vegetation index value with dimension Time, x and y stack_masks : xarray.DataArray DataArray containing mask value with dimension Time, x and y retrieve_date_from_string def retrieve_date_from_string ( string ) From a string containing a date in the format YYYY - MM - DD , YYYY_MM_DD , YYYYMMDD , DD - MM - YYYY , DD_MM_YYYY or DDMMYYYY , retrieves the date in the format YYYY - MM - DD . Works only for 20 th and 21 st centuries ( years beginning with 19 or 20 ) Parameters ---------- string : str String containing a date Returns ------- formatted_date : str Date in the format YYYY - MM - DD Classes TileInfo class TileInfo ( data_directory ) Methods add_parameters def add_parameters ( self , parameters ) Adds attribute 'parameters' to TileInfo object which contains dictionnary of parameters and their values . If attribute parameters already exists , checks for conflicts then updates parameters In case of conflicts , meaning if parameter was unknown or changed , the parameter 'Overwrite' is set to True and it is advised to remove previous results . Parameters ---------- parameters : dict Dictionnary containing parameters and their values delete_dirs def delete_dirs ( self , * key_paths ) Using keys to paths ( usually added through add_path or add_dirpath ), deletes directory containing the file , or the directory if the path already links to a directory . Parameters ---------- key_path : str Key in the dictionnary containing paths Returns ------- None . delete_files def delete_files ( self , * key_paths ) Using keys to paths ( usually added through add_path ), deletes file Parameters ---------- key_path : str Key in the dictionnary containing paths Returns ------- None . getdict_datepaths def getdict_datepaths ( self , key , path_dir ) Parameters ---------- path_dir : pathlib.WindowsPath Directory containing files with filenames containing dates in the format YYYY-MM-DD, YYYY_MM_DD, YYYYMMDD, DD-MM-YYYY, DD_MM_YYYY or DDMMYYYY Returns ------- dict_datepaths : dict Dictionnary linking formatted dates with the paths of the files from which the dates where extracted import_info def import_info ( self , path = None ) Imports TileInfo object in the data_directory, or the one at path if the parameter is given save_info def save_info ( self , path = None ) Saves the TileInfo object in its data_directory by default or in specified location","title":"Importdata"},{"location":"reference/fordead/ImportData/#module-fordeadimportdata","text":"Created on Mon Nov 2 09:42:31 2020 @author: Raphael Dutrieux","title":"Module fordead.ImportData"},{"location":"reference/fordead/ImportData/#functions","text":"","title":"Functions"},{"location":"reference/fordead/ImportData/#get_cloudiness","text":"def get_cloudiness ( path_cloudiness , dict_path_bands , sentinel_source ) For every date in dict_path_bands ( which is meant to contain each date available in the sentinel data directory ), computes the cloudiness percentage from the mask at path dict_path_bands [ date ][ \"Mask\" ] if it was not already computed and stored at path_cloudiness in a TileInfo object . Returns a dictionnary where the key is the date and the value is the cloudiness percentage .","title":"get_cloudiness"},{"location":"reference/fordead/ImportData/#get_date_cloudiness_perc","text":"def get_date_cloudiness_perc ( date_paths , sentinel_source ) Computes cloudiness percentage of a Sentinel-2 date from the source mask (THEIA CLM or PEPS, scihub SCL)","title":"get_date_cloudiness_perc"},{"location":"reference/fordead/ImportData/#import_stackedmaskedvi","text":"def import_stackedmaskedVI ( tuile , max_last_date_training = None , chunks = None ) Parameters ---------- tuile : Object of class TileInfo Object containing paths of vegetation index and masks for each date Returns ------- stack_vi : xarray.DataArray DataArray containing vegetation index value with dimension Time, x and y stack_masks : xarray.DataArray DataArray containing mask value with dimension Time, x and y","title":"import_stackedmaskedVI"},{"location":"reference/fordead/ImportData/#retrieve_date_from_string","text":"def retrieve_date_from_string ( string ) From a string containing a date in the format YYYY - MM - DD , YYYY_MM_DD , YYYYMMDD , DD - MM - YYYY , DD_MM_YYYY or DDMMYYYY , retrieves the date in the format YYYY - MM - DD . Works only for 20 th and 21 st centuries ( years beginning with 19 or 20 ) Parameters ---------- string : str String containing a date Returns ------- formatted_date : str Date in the format YYYY - MM - DD","title":"retrieve_date_from_string"},{"location":"reference/fordead/ImportData/#classes","text":"","title":"Classes"},{"location":"reference/fordead/ImportData/#tileinfo","text":"class TileInfo ( data_directory )","title":"TileInfo"},{"location":"reference/fordead/ImportData/#methods","text":"","title":"Methods"},{"location":"reference/fordead/ImportData/#add_parameters","text":"def add_parameters ( self , parameters ) Adds attribute 'parameters' to TileInfo object which contains dictionnary of parameters and their values . If attribute parameters already exists , checks for conflicts then updates parameters In case of conflicts , meaning if parameter was unknown or changed , the parameter 'Overwrite' is set to True and it is advised to remove previous results . Parameters ---------- parameters : dict Dictionnary containing parameters and their values","title":"add_parameters"},{"location":"reference/fordead/ImportData/#delete_dirs","text":"def delete_dirs ( self , * key_paths ) Using keys to paths ( usually added through add_path or add_dirpath ), deletes directory containing the file , or the directory if the path already links to a directory . Parameters ---------- key_path : str Key in the dictionnary containing paths Returns ------- None .","title":"delete_dirs"},{"location":"reference/fordead/ImportData/#delete_files","text":"def delete_files ( self , * key_paths ) Using keys to paths ( usually added through add_path ), deletes file Parameters ---------- key_path : str Key in the dictionnary containing paths Returns ------- None .","title":"delete_files"},{"location":"reference/fordead/ImportData/#getdict_datepaths","text":"def getdict_datepaths ( self , key , path_dir ) Parameters ---------- path_dir : pathlib.WindowsPath Directory containing files with filenames containing dates in the format YYYY-MM-DD, YYYY_MM_DD, YYYYMMDD, DD-MM-YYYY, DD_MM_YYYY or DDMMYYYY Returns ------- dict_datepaths : dict Dictionnary linking formatted dates with the paths of the files from which the dates where extracted","title":"getdict_datepaths"},{"location":"reference/fordead/ImportData/#import_info","text":"def import_info ( self , path = None ) Imports TileInfo object in the data_directory, or the one at path if the parameter is given","title":"import_info"},{"location":"reference/fordead/ImportData/#save_info","text":"def save_info ( self , path = None ) Saves the TileInfo object in its data_directory by default or in specified location","title":"save_info"},{"location":"reference/fordead/ModelVegetationIndex/","text":"Module fordead.ModelVegetationIndex Created on Tue Nov 3 16:21:35 2020 @author: Raphael Dutrieux Functions censored_lstsq def censored_lstsq ( B , M , A ) Solves least squares problem subject to missing data , compatible with numpy , dask and xarray . Code inspired from http :// alexhwilliams . info / itsneuronalblog / 2018 / 02 / 26 / censored - lstsq Parameters ---------- B : ( N , ...) numpy . ndarray or xarray . DataArray M : ( N , ...) boolean numpy . ndarray or xarray . DataArray Mask giving the missing data ( when False the data is not used in computation ). It must have the same size / chunks as B . A : ( N , P ) numpy . array Returns ------- X : ( P , ...) numpy . ndarray that minimizes norm ( M * ( AX - B )) Notes ----- If `B` is two - dimensional ( e . g . ( N , K )), the least - squares solution is calculated for each of column of `B` , returning X with dimension ( P , K ) If B is more than 2D , the computation is made with a reduced to 2D keeping the first dimension to its original size . Same for M . It should be used with xr . map_blocks ( only full A is needed , B et M can be processed by blocks ). It uses a broadcasted solve for speed . Examples -------- # with numpy array # with xarray import xarray as xr import numpy as np xysize = 1098 tsize = 10 chunksxy = 100 chunks3D = { 'x' : chunksxy , 'y' : chunksxy , 'Time' : 10 } chunks2D = { 'x' : chunksxy , 'y' : chunksxy } B = xr . DataArray ( np . arange ( np . prod ( [ tsize , xysize , xysize ] )). reshape (( tsize , xysize , xysize )), dims = ( 'Time' , \"x\" , \"y\" ), coords = [ ( 'Time' , np . arange ( tsize )), ( 'x' , np . arange ( xysize )), ( 'y' , np . arange ( xysize )) ] ). chunk ( chunks = chunks3D ) M = xr . DataArray ( np . random . rand ( tsize , xysize , xysize ), dims = ( 'Time' , \"x\" , \"y\" ), coords = [ ( 'Time' , np . arange ( tsize )), ( 'x' , np . arange ( xysize )), ( 'y' , np . arange ( xysize )) ] ). chunk ( chunks = chunks3D ) > 0.05 A = np . random . rand ( tsize , 5 ) # The following are 3 different ways for the same result ## xarray res = xr . map_blocks ( censored_lstsq , B , args = [ M ] , kwargs = { 'A' : A } ) ## dask array blockwise res = da . array . blockwise ( censored_lstsq , 'kmn' , B . data , 'tmn' , M . data , 'tmn' , new_axes = { 'k' : 5 } , dtype = A . dtype , A = A , meta = np . ndarray (())) res = xr . DataArray ( res , dims = [ 'coeff' , B . dims [ 1 ] , B . dims [ 2 ]] , coords = [ ( 'coeff' , np . arange ( A . shape [ 1 ] )), B . coords [ B . dims [ 1 ]] , B . coords [ B . dims [ 2 ]]] ) ## dask map_blockss res = da . array . map_blocks ( censored_lstsq , B . data , M . data , A = A , chunks = (( A . shape [ 1 ] ,), B . chunks [ 1 ] , B . chunks [ 2 ] ), meta = np . ndarray (()), dtype = np . float_ ) res = xr . DataArray ( res , dims = [ 'coeff' , B . dims [ 1 ] , B . dims [ 2 ]] , coords = [ ( 'coeff' , np . arange ( A . shape [ 1 ] )), B . coords [ B . dims [ 1 ]] , B . coords [ B . dims [ 2 ]]] ) get_detection_dates def get_detection_dates ( stack_masks , min_last_date_training , nb_min_date = 10 ) Returns the index of the last date which will be used for training from the masks . Parameters ---------- stack_masks : xarray . DataArray ( Time , x , y ) Stack of masks with dimensions min_last_date_training : str Earliest date at which the training will end and the detection begin nb_min_date : int , optional Minimum number of dates from which to train the model . The default is 10 . Returns ------- xarray . DataArray ( x , y ) Array containing the index of the last date which will be used for training , or 0 if there isn ' t enough valid data . model_vi def model_vi ( stack_vi , stack_masks ) Models periodic vegetation index for each pixel . Parameters ---------- stack_vi : array ( Time , x , y ) Array containing vegetation index data stack_masks : array ( Time , x , y ) Array ( boolean ) containing mask data . Returns ------- coeff_model : array ( 5 , x , y ) Array containing the five coefficients of the vegetation index model for each pixel","title":"Modelvegetationindex"},{"location":"reference/fordead/ModelVegetationIndex/#module-fordeadmodelvegetationindex","text":"Created on Tue Nov 3 16:21:35 2020 @author: Raphael Dutrieux","title":"Module fordead.ModelVegetationIndex"},{"location":"reference/fordead/ModelVegetationIndex/#functions","text":"","title":"Functions"},{"location":"reference/fordead/ModelVegetationIndex/#censored_lstsq","text":"def censored_lstsq ( B , M , A ) Solves least squares problem subject to missing data , compatible with numpy , dask and xarray . Code inspired from http :// alexhwilliams . info / itsneuronalblog / 2018 / 02 / 26 / censored - lstsq Parameters ---------- B : ( N , ...) numpy . ndarray or xarray . DataArray M : ( N , ...) boolean numpy . ndarray or xarray . DataArray Mask giving the missing data ( when False the data is not used in computation ). It must have the same size / chunks as B . A : ( N , P ) numpy . array Returns ------- X : ( P , ...) numpy . ndarray that minimizes norm ( M * ( AX - B )) Notes ----- If `B` is two - dimensional ( e . g . ( N , K )), the least - squares solution is calculated for each of column of `B` , returning X with dimension ( P , K ) If B is more than 2D , the computation is made with a reduced to 2D keeping the first dimension to its original size . Same for M . It should be used with xr . map_blocks ( only full A is needed , B et M can be processed by blocks ). It uses a broadcasted solve for speed . Examples -------- # with numpy array # with xarray import xarray as xr import numpy as np xysize = 1098 tsize = 10 chunksxy = 100 chunks3D = { 'x' : chunksxy , 'y' : chunksxy , 'Time' : 10 } chunks2D = { 'x' : chunksxy , 'y' : chunksxy } B = xr . DataArray ( np . arange ( np . prod ( [ tsize , xysize , xysize ] )). reshape (( tsize , xysize , xysize )), dims = ( 'Time' , \"x\" , \"y\" ), coords = [ ( 'Time' , np . arange ( tsize )), ( 'x' , np . arange ( xysize )), ( 'y' , np . arange ( xysize )) ] ). chunk ( chunks = chunks3D ) M = xr . DataArray ( np . random . rand ( tsize , xysize , xysize ), dims = ( 'Time' , \"x\" , \"y\" ), coords = [ ( 'Time' , np . arange ( tsize )), ( 'x' , np . arange ( xysize )), ( 'y' , np . arange ( xysize )) ] ). chunk ( chunks = chunks3D ) > 0.05 A = np . random . rand ( tsize , 5 ) # The following are 3 different ways for the same result ## xarray res = xr . map_blocks ( censored_lstsq , B , args = [ M ] , kwargs = { 'A' : A } ) ## dask array blockwise res = da . array . blockwise ( censored_lstsq , 'kmn' , B . data , 'tmn' , M . data , 'tmn' , new_axes = { 'k' : 5 } , dtype = A . dtype , A = A , meta = np . ndarray (())) res = xr . DataArray ( res , dims = [ 'coeff' , B . dims [ 1 ] , B . dims [ 2 ]] , coords = [ ( 'coeff' , np . arange ( A . shape [ 1 ] )), B . coords [ B . dims [ 1 ]] , B . coords [ B . dims [ 2 ]]] ) ## dask map_blockss res = da . array . map_blocks ( censored_lstsq , B . data , M . data , A = A , chunks = (( A . shape [ 1 ] ,), B . chunks [ 1 ] , B . chunks [ 2 ] ), meta = np . ndarray (()), dtype = np . float_ ) res = xr . DataArray ( res , dims = [ 'coeff' , B . dims [ 1 ] , B . dims [ 2 ]] , coords = [ ( 'coeff' , np . arange ( A . shape [ 1 ] )), B . coords [ B . dims [ 1 ]] , B . coords [ B . dims [ 2 ]]] )","title":"censored_lstsq"},{"location":"reference/fordead/ModelVegetationIndex/#get_detection_dates","text":"def get_detection_dates ( stack_masks , min_last_date_training , nb_min_date = 10 ) Returns the index of the last date which will be used for training from the masks . Parameters ---------- stack_masks : xarray . DataArray ( Time , x , y ) Stack of masks with dimensions min_last_date_training : str Earliest date at which the training will end and the detection begin nb_min_date : int , optional Minimum number of dates from which to train the model . The default is 10 . Returns ------- xarray . DataArray ( x , y ) Array containing the index of the last date which will be used for training , or 0 if there isn ' t enough valid data .","title":"get_detection_dates"},{"location":"reference/fordead/ModelVegetationIndex/#model_vi","text":"def model_vi ( stack_vi , stack_masks ) Models periodic vegetation index for each pixel . Parameters ---------- stack_vi : array ( Time , x , y ) Array containing vegetation index data stack_masks : array ( Time , x , y ) Array ( boolean ) containing mask data . Returns ------- coeff_model : array ( 5 , x , y ) Array containing the five coefficients of the vegetation index model for each pixel","title":"model_vi"},{"location":"reference/fordead/decline_detection/","text":"Module fordead.decline_detection Created on Mon Nov 2 09:34:34 2020 @author: Raphael Dutrieux Functions detection_anomalies def detection_anomalies ( vegetation_index , predicted_vi , threshold_anomaly , vi , path_dict_vi ) Detects anomalies by comparison between predicted and calculated vegetation index Parameters ---------- masked_vi : array ( x , y ) ( bool ) Array , True where pixels are masked predicted_vi : array ( x , y ) Array containing predicted vegetation index from the model threshold_anomaly : float Threshold used to compare predicted and calculated vegetation index . Anomalies are detected if the difference between the two is above this threshold . Returns ------- anomalies : array ( x , y ) ( bool ) Array , pixel value is True if an anomaly is detected . detection_decline def detection_decline ( decline_data , anomalies , mask , date_index ) Updates decline data using anomalies . Parameters ---------- decline_data : Dataset with three arrays : \"count\" which is the number of successive anomalies , \"state\" which is True where pixels are detected as declining , \"first date\" which contains the index of the date of the first anomaly . anomalies : array ( x , y ) ( bool ) Array , pixel value is True if an anomaly is detected . mask : array ( x , y ) ( bool ) Array , True where pixels are masked date_index : int Index of the date Returns ------- decline_data : Dataset Dataset with the three arrays updated with the results from the date being analysed prediction_vegetation_index def prediction_vegetation_index ( coeff_model , date_list ) Predicts the vegetation index from the model coefficients and the date Parameters ---------- coeff_model : array ( 5 , x , y ) Array containing the five coefficients of the vegetation index model for each pixel date : str Date in the format \"YYYY-MM-DD\" Returns ------- predicted_vi : array ( x , y ) Array containing predicted vegetation index from the model","title":"Decline Detection"},{"location":"reference/fordead/decline_detection/#module-fordeaddecline_detection","text":"Created on Mon Nov 2 09:34:34 2020 @author: Raphael Dutrieux","title":"Module fordead.decline_detection"},{"location":"reference/fordead/decline_detection/#functions","text":"","title":"Functions"},{"location":"reference/fordead/decline_detection/#detection_anomalies","text":"def detection_anomalies ( vegetation_index , predicted_vi , threshold_anomaly , vi , path_dict_vi ) Detects anomalies by comparison between predicted and calculated vegetation index Parameters ---------- masked_vi : array ( x , y ) ( bool ) Array , True where pixels are masked predicted_vi : array ( x , y ) Array containing predicted vegetation index from the model threshold_anomaly : float Threshold used to compare predicted and calculated vegetation index . Anomalies are detected if the difference between the two is above this threshold . Returns ------- anomalies : array ( x , y ) ( bool ) Array , pixel value is True if an anomaly is detected .","title":"detection_anomalies"},{"location":"reference/fordead/decline_detection/#detection_decline","text":"def detection_decline ( decline_data , anomalies , mask , date_index ) Updates decline data using anomalies . Parameters ---------- decline_data : Dataset with three arrays : \"count\" which is the number of successive anomalies , \"state\" which is True where pixels are detected as declining , \"first date\" which contains the index of the date of the first anomaly . anomalies : array ( x , y ) ( bool ) Array , pixel value is True if an anomaly is detected . mask : array ( x , y ) ( bool ) Array , True where pixels are masked date_index : int Index of the date Returns ------- decline_data : Dataset Dataset with the three arrays updated with the results from the date being analysed","title":"detection_decline"},{"location":"reference/fordead/decline_detection/#prediction_vegetation_index","text":"def prediction_vegetation_index ( coeff_model , date_list ) Predicts the vegetation index from the model coefficients and the date Parameters ---------- coeff_model : array ( 5 , x , y ) Array containing the five coefficients of the vegetation index model for each pixel date : str Date in the format \"YYYY-MM-DD\" Returns ------- predicted_vi : array ( x , y ) Array containing predicted vegetation index from the model","title":"prediction_vegetation_index"},{"location":"reference/fordead/maja_fun/","text":"Module fordead.maja_fun Functions band_files def band_files ( indir , type = 'FRE' ) Get band files of MAJA directory ( downloaded from THEIA ) Parameters ---------- indir : str directory containing the raster band files type : str FRE or SRE , see notes for details . Returns ------- list MAJA band files Notes ----- SRE is for SUrface REflectance , i . e . corrected from atmospheric and environment effects . FRE is for Flat REflectance , adding to SRE the correction of slope effects . See https : // labo . obs - mip . fr / multitemp / sentinel - 2 / theias - sentinel - 2 - l2a - product - format for more information . read_maja def read_maja ( indir , shapefile = None , res = 10 , resampling =< Resampling . cubic : 2 > , chunks = { 'x' : 1024 , 'y' : 1024 , 'band' : - 1 }, with_vrt = False , vrt_ram = 64 ) Read MAJA data : FRE bands and mask bbox clipped and resampled Parameters ---------- indir : str MAJA file directory . shapefile : str Region of interest polygon file ( 1 polygon expected ) res : float Target resolution . resampling_method : int rasterio . enums . Resampling method chunks : dict chunks to read / process in parallel with_vrt : bool If True uses WarpedVRT and dask delayed procesing , chunking , parallelisation for reprojection task . vrt_ram : int warp_mem_limit , see https : // rasterio . readthedocs . io / en / latest / api / rasterio . vrt . html #rasterio.vrt.WarpedVRT Returns ------- ( rioxarray . DataArray , rioxarray . DataArray ) ( bands , mask ) mask has values : - 0 : invalid pixel , - 1 : valid pixel resample_raster def resample_raster ( raster_path , resampling =< Resampling . cubic : 2 > , res = 10 , chunks = { 'x' : 1024 , 'y' : 1024 , 'band' : - 1 }, ram = 1024 ) Resample raster using WarpVRT and rioxarray Parameters ---------- raster_path : str resampling : int Method from rasterio . enums . Resampling res : float Should be a divider of raster extent . chunks : dict chunks of the output rioxarray ram : warp_mem_limit , see https : // rasterio . readthedocs . io / en / latest / api / rasterio . vrt . html #rasterio.vrt.WarpedVRT Returns ------- rioxarray . DataArray Notes ----- Inspired of : - https : // github . com / corteva / rioxarray / issues / 119 - https : // gist . github . com / rmg55 / 875 a2b79ee695007a78ae615f1c916b2 unzip def unzip ( zfile , write_dir , overwrite = False ) Unzip file Parameters ---------- zfile : str Zip file path write_dir : str Destination directory overwrite : bool Returns ------- str Extracted directory path","title":"Maja Fun"},{"location":"reference/fordead/maja_fun/#module-fordeadmaja_fun","text":"","title":"Module fordead.maja_fun"},{"location":"reference/fordead/maja_fun/#functions","text":"","title":"Functions"},{"location":"reference/fordead/maja_fun/#band_files","text":"def band_files ( indir , type = 'FRE' ) Get band files of MAJA directory ( downloaded from THEIA ) Parameters ---------- indir : str directory containing the raster band files type : str FRE or SRE , see notes for details . Returns ------- list MAJA band files Notes ----- SRE is for SUrface REflectance , i . e . corrected from atmospheric and environment effects . FRE is for Flat REflectance , adding to SRE the correction of slope effects . See https : // labo . obs - mip . fr / multitemp / sentinel - 2 / theias - sentinel - 2 - l2a - product - format for more information .","title":"band_files"},{"location":"reference/fordead/maja_fun/#read_maja","text":"def read_maja ( indir , shapefile = None , res = 10 , resampling =< Resampling . cubic : 2 > , chunks = { 'x' : 1024 , 'y' : 1024 , 'band' : - 1 }, with_vrt = False , vrt_ram = 64 ) Read MAJA data : FRE bands and mask bbox clipped and resampled Parameters ---------- indir : str MAJA file directory . shapefile : str Region of interest polygon file ( 1 polygon expected ) res : float Target resolution . resampling_method : int rasterio . enums . Resampling method chunks : dict chunks to read / process in parallel with_vrt : bool If True uses WarpedVRT and dask delayed procesing , chunking , parallelisation for reprojection task . vrt_ram : int warp_mem_limit , see https : // rasterio . readthedocs . io / en / latest / api / rasterio . vrt . html #rasterio.vrt.WarpedVRT Returns ------- ( rioxarray . DataArray , rioxarray . DataArray ) ( bands , mask ) mask has values : - 0 : invalid pixel , - 1 : valid pixel","title":"read_maja"},{"location":"reference/fordead/maja_fun/#resample_raster","text":"def resample_raster ( raster_path , resampling =< Resampling . cubic : 2 > , res = 10 , chunks = { 'x' : 1024 , 'y' : 1024 , 'band' : - 1 }, ram = 1024 ) Resample raster using WarpVRT and rioxarray Parameters ---------- raster_path : str resampling : int Method from rasterio . enums . Resampling res : float Should be a divider of raster extent . chunks : dict chunks of the output rioxarray ram : warp_mem_limit , see https : // rasterio . readthedocs . io / en / latest / api / rasterio . vrt . html #rasterio.vrt.WarpedVRT Returns ------- rioxarray . DataArray Notes ----- Inspired of : - https : // github . com / corteva / rioxarray / issues / 119 - https : // gist . github . com / rmg55 / 875 a2b79ee695007a78ae615f1c916b2","title":"resample_raster"},{"location":"reference/fordead/maja_fun/#unzip","text":"def unzip ( zfile , write_dir , overwrite = False ) Unzip file Parameters ---------- zfile : str Zip file path write_dir : str Destination directory overwrite : bool Returns ------- str Extracted directory path","title":"unzip"},{"location":"reference/fordead/masking_vi/","text":"Module fordead.masking_vi Created on Fri Nov 20 17:29:17 2020 @author: Raphael Dutrieux Functions","title":"Masking Vi"},{"location":"reference/fordead/masking_vi/#module-fordeadmasking_vi","text":"Created on Fri Nov 20 17:29:17 2020 @author: Raphael Dutrieux","title":"Module fordead.masking_vi"},{"location":"reference/fordead/masking_vi/#functions","text":"","title":"Functions"},{"location":"reference/fordead/timelapse/","text":"Module fordead.timelapse Created on Fri Sep 18 13:37:02 2020 @author: raphael.dutrieux Functions","title":"Timelapse"},{"location":"reference/fordead/timelapse/#module-fordeadtimelapse","text":"Created on Fri Sep 18 13:37:02 2020 @author: raphael.dutrieux","title":"Module fordead.timelapse"},{"location":"reference/fordead/timelapse/#functions","text":"","title":"Functions"},{"location":"reference/fordead/writing_data/","text":"Module fordead.writing_data Created on Fri Nov 6 17:32:26 2020 @author: Raphael Dutrieux Functions","title":"Writing Data"},{"location":"reference/fordead/writing_data/#module-fordeadwriting_data","text":"Created on Fri Nov 6 17:32:26 2020 @author: Raphael Dutrieux","title":"Module fordead.writing_data"},{"location":"reference/fordead/writing_data/#functions","text":"","title":"Functions"}]}